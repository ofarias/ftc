<?php
require_once('app/model/pegaso.model.php');
require_once('app/model/pegaso.model.coi.php');
require_once('app/model/pegaso.model.ventas.php');
require_once('app/model/model.ftc.php');
require_once('app/fpdf/fpdf.php');
require_once('app/views/unit/commonts/numbertoletter.php');
require_once('app/controller/pegaso.controller.ventas.php');
require_once('app/model/database.xmlTools.php');
require_once('app/model/verificaID.php');
require_once('app/model/db.contabilidad.php');
require_once 'app/model/pegasoqr.php';
require_once('app/model/pegaso.model.recoleccion.php');
require_once('app/model/pegaso.model.cxc.php');
require_once('app/model/facturacion.php');
require_once('app/controller/pegaso.controller.cobranza.php');

class pegaso_controller{
	var $contexto_local = "http://SERVIDOR:8081/pegasoFTC/app/";
	var $contexto = "http://SERVIDOR:8081/pegasoFTC/app/";
	
	function Login(){
			$pagina = $this->load_templateL('Login');
			$html = $this->load_page('app/views/modules/m.login.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this->view_page($pagina);
	}

	function Autocomp(){
		$arr = array('prueba1', 'trata2', 'intento3', 'prueba4', 'prueba5');
		echo json_encode($arr);
		exit;
	}

	function salir(){
		$data= new pegaso;
		$salir=$data->salir();
		session_unset();
        	session_destroy();
        	if (ini_get("session.use_cookies")) {
            		$params = session_get_cookie_params();
            		setcookie(session_name(), '', time() - 42000,
                		$params["path"], $params["domain"],
                		$params["secure"], $params["httponly"]
            		);
		}
		$this->Login();
		return;
	}

	function LoginConta($user, $pass){
		$data= new ftc;
		$usuario = $data->loginMysql($user, $pass);
		$_SESSION['usuario']=$user;
		$_SESSION['contra']=$pass;
		if(!empty($usuario)){
			foreach ($usuario as $key) {
				$u = $key['usuario'];
			}
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.adminConta.php');
			ob_start();
			$table=ob_get_clean();
			include 'app/views/modules/m.adminConta.php';
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);	
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function LoginA($user, $pass){
		$conta = new ftc; 
		$bd = $conta->traeBD();
		$data = new pegaso;
			$rs = $data->AccesoLogin($user, $pass);
			
				if(isset($rs) > 0){					
					$r = $data->CompruebaRol($user, $pass);
					switch ($r->USER_ROL){
						case 'administracion':
						$this->MenuAd();
						break;
						case 'ContaXML':
		        		$this->MenuXML();
		        		break;
		        		case 'costos':
						$this->MenuCostos();
						break;
						case 'cobranza':
						$this->MenuCobranza();
						break;
						case 'ventas':
						$this->MenuVentas();
						break;
						case 'suministros':
						$this->MenuSuministros();
						break;
						case 'tesoreria':
						$this->MenuTesoreria();
						break;
						case 'logistica':
						$this->MenuLogistica();
						break;
						case 'bodega':
						$this->MenuBodega();
						break;
						case 'empaque':
						$this->MenuEmpaque();
						break;
						case 'revision':
						$this->MenuRevision();
						break;

						default:
						$e = "Error en acceso 1, favor de revisar usuario y/o contraseña";
						header('Location: index.php?action=login&e='.urlencode($e)); exit;
						break;
						}

				}else{
					$e = "Error en acceso 2, favor de revisar usuario y/o contraseña";
						header('Location: index.php?action=login&e='.urlencode($e)); exit;
				}
	}

	function Inicio(){
		
		if(isset($_SESSION['user'])){
			$o = $_SESSION['user'];
			switch($o->USER_ROL){
				case 'administracion':
				$this->MenuAd();
				break;
				case 'ContaXML':
		       	$this->MenuXML();
		       	break;
		       	case 'costos':
				$this->MenuCostos();
				break;
				case 'cobranza':
				$this->MenuCobranza();
				break;
				case 'ventas':
				$this->MenuVentas();
				break;
				case 'suministros':
				$this->MenuSuministros();
				break;
				case 'tesoreria':
				$this->MenuTesoreria();
				break;
				case 'logistica':
				$this->MenuLogistica();
				break;
				case 'bodega':
				$this->MenuBodega();
				break;
				case 'empaque':
				$this->MenuEmpaque();
				break;
				case 'revision':
				$this->MenuRevision();
				break;
				default:
				$e = "Error en acceso 1, favor de revisar usuario y/o contraseña";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
				break;
				}
		}
	}

/// Nuevos Menus

	function MenuCostos(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'costos'){
			$pagina = $this->load_template('Menu Admin');			
			ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE; 
            include 'app/views/modules/m.mcostos.php';   
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function MenuCobranza(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'cobranza'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mcobranza.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuVentas(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'ventas'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mventas.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuSuministros(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'suministros'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.msuministros.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuTesoreria(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'tesoreria'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mtesoreria.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuLogistica(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'logistica'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mlogistica.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuBodega(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'bodega'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mbodega.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	function MenuEmpaque(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'empaque'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mempaque.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function MenuRevision(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'revision'){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
     		$data=new pegaso;
			$data2=new pegasoCobranza;
			$table =ob_get_clean();
            $Solicitudes =$data->verSolBodega(); 
			$vales = $data->verValesBodega();
			$oci = $data->verOCI();
			$logistica = $data->unidadeslog();
			$documentos = 0;
			$cajas = $data->invPatio();
			//$documentos = $data->cajasSinProcesar();
			$mermas = $data->verMermas();
			$devprov= $data->verDevProv();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			$documentos =0;
			$bloqueos = 0;
			$Solicitudes =$data->verSolBodega(); 
			$vales = $data->verValesBodega();
			$oci = $data->verOCI();
			$logistica = $data->unidadeslog();
			$documentos = 0;
			$cajas = $data->invPatio();
			//$documentos = $data->cajasSinProcesar();
			$mermas = $data->verMermas();
			$devprov= $data->verDevProv();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			//$documentos = $data->cajasSinProcesar();
			//$ra = $data->actualizaRCDetalle(); /// Actualiza la ruta detalle.
			//$validacion= $data->calculaBloqueo();  /// Calcula Bloqueo por no cierre de ruta.
			//$bloqueos = $data->traeBloqueos();  /// Trae la cantidad de bloqueos activos.
			if ($bloqueos > 0){
			///	exit('Bloqueo de Ruta cuenta por Cobrar');
			}
			### 4 segundos
			$cajas=$data->totalCajas(); /// Inventario Fisico empaque
			### 4 segundos
			$docs = $data->resumenCxC();
			###  4 seg
			$cobranza=$data2->docsVencidosCartera(); // No tarda
			$prefacturas=$data->prefacturasPendientes();
			/// Manejo de Bloqueos
			//$ra = $data->actualizaRCDetalle(); /// Actualizacion de Ruta Cobranza Tarda y no se esta usando. desactivado el 19 de Febrero del 2019 OFA 
			//$validacion= $data->calculaBloqueo();
			
			$vencidos = array();    
            include 'app/views/modules/m.mrevision.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

/// Finaliza Menus 

	function CambiarSenia(){	
		if(isset($_SESSION['user'])){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/pages/Usuarios/p.cambiarSenia.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			ob_start();
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function cambioSenia($nuevaSenia, $actual, $usuario){
		if(isset($_SESSION['user'])){
			$data=new pegaso;
			$data2= new ftc;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/pages/Usuarios/p.cambiarSenia.php');
			ob_start();
			$cambio=$data->cambioSenia($nuevaSenia, $actual, $usuario);
			if($cambio['status']=='ok'){
				$cambio2=$data2->cambioSenia($nuevaSenia, $usuario);
				if($cambio2['status']== 'm'){
					$cambioM=$data->cambioMultiple($nuevaSenia, $actual, $usuario, $cambio2['empresas']);
				}
			}
			$this->CerrarVentana();
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function cxcexterna(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'cxcexterna'){
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.cxcexterna.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function MenureciboRecoleccion(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'reciboRecoleccion'){
			$data = new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mreciboRecoleccion.php');
			$usuario = $_SESSION['user']->NOMBRE;
			ob_start();
				$vales=$data->totalValesPatio();
				$cajas=$data->totalCajas();
				//var_dump($vales).'<br/>';
				//echo count($cajas);
				$table = ob_get_clean();
				include 'app/views/modules/m.mreciboRecoleccion.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
				
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuReparto(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'reparto'){
			$data = new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mlogisticaReparto.php');
			$usuario = $_SESSION['user']->NOMBRE;
			ob_start();
			$table = ob_get_clean();
			$documentos = 0;
			//$documentos = $data->cajasSinProcesar();
			$aruta=count($data->ARutaEntrega());
			$tipo = 1;
			$secuencia = count($data->CreaSubMenuEntrega($tipo));
			$tipo = 2;
			$administrar = count($data->CreaSubMenuEntrega($tipo));
			if($documentos == 0 ){
			include 'app/views/modules/m.mlogisticaReparto.php';
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			}else{
			include 'app/views/modules/m.mbloqueologisticaReparto.php';
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			}
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


    function MenuCxCCobranza(){     //14062016	
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL=='cxcc'){
			$tipoUsuario=$_SESSION['user']->LETRA;
			$data=new pegaso;
			$data2=new pegasoCobranza;
			$usuario = $_SESSION['user']->NOMBRE;
			ob_start();
			$table = ob_get_clean();
			$pagina = $this->load_template('Menu Admin');
			$documentos =0;
			//$documentos = $data->cajasSinProcesar();
			$cajas=$data->totalCajas();
			$docs = $data->resumenCxC();
			$cobranza=$data2->docsVencidosCartera();
			$prefacturas=$data->prefacturasPendientes();
			//print_r($docs);
			if($documentos == 0 ){	
				include 'app/views/modules/m.mcxccobranza.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			}else{
				include 'app/views/modules/m.mbloqueologisticaReparto.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);	
			}

			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}  
    }


	function MenuBodega2(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'bodega2'){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.mbodega2.php');
			$Solicitudes =$data->verSolBodega(); 
			$vales = $data->verValesBodega();
			$oci = $data->verOCI();
			$logistica = $data->unidadeslog();
			$documentos = 0;
			//$documentos = $data->cajasSinProcesar();
			$mermas = $data->verMermas();
			$devprov= $data->verDevProv();
			ob_start();
			$table = ob_get_clean();
			if($documentos == 0 ){	
				include 'app/views/modules/m.mbodega2.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			}else{
				include 'app/views/modules/m.mbloqueologisticaReparto.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);		
			}
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function MenuVentasP(){
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'ventasp'){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mventasp.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mventasp.php';
				//$pagina = $this->replace_content();			
				//$html = $this->load_page('app/views/modules/m.mventasp.php');
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuGcxc(){ 
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL=='gcxc'){
			$data=new pegaso;
			ob_start();
			$act_dia = $data->actStatusVencimiento();
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.mgerenciaCobranza.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}  
    }

	function MenuAuditoria(){
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'auditoria'){
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mauditoria.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function xmlMenu(){
		if(isset($_SESSION['user']) && ($_SESSION['user']->USER_ROL == 'xml' || $_SESSION['user']->USER_ROL == 'ContaXML'|| $_SESSION['user']->USER_ROL == 'administracion')){
			$data = new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mxml.php');
			$usuario = $_SESSION['user']->NOMBRE;
			$periodos=$data->traePeriodosXML();
			ob_start();
			$table = ob_get_clean();
			include 'app/views/modules/m.mxml.php';
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this->view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function mXMLSP($tipo, $anio){
		if(isset($_SESSION['user']) && ($_SESSION['user']->USER_ROL == 'xml' || $_SESSION['user']->USER_ROL == 'ContaXML'||$_SESSION['user']->USER_ROL == 'administracion' )){
			$data = new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mxmlSP.php');
			$usuario = $_SESSION['user']->NOMBRE;
			$anual =$data->xmlAnual($tipo, $anio);
			$subMenuXMLSP=$data->mXMLSP($tipo, $anio);
			if($tipo == 'E'){
				$ide="Emitidos";
			}elseif ($tipo == 'R') {
				$ide="Recibidos";
			}
			ob_start();
				$table = ob_get_clean();
				include 'app/views/modules/m.mxmlSP.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuFacturacion(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'facturacion'){
			$data = new pegaso;
			$data2=new pegasoCobranza;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mfacturacion.php');
			$usuario = $_SESSION['user']->NOMBRE;
			$cajas=$data->totalCajas();
			$docs = $data->resumenCxC();
			//$cobranza=$data2->docsVencidosCartera();
			$prefacturas=$data->prefacturasPendientes();
			ob_start();
				$table = ob_get_clean();
				include 'app/views/modules/m.mfacturacion.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuPP(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mPP.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mPP.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuCM(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mCM.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mCM.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuV(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mV.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			$table= ob_get_clean();
				include 'app/views/modules/m.mV.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuS(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mS.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			$Solicitudes =$data->verSolBodega(); 
			$info=$data->ocAyer();
			$infohoy = $data->ocHoy();
			$fallidas = $data->verRechazados();
				$table= ob_get_clean();
				include 'app/views/modules/m.mS.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuT(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mT.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mT.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuLR(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mLR.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mLR.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuBE(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mBE.php');
			ob_start();
			$rechazos = $data->verRechazo();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mBE.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuLE(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mLE.php');
			ob_start();
			$aruta=count($data->ARutaEntrega());
			$tipo = 1;
			$secuencia = count($data->CreaSubMenuEntrega($tipo));
			$tipo = 2;
			$administrar = count($data->CreaSubMenuEntrega($tipo));
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mLE.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuR(){
		if(isset($_SESSION['user']) ){
			$tipoUsuario=$_SESSION['user']->LETRA;
			$data=new pegaso;
			$data2=new pegasoCobranza;
			$usuario = $_SESSION['user']->NOMBRE;
			ob_start();
			$table = ob_get_clean();
			$pagina = $this->load_template('Menu Admin');
			$documentos =0;
			$bloqueos = 0;
			$Solicitudes =$data->verSolBodega(); 
			$vales = $data->verValesBodega();
			$oci = $data->verOCI();
			$logistica = $data->unidadeslog();
			$documentos = 0;
			$cajas = $data->invPatio();
			//$documentos = $data->cajasSinProcesar();
			$mermas = $data->verMermas();
			$devprov= $data->verDevProv();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			//$documentos = $data->cajasSinProcesar();
			//$ra = $data->actualizaRCDetalle(); /// Actualiza la ruta detalle.
			//$validacion= $data->calculaBloqueo();  /// Calcula Bloqueo por no cierre de ruta.
			//$bloqueos = $data->traeBloqueos();  /// Trae la cantidad de bloqueos activos.
			if ($bloqueos > 0){
			///	exit('Bloqueo de Ruta cuenta por Cobrar');
			}

			### 4 segundos
			$cajas=$data->totalCajas(); /// Inventario Fisico empaque
			### 4 segundos
			$docs = $data->resumenCxC();
			###  4 seg
			$cobranza=$data2->docsVencidosCartera(); // No tarda
			$prefacturas=$data->prefacturasPendientes();
			/// Manejo de Bloqueos
			//$ra = $data->actualizaRCDetalle(); /// Actualizacion de Ruta Cobranza Tarda y no se esta usando. desactivado el 19 de Febrero del 2019 OFA 
			//$validacion= $data->calculaBloqueo();
			
			$vencidos = array();
			if(strrpos($tipoUsuario, "C") !== false){
				$vencidos=$data2->docVencidos($tipoUsuario);
				$rutas=$data2->rutasCobranza($tipoUsuario);
			}
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
			$table= ob_get_clean();
			include 'app/views/modules/m.mR.php';
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}

	function MenuB(){
		if(isset($_SESSION['user']) ){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mB.php');
			ob_start();
			$Solicitudes =$data->verSolBodega(); 
			$vales = $data->verValesBodega();
			$oci = $data->verOCI();
			$logistica = $data->unidadeslog();
			$documentos = 0;
			$cajas = $data->invPatio();
			//$documentos = $data->cajasSinProcesar();
			$mermas = $data->verMermas();
			$devprov= $data->verDevProv();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mB.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}	

	function MenuCO(){
		if(isset($_SESSION['user'])){
			$data= new pegaso;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mCO.php');
			ob_start();
			$usuario=$_SESSION['user']->NOMBRE;
			$letra = $_SESSION['user']->LETRA;
				$table= ob_get_clean();
				include 'app/views/modules/m.mCO.php';
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}	
	}	

	function VerPago(){        
        if(isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.verpago.php');
        ob_start();
                $exec = $data->VerPagadas();
                if(count($exec) > 0){
                	include 'app/views/pages/p.verpago.php';
                    $table = ob_get_clean();
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

	function DetallePedido($doc){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Pagos');				
			$html = $this->load_page('app/views/pages/p.detallepedidodoc.php');
			ob_start(); 
					$cabecera = $data->CabeceraPedidoDoc($doc);
					$detalle = $data->DetallePedidoDoc($doc);
					if(count($detalle) > 0){
						include 'app/views/pages/p.detallepedidodoc.php';
						$table = ob_get_clean(); 
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
				}else{
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
				}		
				$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function DetalleDocumento($doc){
		
		if(isset($_SESSION['user'])){

			if(substr($doc, 0,1) == 'O'){
					$data = new pegaso;				
					$pagina=$this->load_template('Pagos');				
					$html = $this->load_page('app/views/pages/p.detalledoc.php');
					ob_start(); 
			//generamos consultas
					$cabecera = $data->CabeceraDoc($doc);
					$detalle = $data->DetalleDoc($doc);
					if(count($detalle) > 0){
						include 'app/views/pages/p.detalledoc.php';
						$table = ob_get_clean(); 
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
				}else{
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
				}				
			}else{
					$data = new pegaso;				
					$pagina=$this->load_template('Pagos');				
					$html = $this->load_page('app/views/pages/p.detalleSol.php');
					ob_start(); 
					$solicitud=$data->Solicitudes($doc);
					$sol=$data->verSol($doc);
					if(count($solicitud) > 0){
						include 'app/views/pages/p.detalleSol.php';
						$table = ob_get_clean(); 
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
				}else{
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
				}
			}
				$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function AsignaRuta($docu,$unidad,$edo){
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Pagos');	
			$redireccionar = 'aruta';			
			$html = $this->load_page('app/views/pages/p.redirectform.php');
			ob_start(); 
					$exec1 = $data->ActualizaRuta($docu, $unidad);
					$regoper = $data->RegistroOperadores($docu,$unidad);
					$entrega = $data->ARutaEntrega();
					$unidad = $data->TraeUnidades();
					if(isset($exec1) or isset($entrega))
						include 'app/views/pages/p.redirectform.php';
						else
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function ARuta(){
		if(isset($_SESSION['user'])){
		$data = new pegaso;		
		$pagina=$this->load_template('Pagos');				
		$html = $this->load_page('app/views/pages/p.aruta.php');
		ob_start(); 
		$exec = $data->ARuta();
		$entrega = $data->ARutaEntrega();
		$unidad = $data->TraeUnidades();
		include 'app/views/pages/p.aruta.php';
		$table = ob_get_clean(); 	
		if(count($exec) > 0 or count($entrega) > 0) {
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table.'<div class="alert-info"><center><h2>No existen ordenes de compra pendientes de recolectar.</h2><center></div>', $pagina);
		}		
		$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function ARutaReparto(){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Pagos');				
			$html = $this->load_page('app/views/pages/Reparto/p.arutaReparto.php');
			ob_start(); 
				$entrega = $data->ARutaEntrega();
				$unidad = $data->TraeUnidades();
				if(count($entrega) > 0) {
					include 'app/views/pages/Reparto/p.arutaReparto.php';
					$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
				}else{
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
				}		
				$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function ARutaEdoMex(){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
		$pagina=$this->load_template('Pagos');				
		$html = $this->load_page('app/views/pages/p.aruta.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->ARutaEdoMex();
				$unidad = $data->TraeUnidades();
				if(count($exec) > 0){
					include 'app/views/pages/p.aruta.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); 
			exit;
		}
	}

	function altaunidades(){
		if(isset($_SESSION['user'])){
		$pagina = $this->load_templateL('Alta Unidad');
			$html = $this->load_page('app/views/pages/p.altaunidad.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this->view_page($pagina);
			}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function altaunidadesdata($numero, $marca, $modelo, $placas, $operador){	
		if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.altaunidad_r.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->altaunidades1($numero, $marca, $modelo, $placas, $operador);
				if(count($exec) > 0){
					include 'app/views/pages/p.altaunidad_r.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	
	function PagoW(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
		$pagina=$this->load_template('Pagos');				
		$html = $this->load_page('app/views/pages/p.pagosw.php');
		ob_start(); 
		//generamos consultas
				$error = "Favor de verificar que los datos ingresados sean correctos";
				$exec = $data->Pagos();
				if(count($exec) > 0){
					include 'app/views/pages/p.pagosw.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function Pedido(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/pages/p.pedido.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function MuestraPedidos($ped){		
		if(isset($_SESSION['user'])){
			$data = new pegaso;		
		$pagina=$this->load_template('Pedidos');				
			$html = $this->load_page('app/views/pages/p.pedido_r.php');
			ob_start(); 
				$exec=$data->ConsultaPreoc($ped);
				//$options=$data->ConsultaMov($ped);
				if(count($exec)>0 ){
					include 'app/views/pages/p.pedido_r.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	

	function MenuContabilidad(){
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'contabilidad'){
			$usuario=$_SESSION['user']->LETRA;
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.mcontabilidad.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	



	function MenuGLogistica(){
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'glogistica'){
		$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.mgerencialogistica.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
			
		}
	}	

	function MenuRecibo(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'recibo'){
		$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.mrecibo.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
			
		}
	}

	/*Carga menu de administrador*/
	function MenuAdmin(){
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'administrador'){
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.madmin.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function MenuXML(){
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mcontaxml.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
        }else{
            $e = "Favor de Revisar sus datos";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
	}
	
	function MenuAd(){    
        if(isset($_SESSION['user'])){
            $pagina = $this->load_template('Menu Admin');
            //$html = $this->load_page('app/views/modules/m.mad.php');
            ob_start();
            $table =ob_get_clean();
            $usuario=$_SESSION['user']->NOMBRE;    
            include 'app/views/modules/m.mad.php';
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            $this-> view_page($pagina);
        }else{
            $e = "Favor de Revisar sus datos";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
	
	function MenuUsuario(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.muser.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


    function MenuCxCRevision(){     //14062016
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL== 'cxcr'){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/modules/m.mcxcrevision.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}  
    }







	function Pxr(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;	
			$pagina=$this->load_template('PXR');				
			$html = $this->load_page('app/views/pages/p.pxr.php');
			ob_start();
			$exec = $data->ListaPartidasNoRecibidas();
			if($exec != ''){
				include 'app/views/pages/p.pxr.php';
				$table = ob_get_clean();
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
			}else{
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
			}
			$this ->view_page($pagina);
			}else{
				$e = "Favor de iniciar sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	//ORDEN DE COMPRA


	function AsignaAFactf($factura, $componente){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
			$pagina=$this->load_template('Asigna Componentes');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.aflujo.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$asigna = $data->ActualizaFactf($factura, $componente);
		if(count($asigna) > 0){
				$exec = $data->ConsultaFac();
				$options = $data->ConsultaFlu();
				$facturas = $data->MuestraFact();
				$componentes = $data->MuestraDisp();
				//var_dump($exec);
				if($exec > 0){
					include 'app/views/pages/p.aflujo.php';
					/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
					 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
					 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);
		}			
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	
	/*Carga modulo Asigna Flujo*/
	/*Carga modulo Crea Flujo*/
	function AFlujo(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
			$pagina=$this->load_template('Asigna Componentes');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.aflujo.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaFac();
		$options = $data->ConsultaFlu();
		$facturas = $data->MuestraFact();
		$componentes = $data->MuestraDisp();
		//var_dump($exec);
		if($exec > 0){
			include 'app/views/pages/p.aflujo.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
					}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
					}		
					$this->view_page($pagina);
			
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}
	
	/*Carga modulo Crea Flujo*/
	function CFlujo(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
			$pagina=$this->load_template('Asigna Componentes');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.asigcomp.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaComp();
		$asignados = $data->AsignadosComp();
		if($exec > 0){
			include 'app/views/pages/p.asigcomp.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
					}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al capturar el componente</h2><center></div>', $pagina);
					}		
					$this->view_page($pagina);
			
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}
	
	function AUsuarios(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Asigna Flujo');
			$html = $this->load_page('app/views/pages/p.ausuarios.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	/*muestra la vista del formulario componente*/
	function CComp(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
			$pagina = $this->load_template('Asigna Flujo');			
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.ccomp.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->MuestraComp();
		
		if($exec > 0){
			include 'app/views/pages/p.ccomp.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
					}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al capturar el componente</h2><center></div>', $pagina);
					}		
					$this->view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	
	
	function SFact(){		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Asigna Flujo');
			$html = $this->load_page('app/views/pages/p.sfact.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function AUsers(){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');	
			$html = $this->load_page('app/views/pages/Usuarios/p.ausers.php');
			ob_start(); 
			$roles=$data->traeRoles();	
			$exec = $data->ConsultaUsur();
			if($exec != ''){
				include 'app/views/pages/Usuarios/p.ausers.php';
				$table = ob_get_clean(); 
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
			}else{
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
			}		
			$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	/*Obtiene y carga el template*/
	function load_template($title='Sin Titulo'){
		$pagina = $this->load_page('app/views/master.php');
		$header = $this->load_page('app/views/sections/s.header.php');
		$pagina = $this->replace_content('/\#HEADER\#/ms' ,$header , $pagina);
		$pagina = $this->replace_content('/\#TITLE\#/ms' ,$title , $pagina);		
		return $pagina;
	}
	
	/*Header para login*/
	function load_templateL($title='Sin Titulo'){
		$pagina = $this->load_page('app/views/master.php');
		$header = $this->load_page('app/views/sections/header.php');
		$pagina = $this->replace_content('/\#HEADER\#/ms' ,$header , $pagina);
		$pagina = $this->replace_content('/\#TITLE\#/ms' ,$title , $pagina);		
		return $pagina;
	}

	/*Header para los popup?*/
	function load_template_popup($title='sat2app'){
		$pagina = $this->load_page('app/views/master.php');
		$header = $this->load_page('app/views/sections/s.header2.php');
		$pagina = $this->replace_content('/\#HEADER\#/ms' ,$header , $pagina);
		$pagina = $this->replace_content('/\#TITLE\#/ms' ,$title , $pagina);		
		return $pagina;
	}

	/*inserta los nuevos componentes*/
	function InsertaCcomp($nombre, $duracion, $tipo){
		$data = new pegaso;	
		if(isset($_SESSION['user'])){	
			$comprueba = $data->CompruebaComp($nombre);
			//var_dump($comprueba);
			//print_r($comprueba);
						if($comprueba > 0){
							$pagina=$this->load_template('Compra Venta');				
							//$html = $this->load_page('app/views/modules/m.reporte_result.php');
							$html = $this->load_page('app/views/pages/p.ccomp.php');
							/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
							 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
							ob_start(); 
							//generamos consulta
							$exec = $data->MuestraComp();
							include 'app/views/pages/p.ccomp_r.php';
								/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
								 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
								 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
								$table = ob_get_clean(); 
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>El componente ingresado ya existe</h2><center></div>', $pagina);
										
								}else{
									$pagina=$this->load_template('Compra Venta');				
									//$html = $this->load_page('app/views/modules/m.reporte_result.php');
									$html = $this->load_page('app/views/pages/p.ccomp.php');
									/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
									 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
									ob_start(); 
									//generamos consulta
									$rs = $data->InsertaCompo($nombre, $duracion, $tipo, $_SESSION['user']);
									if($rs > 0){
										$exec = $data->MuestraComp();
										include 'app/views/pages/p.ccomp_r.php';
										/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
										 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
										 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
										$table = ob_get_clean(); 
											$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
												}else{
													$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al capturar el componente</h2><center></div>', $pagina);
												}		
												
								}
							$this->view_page($pagina);
				
						}else{
							$e = "Favor de Iniciar Sesión";
							header('Location: index.php?action=login&e='.urlencode($e)); exit;
						}

		}
	
	function valUsr($usr){
		$data = new pegaso;
		$data_ftc = new ftc;
		$val=array("status"=>'no');
		$valmysql=$data_ftc->valUsr($usr);
		if(count($valmysql) < 1){
			$val = $data->valUsr($usr);
		}	
		return($val);
		
	}

	function InsertaUsuarioN($usuario, $contra, $email, $rol, $letra, $nomcom, $letras, $paterno, $materno){
		$data = new pegaso;
		$data_ftc = new ftc;
		$html = '';
		$pagina = '';
		$html = $this->load_page('app/views/pages/Usuarios/p.ausers.php');
		$roles=$data->traeRoles();
		$mysql = $data_ftc->intUser($usuario, $contra, $email, $rol, $letra, $nomcom, $letras, $paterno, $materno);
		$nuser = $data->NuevoUser($usuario, $contra, $email, $rol, $letra, $nomcom, $letras,$paterno, $materno);
		ob_start(); 		 		
		$redireccionar="ausers";
		$pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        include 'app/views/pages/p.redirectform.php';
        $this->view_page($pagina);
	}
	
	function CCompVent(){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.ccompvent.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaProd();
		if($exec != ''){
			include 'app/views/pages/p.ccompvent.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

/*#########################################CAmbios de OFA#########################################*/
		//Pantallas para Costos
		function Ccp(){
			
			if(isset($_SESSION['user'])){
				$pagina = $this->load_template('Costos');			
				$html = $this->load_page('app/views/pages/p.ccp.php');
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
				$this-> view_page($pagina);
			}else{
				$e = "Favor de Revisar sus datos";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
		}

		//Pantalla para seguimiento de los productos.
		
		function Pantalla1($cat){
			
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.pantalla1.php');
		ob_start(); 
		$exec = $data->Idproducto($cat);
		if($exec != ''){
			include 'app/views/pages/p.pantalla1.php';
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
		}
		
		function Lista_Pedidos(){
			
				if(isset($_SESSION['user'])){
					$data = new pegaso;
					$pagina = $this->load_template('Compra Venta');
					$html = $this->load_page('app/views/pages/p.lpedidos.php');
					ob_start();
					$exec = $data->LPedidos();
						if ($exec != ''){
						include 'app/views/pages/p.lpedidos.php';
						$table = ob_get_clean();
						$pagina= $this ->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
							}else{
						$pagina = $this -> replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina );
							}
						$this ->view_page($pagina);
					}else{
			$e = "Favor de Iniciar Sesión.";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
		}

		function Lista_Pedidos_Todos(){
			
				if(isset($_SESSION['user'])){
					$data = new pegaso;
					$pagina = $this->load_template('Compra Venta');
					$html = $this->load_page('app/views/pages/p.lpedidosT.php');
					ob_start();
					$exec = $data->LPedidosTodos();
						if ($exec != ''){
						include 'app/views/pages/p.lpedidosT.php';
						$table = ob_get_clean();
						$pagina= $this ->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
							}else{
						$pagina = $this -> replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina );
							}
						$this ->view_page($pagina);
					}else{
			$e = "Favor de Iniciar Sesión.";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
		}


		/// Pantalla para poder visualizar lo pendiente por facturar.
		
	function Pantalla2(){       //2306-
                    
                    if(isset($_SESSION['user'])){
                    $data = new pegaso;
                    $pagina=$this->load_template('Compra Venta');				
                    $html = $this->load_page('app/views/pages/p.pantalla2.php');
                    ob_start(); 
                    $exec = $data->PorFacturar();
                    $notascred = $data->PendientesGenNC();
                    $reenruta = $data->PendientesGenRee();
                    if($exec != ''){
			include 'app/views/pages/p.pantalla2.php';
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                        }else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                    }		
                    $this->view_page($pagina);
                    }else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
		
		
		
	//ORDEN DE COMPRA
		function OrdComp(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.ordcomp.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaOrdenComp('1'); #<-- enviamos en id para la consulta correspondiente a esta funcion
		if($exec != ''){
			//unset($_SESSION['correcto']);
			include 'app/views/pages/p.ordcomp.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	//ORDEN DE COMPRA
		function OrdComp1($cat){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.ordcomp_cat1.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaOrdenComp($cat); #<-- enviamos en id para la consulta correspondiente a esta funcion
		if($exec != ''){
			//unset($_SESSION['correcto']);
			include 'app/views/pages/p.ordcomp_cat1.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
		
	//ORDEN DE COMPRA REGISTRO
	//function OrdCompAlt($PROVEEDOR,$CVE_DOC,$TOTAL,$TIME,$HOY,$IdPreoco,$Consecutivo,$Doc,$Prod,$Costo,$unimed,$facconv,$Cantidad,$Rest){
	//cafaray->function OrdCompAlt($PROVEEDOR,$CVE_DOC,$TOTAL,$TIME,$HOY,$IdPreoco,$Consecutivo,$Doc,$Prod,$Costo,$unimed,$facconv,$Cantidad,$Rest,$consecutivo2){
	function OrdCompAlt($PARTIDAS){

		//	echo $PROVEEDOR.$CVE_DOC.$TOTAL.$TIME.$HOY;
		//echo 'Valor de las partidas enviadas';
		//var_dump($PARTIDAS);
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
			$html = $this->load_page('app/views/pages/p.ordcompVal.php');
		 
			//cafaray -> $rs = $data->ObtieneReg(); <-
			//$id = (int) $rs["COUNT"] + 1; 		
			//echo $id; 
			//$nuvOrdComp = $data->NuevoOrdComp($PROVEEDOR,$CVE_DOC,$TOTAL,$TIME,$HOY,$IdPreoco,$Consecutivo,$Doc,$Prod,$Costo,$unimed,$facconv,$Cantidad,$Rest);
			//$nuvOrdComp = $data->NuevoOrdComp($PROVEEDOR,$CVE_DOC,$TOTAL,$TIME,$HOY,$IdPreoco,$Consecutivo,$Doc,$Prod,$Costo,$unimed,$facconv,$Cantidad,$Rest,$consecutivo2);
			
                        asort($PARTIDAS); //$PROVEEDOR, $CVE_DOC, $TOTAL, $Doc, $TIME, $HOY, $IdPreoco, $Rest, $Prod, $Cantidad, $Costo, $unimed, $facconv
                       $proveedorPrevio = '';
                       $cantidadTotal = 0;
                       $impuestoTotal = 0;
                       $importeTotal = 0;
                       $documento = '';
                        foreach($PARTIDAS as $partida){
                           if($partida[0]!=$proveedorPrevio){
                               // registra orden y primer partida
                               $documento =  $data->NuevoOrdComp($partida[0],$partida[1],$partida[2],$partida[4],$partida[5],$partida[3]);
                               //$nuvOrdComp = $data->NuevoOrdComp($PROVEEDOR,$CVE_DOC,$TOTAL,$TIME,$HOY,$Doc);
                               $proveedorPrevio = $partida[0];
                               $cantidadTotal = 0;
                               $impuestoTotal = 0;
                               $importeTotal = 0;
                           } 
							$cveuser = $_SESSION['user']->USER_LOGIN;
                           // registra partida
                           // $CVE_DOC, $TOTAL, $Doc, $IdPreoco, $Rest, $Prod, $Cantidad, $Costo, $unimed, $facconv
                           $rs = $data->NuevaPartidaOrdenCompra($documento, $partida[6], $partida[7], $partida[8], $partida[9], $partida[10], $partida[11], $partida[12], $cveuser);
                           $cantidadTotal+=$partida[9];
                           $impuestoTotal+=($partida[9]*$partida[10]*.16);
                           $importeTotal+=($partida[9]*$partida[10]);
						   //echo "actualiza totales: $proveedorPrevio para $documento con $cantidadTotal, $impuestoTotal, $importeTotal";
                           $resultado = $data->actualizaTotalOrdenCompra($documento,$cantidadTotal, $impuestoTotal, $importeTotal);
						   $resultado = $data->actualizaTotalPaga($proveedorPrevio,$documento,$importeTotal);
                           //echo $resultado;
                       }
			
			
			

			//$exec = $data->ConsultaOrdenCompAlta();
		
			if($documento != 0){
				ob_start();
				include 'app/views/pages/p.ordcompVal.php';
				//header('Location: index.php?action=ordcomp'); 
			
				$table = ob_get_clean(); 
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
			
				//header('Location: index.php?action=ordcomp&ok=ok');

				//$_SESSION['correcto']="LA ORDEN SE CREO CORRECTAMENTE";
			}else{
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
			}		
			$this->view_page($pagina);
			
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

//MODIFICA Updatepreoc
	function modificaPreOc($provcostid,$provedor,$costo,$total,$nombreprovedor,$cantidad,$rest, $fe){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
			$html = $this->load_page('app/views/pages/p.ordcomp.php');
		ob_start(); 
		$exec = $data->actualizaPreOc($provcostid,$provedor,$costo,$total,$nombreprovedor,$cantidad,$rest, $fe);
		if($exec != 0){
			header('Location: app/views/pages/p.ordcompMod.php');
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	//VERIFICAR PROVEEDOR
	function verificaPreOcProvedor($provedor){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
			$html = $this->load_page('app/views/pages/p.ordcomp.php');
		ob_start(); 
		$exec = $data->valorPreOcProvedor($provedor);
		if($exec != ''){
			header('Location: app/views/pages/p.ordcompVerifica.php?nombreProv='.$exec);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function actualizaCanti($cantn, $idpreoc, $idprov){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			ob_start(); 
			$response = $data->actualizaCanti($cantn, $idpreoc);
			return $response;
	
		}
	}

	//VERIFICAR CVE_ART de INVE01
	function verificaArticulo($Prod){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Compra Venta');				
			$html = $this->load_page('app/views/pages/p.ordcomp.php');
		ob_start(); 

		$exec = $data->valorArticulo($Prod);

		if($exec != ''){
			
			list($unimed,$facconv) = explode("|", $exec);
			//header('Location: app/views/pages/p.ordcompVerifica.php?nombreProv='.$exec);
			//header('Location: index.php?action=ok&unimed='.$unimed); 
			
			$_SESSION['unimed']=$unimed;
			
			$_SESSION["facconv"]=$facconv;
		}else{
			//unset($_SESSION['unimed']);
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
/*#########################################Terminan cambios de OFA#########################################*/


	function EUsuarios(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Consulta Usuario');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/Usuarios/p.ausers.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consulta
		$exec = $data->ConsultaUsur();
		if($exec != ''){
			include 'app/views/pages/Usuarios/p.ausers.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function ModificaUnidad($unidad){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Modifica Usuario');				
			$html = $this->load_page('app/views/pages/p.modificaunidad.php');
			ob_start(); 
			$munidad = $data->ConsultaUnidad($unidad);
		if($munidad != ''){
			include 'app/views/pages/p.modificaUnidad.php';
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function eliminaUn($unidad){
		if($_SESSION['user']){
			$data= new pegaso;
			$elimina = $data->eliminaUn($unidad);
			$this->FUnidades();
		}
	}

	function ActualizaUnidades($numero, $marca, $modelo, $placas, $operador, $tipo, $tipo2, $coordinador, $idu){
		if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
			$redireccionar = 'funidades';
    		$html=$this->load_page('app/views/pages/p.redirectform.php');
    		ob_start();
    			$response = true;
    			$insertaU = $data->ActualizaNUnidad($numero, $marca, $modelo, $placas, $operador, $tipo, $tipo2, $coordinador, $idu);
    			include 'app/views/pages/p.redirectform.php';
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
	
	function ModificaU($mail){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Modifica Usuario');				
		$html = $this->load_page('app/views/pages/Usuarios/p.modifica.php');
		ob_start(); 
		$exec = $data->ConsultaUsurEmail($mail);
		$roles = $data->traeRoles();
		if($exec != ''){
			include 'app/views/pages/Usuarios/p.modifica.php';
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	/*Funcion que actualiza el usuarios*/
	function Actualiza($mail, $usuario, $contrasena, $email, $rol, $estatus){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$data2 = new ftc;
			ob_start(); 
			$exec = $data->ActualizaUsr($mail, $usuario, $contrasena, $email, $rol, $estatus);
			if($exec['status'] == 'ok'){
				$cambio=$data2->cambioSenia($contrasena, $usuario);
				if($cambio['status']=='m'){
					$cambioM=$data->cambioMultiple($contrasena, $actual= 'md5', $usuario , $cambio['empresas']);
				}
			}
			$pagina=$this->load_template('Pedidos');
			$html=$this->load_page('app/views/pages/p.redirectform.php');
			$redireccionar='ausers';
			include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	/*Metodo para asignar componentes*/
	function AsignaComp($componentes, $nombre, $desc){
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Asigna Proceso');		
			/*obtener los checkbox seleccionados*/
			foreach($componentes as $componente){
					$comp [] = $componente;
				
				}			
			//var_dump($comp);
			$html = $this->load_page('app/views/pages/p.cflujo_r.php');			
		//generamos query		
		ob_start(); 	
		$ejec = $data->InsertaComp($comp, $nombre, $desc);	
		//var_dump($ejec);
		if($ejec > 0){			
			$exec = $data->ConsultaComp();
			include 'app/views/pages/p.cflujo_r.php';
			/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
			 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
			 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
		}else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay usuarios registrados</h2>', $pagina);
		}		
		$this->view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function CSesion(){
		session_destroy($_SESSION['user']);
		session_unset($_SESSION['user']);
		$e = "Session Finalizada";
		header('Location: index.php?action=login&e='.urlencode($e)); exit;
	}
	/* METODO QUE CARGA UNA PAGINA DE LA SECCION VIEW Y LA MANTIENE EN MEMORIA
		INPUT
		$page | direccion de la pagina 
		OUTPUT
		STRING | devuelve un string con el codigo html cargado
	*/	
   private function load_page($page){
		return file_get_contents($page);
	}
   
   /* METODO QUE ESCRIBE EL CODIGO PARA QUE SEA VISTO POR EL USUARIO
		INPUT
		$html | codigo html
		OUTPUT
		HTML | codigo html		
	*/
   private function view_page($html){
		echo $html;
	}
   
   /* PARSEA LA PAGINA CON LOS NUEVOS DATOS ANTES DE MOSTRARLA AL USUARIO
		INPUT
		$out | es el codigo html con el que sera reemplazada la etiqueta CONTENIDO
		$pagina | es el codigo html de la pagina que contiene la etiqueta CONTENIDO
		OUTPUT
		HTML 	| cuando realiza el reemplazo devuelve el codigo completo de la pagina
	*/
   private function replace_content($in='/\#CONTENIDO\#/ms', $out,$pagina){
		 return preg_replace($in, $out, $pagina);	 	
	}

	function RegPago(){
        
        if(isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.regpago.php');
        ob_start();
                $exec = $data->ConsultaPagadas();
                if(count($exec) > 0){
                    include 'app/views/pages/p.regpago.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                            }else{
                                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                            }
                            $this->view_page($pagina);
        }else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function insertaDocumento($documento, $archivo, $archivoPdf, $emisorRFC, $emisorNombre, $receptorRFC, $receptorNombre, $fecha, $uuid, $importe){
        $data = new pegaso;
        if($this->validaReceptor($receptorRFC)){        
            if($data->validaEmisor($documento, $emisorRFC)){            
                $response = $data->insertaDocumentoXML($documento, $archivo, $archivoPdf, $emisorRFC, $emisorNombre, $receptorRFC, $receptorNombre, $fecha, $uuid, $importe);                
                return $response;
            } else {
                print"No se ha logrado validar el emisor del documento [$emisorRFC]";
            }
        } else {
            print"No se ha logrado validar el receptor del documento [$receptorRFC]";
        }
    }

    function validaReceptor($receptorRFC){
        if(strtoupper($receptorRFC) == 'FPE980326GH9'){
            return true;
        } else {
            return false;
        }
    }


	function Ordenes(){
        
        if(isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.ordenes.php');
        ob_start();
                $exec = $data->VerOrdenes();
                if(count($exec) > 0){
                    include 'app/views/pages/p.ordenes.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                            }else{
                                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                            }
                            $this->view_page($pagina);
        }else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

	function detalleOrdenCompra($doco){
		
        if(isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.detalleOC.php');
        ob_start();
                $cabecera = $data->OC($doco);
                $detalle = $data->detalleOC_Imp($doco);
                if(count($detalle) > 0){
                    include 'app/views/pages/p.detalleOC.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                            }else{
                                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                            }
                            $this->view_page($pagina);
        }else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function idpor($idd){
		
        if(isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.idpor.php');
        ob_start();
                $pedido = $data->idPreoc($idd);
                $orden = $data->idCompo($idd);
                $recepcion = $data->idCompr($idd);
                if(count($pedido) > 0){
                    include 'app/views/pages/p.idpor.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                            }else{
                                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                            }
                            $this->view_page($pagina);
        }else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function verpago1(){
    	
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verpago1.php');
    		ob_start();
    			$pagos = $data->verPagos();
    			if (count($pagos) > 0){
    				include 'app/views/pages/p.verpago1.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
    }

	function Multipagos(){
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/Tesoreria/p.multipagos.php');
    		ob_start();
    			$efectivos=$data->verEfectivos();
    			$cheques=$data->verCheques();
    			$trans=$data->verTrans();
    			$creditos=$data->verCreditos();
    			if (count($efectivos) > 0 or count ($cheques) > 0 or count ($trans) > 0 or count ($creditos) > 0){
    				include 'app/views/pages/Tesoreria/p.multipagos.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms','<div class="alert-danger"><center><h2>No se encontraron datos para Mostrar</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
    }

	function PXL(){
    	
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.pxl.php');
    		ob_start();
    			$pedidos=$data->verPXL();
       			if (count($pedidos) > 0){
    				include 'app/views/pages/p.pxl.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
    }

    function RechazarPedido($docp, $motivo){
    	
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.pxl.php');
    		ob_start();
    			$rechazar=$data->RechazarPedido($docp, $motivo);
    			$pedidos=$data->verPXL();
       			if (count($pedidos) > 0){
    				include 'app/views/pages/p.pxl.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}

    }




    	function LiberaPedido($pedido){
    	
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.pxl.php');
    		ob_start();
    			$libera=$data->liberaPedido($pedido);
    			$pedidos = $data->verPXL();
       			if (count($pedidos) > 0){
    				include 'app/views/pages/p.pxl.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
    }
    function Pagos_OLD(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
				
		$pagina=$this->load_template('Pagos');				
		$html = $this->load_page('app/views/pages/p.pagos_old.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->Pagos_OLD();
				if(count($exec) > 0){
					include 'app/views/pages/p.pagos_old.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	

    function PagoCorrectoOLD($docuOLD, $tipopOLD, $montoOLD, $nomprovOLD, $cveclpvOLD){
		
		if(isset($_SESSION['user'])){
		$data = new pegaso;
				
		$pagina=$this->load_template('Pagos');				
		$html = $this->load_page('app/views/pages/p.pagoc_old.php');
		ob_start(); 
		
				$error = "Datos guardados correctamente";
				$guarda = $data->GuardaPagoCorrectoOLD($docuOLD, $tipopOLD, $montoOLD, $nomprovOLD, $cveclpvOLD);
				$exec = $data->Pagos_OLD();
				if(count($guarda) > 0){
					include 'app/views/pages/p.pagoc_old.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function OCIMP(){
    	
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.pagosImp.php');
    		ob_start();
    			$efectivosImp=$data->verEfectivosImp();
    			$chequesImp=$data->verChequesImp();
    			$transImp=$data->verTransImp();
    			$creditosImp=$data->verCreditosImp();
    			if (count($efectivosImp) > 0 or count ($chequesImp) > 0 or count ($transImp) > 0 or count ($creditosImp) > 0){
    				include 'app/views/pages/p.pagosImp.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
    }

    function ImprimeOC($oc){
    	$data = new pegaso;
    	$cabecera = $data->OCL($oc);
        $detalle = $data->detalleOC_Imp($oc);
        $pdf = new FPDF('P', 'mm', 'Letter');
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 10 );
			$pdf->Ln(70);
			foreach($cabecera as $t){
				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(7);
			$pdf->Cell(60,10,'Folio Pago: ');
			$pdf->Cell(60,10, $t->TP_TES.' Monto: $ '.number_format($t->PAGO_TES,2));
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Elaborado por: ");
			$pdf->Cell(60,10,$t->REALIZA);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Direccion: ");
			$pdf->Cell(60,10,$t->CALLE." No Ext: ".$t->NUMEXT." No. Int:".$t->NUMINT." Colonia: ".$t->COLONIA);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(7);
			$pdf->Cell(60,10,"Tipo: ");
			$pdf->Cell(60,10,$tipo);
			$pdf->Ln(7);
			}
			$pdf->SetFont('Times','I',9);
			$pdf->Cell(10,7,'Part.',1);			
			$pdf->Cell(20,7,'Articulo',1);
			$pdf->Cell(120,7,'Descr',1);
			$pdf->Cell(20,7,'Cantidad',1);
			$pdf->Cell(25,7,'Total Partida',1);
			$pdf->Ln();	
			$subtotal = 0;
			foreach($detalle as $col){
			    $pdf->Cell(10,7,$col->NUM_PAR,1);
			    $pdf->Cell(20,7,$col->CVE_ART,1);
			    $pdf->Cell(120,7,$col->DESCR,1);
			    $pdf->Cell(20,7,$col->CANT,1,0,'C');
			    $pdf->Cell(25,7,'$ '.number_format($col->TOT_PARTIDA,2),1,0,'R');
			    $pdf->Ln();
			    $subtotal = $subtotal + $col->TOT_PARTIDA;			    
			  }
			 $pdf->Cell(40,7,'');
			 $pdf->Cell(90,7,'');
			 $pdf->Cell(20,7,'');
			 $pdf->Cell(20,7,'SubTotal',1);
			 $pdf->Cell(25,7,'$ '.number_format($subtotal,2),1,0,'R');
			 $pdf->Ln();
			 $pdf->Cell(40,7,'');
			 $pdf->Cell(90,7,'');
			 $pdf->Cell(20,7,'');
			 $pdf->Cell(20,7,'IVA',1);
			 $pdf->Cell(25,7,'$ '.number_format($subtotal*.16,2),1,0,'R');
			 $pdf->Ln();
			 $pdf->Cell(40,7,'');
			 $pdf->Cell(90,7,'');
			 $pdf->Cell(20,7,'');
			 $pdf->Cell(20,7,'Total',1);
			 $pdf->Cell(25,7,'$ '.number_format($subtotal * 1.16,2),1,0,'R');



			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}
			/*Falta crear consulta que traiga el número de folio generado*/
    }

	function ImprimeTrans($id, $doc){
		$data = new pegaso;
		$actstatus = $data->ActStatusImpresoTrans($id, $doc);
		$actruta = $data->ActRuta($id, $doc);
		$datostrans = $data->ObtieneDatosTrans($id);
		$cabecera = $data->OCL($doc);
        $detalle = $data->detalleOC_Imp($doc);

        $banco = $datostrans->BANCO;
        if($baco = 0){
        	$banco = 'No Registrado';
        }elseif($banco = 2){
        	$banco = 'Banamex';
        }elseif($banco = 12){
        	$banco = 'BBVA Bancomer';
        }elseif($banco = 14){
        	$banco = 'Santander';
        }elseif($banco = 21){
        	$banco = 'HSBC';
        }elseif($banco = 36){
        	$banco = 'Inbursa';
        }elseif($banco = 44){
        	$banco = 'Scotiabank';
        }elseif($banco = 72){
        	$banco = 'Banorte';
        }elseif($banco = -1){
        	$banco = 'Efectivo';
        }elseif($banco = 127){
        	$banco = 'Azteca';
        }


		$pdf = new FPDF('P', 'mm', 'Letter');

			$pdf->AddPage();
			$pdf->SetFont('Arial', 'B', 15);
			$pdf->SetTextColor(198,23,23);
			$pdf->SetXY(180,5);
			$pdf->CELL(60,5,$datostrans->TRANS);
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->SetTextColor(14,3,3);
			$pdf->Ln(70);
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$datostrans->FECHA);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Beneficiario: ");
			$pdf->Cell(60,10,$datostrans->BENEFICIARIO);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Banco Receptor: ");
			$pdf->Cell(60,10,$banco);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Documento: ");	
			$pdf->Cell(60,10,$datostrans->DOCUMENTO);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Clabe Interbancaria: ");
			$pdf->Cell(60,10, $datostrans->CLABE);		
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Importe: ");
			$pdf->Cell(60,10, "$ ".$datostrans->MONTO);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha Realizacion: ");
			$pdf->Cell(60,10,$datostrans->FECHA_APLI);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha de Recoleccion: ");
			foreach ($cabecera as $clib){
			$pdf->Cell(60,10,$clib->CAMPLIB3);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Observaciones: ");
			$pdf->Cell(60,10,$clib->STR_OBS);
			$pdf->Ln(30);
			$pdf->Cell(60,10,"_______________________                               __________________");
			$pdf->Ln(5);
			$pdf->Cell(60,10,"Firma de Recibido                                                  Fecha de Recibo ");
			//$pdf->Output('Transferencia '.$datostrans->DOCUMENTO .'.pdf', 'i'); 
			/*Falta crear consulta que traiga el número de folio generado*/
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			}
			foreach($cabecera as $t){

				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}

			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Elaborado por: ");
			$pdf->Cell(60,10,$t->REALIZA);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion: ");
			$pdf->Cell(60,10,$t->CALLE." No Ext: ".$t->NUMEXT." No. Int:".$t->NUMINT." Colonia: ".$t->COLONIA);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Tipo: ");
			$pdf->Cell(60,10,$tipo);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Fecha De Entrega: ");
			$pdf->Cell(60,10,$t->CAMPLIB3);

			$pdf->Ln(12);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(15,7,'Partida',1);
			$pdf->Cell(16,7, 'Pedido',1);			
			$pdf->Cell(18,7,'Articulo',1);
			$pdf->Cell(100,7,'Descr',1);
			$pdf->Cell(15,7,'Cantidad',1);
			$pdf->Cell(20,7,'Total Partida',1);
			$pdf->Ln();	
			foreach($detalle as $col){
			    $pdf->Cell(15,7,$col->NUM_PAR,'L,T,R',0,'C');
			    $pdf->Cell(16,7,$col->COTIZA,'L,T,R');
			    $pdf->Cell(18,7,$col->CVE_ART,'L,T,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,0,55),'L,T,R');
			    $pdf->Cell(15,7,$col->CANT,'L,T,R',0,'C');
			    $pdf->Cell(20,7,'$ '.number_format($col->TOT_PARTIDA,2),'L,T,R',0, 'R');
			    $pdf->Ln();
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(16,7,'','L,B,R');
			    $pdf->Cell(18,7,'','L,B,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,55,110),'L,B,R');
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(20,7,'','L,B,R');
			    $pdf->Ln();					    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}
	


		
	}


		function ImprimeEfectivo($id, $doc){
		$data = new pegaso;
		$actstatus = $data->ActStatusImpresoEfectivo($id);
		$actruta = $data->ActRuta($id, $doc);
		$datostrans = $data->ObtieneDatosEfectivo($id);
		$cabecera = $data->OCL($doc);
        $detalle = $data->detalleOC_Imp($doc);

		$pdf = new FPDF('P', 'mm', 'Letter');
			$pdf->AddPage();
			$pdf->SetFont('Arial', 'B', 15);
			$pdf->SetTextColor(198,23,23);
			$pdf->SetXY(180,5);
			$pdf->CELL(60,5,$datostrans->EFECTIVO);
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->SetTextColor(14,3,3);
			$pdf->Ln(70);
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$datostrans->FECHA);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Beneficiario: ");
			$pdf->Cell(60,10,$datostrans->BENEFICIARIO);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Documento: ");	
			$pdf->Cell(60,10,$datostrans->DOCUMENTO);		
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Importe: ");
			$pdf->Cell(60,10, "$ ".$datostrans->MONTO);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Fecha Realizacion: ");
			$pdf->Cell(60,10,$datostrans->FECHA_APLI);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha de Recoleccion: ");
			foreach ($cabecera as $clib){
			$pdf->Cell(60,10,$clib->CAMPLIB3);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Observaciones: ");
			$pdf->Cell(60,10,$clib->STR_OBS);
			$pdf->Ln(30);
			}
			$pdf->Cell(60,10,"_______________________          _______________________                              __________________");
			$pdf->Ln(5);
			$pdf->Cell(60,10,"Nombre de quien Recibe                  Firma de Recibido                                                  Fecha de Recibo ");
			
			//$pdf->Output('Transferencia '.$datostrans->DOCUMENTO .'.pdf', 'i'); 
			/*Falta crear consulta que traiga el número de folio generado*/
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			foreach($cabecera as $t){
				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Elaborado por: ");
			$pdf->Cell(60,10,$t->REALIZA);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion: ");
			$pdf->Cell(60,10,$t->CALLE." No Ext: ".$t->NUMEXT." No. Int:".$t->NUMINT." Colonia: ".$t->COLONIA);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Fecha De Entrega: ");
			$pdf->Cell(60,10,$t->CAMPLIB3);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Tipo: ");
			$pdf->Cell(60,10,$tipo);
			$pdf->Ln(12);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(15,7,'Partida',1);
			$pdf->Cell(16,7, 'Pedido',1);			
			$pdf->Cell(18,7,'Articulo',1);
			$pdf->Cell(100,7,'Descr',1);
			$pdf->Cell(15,7,'Cantidad',1);
			$pdf->Cell(20,7,'Total Partida',1);
			$pdf->Ln();	
			foreach($detalle as $col){
			    $pdf->Cell(15,7,$col->NUM_PAR,'L,T,R',0,'C');
			    $pdf->Cell(16,7,$col->COTIZA,'L,T,R');
			    $pdf->Cell(18,7,$col->CVE_ART,'L,T,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,0,55),'L,T,R');
			    $pdf->Cell(15,7,$col->CANT,'L,T,R',0,'C');
			    $pdf->Cell(20,7,'$ '.number_format($col->TOT_PARTIDA,2),'L,T,R',0, 'R');
			    $pdf->Ln();
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(16,7,'','L,B,R');
			    $pdf->Cell(18,7,'','L,B,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,55,110),'L,B,R');
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(20,7,'','L,B,R');
			    $pdf->Ln();					    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}


		
	}

	function ImprimeCheque($id, $doc){
		$data = new pegaso;
		$actstatus = $data->ActStatusImpresoCheque($id);
		$actruta = $data->ActRuta($id, $doc);
		$datostrans = $data->ObtieneDatosCheque($id);
		$cabecera = $data->OCL($doc);
        $detalle = $data->detalleOC_Imp($doc);

		$pdf = new FPDF('P', 'mm', 'Letter');
			$pdf->AddPage();
			$pdf->SetFont('Arial', 'B', 15);
			$pdf->SetTextColor(198,23,23);
			$pdf->SetXY(180,5);
			$pdf->CELL(60,5,$datostrans->CHEQUE);
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->SetTextColor(14,3,3);
			$pdf->Ln(70);
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$datostrans->FECHA);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Beneficiario: ");
			$pdf->Cell(60,10,$datostrans->BENEFICIARIO);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Documento: ");	
			$pdf->Cell(60,10,$datostrans->DOCUMENTO);		
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Importe: ");
			$pdf->Cell(60,10, "$ ".$datostrans->MONTO);
			$pdf->Ln(20);
			$pdf->Cell(60,10,"Fecha Realizacion: ");
			$pdf->Cell(60,10,$datostrans->FECHA_APLI);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha de Recoleccion: ");
			foreach ($cabecera as $clib){
			$pdf->Cell(60,10,$clib->CAMPLIB3);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Observaciones: ");
			$pdf->Cell(60,10,$clib->STR_OBS);
			$pdf->Ln(30);
			}
			$pdf->Cell(60,10,"_______________________          _______________________                              __________________");
			$pdf->Ln(5);
			$pdf->Cell(60,10,"Nombre de quien Recibe                  Firma de Recibido                                                  Fecha de Recibo ");
			
			//$pdf->Output('Transferencia '.$datostrans->DOCUMENTO .'.pdf', 'i'); 
			/*Falta crear consulta que traiga el número de folio generado*/
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			foreach($cabecera as $t){

				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Elaborado por: ");
			$pdf->Cell(60,10,$t->REALIZA);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion: ");
			$pdf->Cell(60,10,$t->CALLE." No Ext: ".$t->NUMEXT." No. Int:".$t->NUMINT." Colonia: ".$t->COLONIA);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Fecha De Entrega: ");
			$pdf->Cell(60,10,$t->CAMPLIB3);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Tipo: ");
			$pdf->Cell(60,10,$tipo);
			$pdf->Ln(12);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(15,7,'Partida',1);
			$pdf->Cell(16,7, 'Pedido',1);			
			$pdf->Cell(18,7,'Articulo',1);
			$pdf->Cell(100,7,'Descr',1);
			$pdf->Cell(15,7,'Cantidad',1);
			$pdf->Cell(20,7,'Total Partida',1);
			$pdf->Ln();	
			foreach($detalle as $col){
			    $pdf->Cell(15,7,$col->NUM_PAR,'L,T,R',0,'C');
			    $pdf->Cell(16,7,$col->COTIZA,'L,T,R');
			    $pdf->Cell(18,7,$col->CVE_ART,'L,T,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,0,55),'L,T,R');
			    $pdf->Cell(15,7,$col->CANT,'L,T,R',0,'C');
			    $pdf->Cell(20,7,'$ '.number_format($col->TOT_PARTIDA,2),'L,T,R',0, 'R');
			    $pdf->Ln();
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(16,7,'','L,B,R');
			    $pdf->Cell(18,7,'','L,B,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,55,110),'L,B,R');
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(20,7,'','L,B,R');
			    $pdf->Ln();					    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}


		
	}
	function ImprimeCredito($id, $doc){
		$data = new pegaso;
		$actstatus = $data->ActStatusImpresoCredito($id);
		$actruta = $data->ActRuta($id, $doc);
		$datostrans = $data->ObtieneDatosCredito($id);
		$cabecera = $data->OCL($doc);
        $detalle = $data->detalleOC_Imp($doc);

		$pdf = new FPDF('P', 'mm', 'Letter');
			$pdf->AddPage();
			$pdf->SetFont('Arial', 'B', 15);
			$pdf->SetTextColor(198,23,23);
			$pdf->SetXY(180,5);
			$pdf->CELL(60,5,$datostrans->CREDITO); 
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 11);
			$pdf->SetTextColor(14,3,3);
			$pdf->Ln(70);
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$datostrans->FECHA);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Beneficiario: ");
			$pdf->Cell(60,10,$datostrans->BENEFICIARIO);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Documento: ");	
			$pdf->Cell(60,10,$datostrans->DOCUMENTO);		
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Importe: ");
			$pdf->Cell(60,10, "$ ".$datostrans->MONTO);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha Realizacion: ");
			$pdf->Cell(60,10,$datostrans->FECHA_APLI);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Fecha de Recoleccion: ");
			foreach ($cabecera as $clib){
			$pdf->Cell(60,10,$clib->CAMPLIB3);
			$pdf->Ln(15);
			$pdf->Cell(60,10,"Observaciones: ");
			$pdf->Cell(60,10,$clib->STR_OBS);
			$pdf->Ln(10);
			}
			$pdf->Ln(20);
			$pdf->Cell(60,10,"_______________________          _______________________                              __________________");
			$pdf->Ln(5);
			$pdf->Cell(60,10,"Nombre de quien Recibe                  Firma de Recibido                                                  Fecha de Recibo ");
			
			//$pdf->Output('Transferencia '.$datostrans->DOCUMENTO .'.pdf', 'i'); 

			/*Falta crear consulta que traiga el número de folio generado*/	
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			foreach($cabecera as $t){

				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Elaborado por: ");
			$pdf->Cell(60,10,$t->REALIZA);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion: ");
			$pdf->Cell(60,10,$t->CALLE." No Ext: ".$t->NUMEXT." No. Int:".$t->NUMINT." Colonia: ".$t->COLONIA);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Fecha De Entrega: ");
			$pdf->Cell(60,10,$t->CAMPLIB3);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Tipo: ");
			$pdf->Cell(60,10,$tipo);
			$pdf->Ln(12);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(15,7,'Partida',1);
			$pdf->Cell(16,7, 'Pedido',1);			
			$pdf->Cell(18,7,'Articulo',1);
			$pdf->Cell(100,7,'Descr',1);
			$pdf->Cell(15,7,'Cantidad',1);
			$pdf->Cell(20,7,'Total',1);
			$pdf->Ln();	
			foreach($detalle as $col){
			    $pdf->Cell(15,7,$col->NUM_PAR,'L,T,R',0,'C');
			    $pdf->Cell(16,7,$col->COTIZA,'L,T,R');
			    $pdf->Cell(18,7,$col->CVE_ART,'L,T,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,0,55),'L,T,R');
			    $pdf->Cell(15,7,$col->CANT,'L,T,R',0,'C');
			    $pdf->Cell(20,7,'$ '.number_format($col->TOT_PARTIDA,2),'L,T,R',0, 'R');
			    $pdf->Ln();
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(16,7,'','L,B,R');
			    $pdf->Cell(18,7,'','L,B,R');
			    $pdf->Cell(100,7,substr($col->DESCRIPCION,55,110),'L,B,R');
			    $pdf->Cell(15,7,'','L,B,R');
			    $pdf->Cell(20,7,'','L,B,R');
			    $pdf->Ln();					    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}	
	}

	function verUniRutas($unidad){
		
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verruta.php');
    		ob_start();
    			$rutas=$data->verUnidadesRutas($unidad);
    			if (count($rutas)){
    				include 'app/views/pages/p.verruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function verUniRuta(){
		
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verruta.php');
    		ob_start();
    			$rutas=$data->verUnidadesRuta();
    			if (count($rutas)){
    				include 'app/views/pages/p.verruta.php';
    				$table = ob_get_clean();                                 
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}


	function verUniRutasEdoMex(){
		
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verruta.php');
    		ob_start();
    			$rutas=$data->verUnidadesRutasEdoMex();
    			if (count($rutas)){
    				include 'app/views/pages/p.verruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function FUnidades(){
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.formunidades.php');
    		ob_start();
    		$unidades=$data->verUnidades();
    		include 'app/views/pages/p.formunidades.php';
    		$table = ob_get_clean();
    		if (count($unidades)){
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    		}else{
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No extien unidades por el momento, puede usted crear nuevas unidades.</h2><center></div>', $pagina);
    		}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
	
	function AltaUnidadesF($numero, $marca, $modelo, $placas, $operador, $tipo, $tipo2, $coordinador){
		
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.formunidades.php');
    		ob_start();
    			$insertaU = $data->InsertaNUnidad($numero, $marca, $modelo, $placas, $operador, $tipo, $tipo2, $coordinador);
    			$unidades=$data->verUnidades();

    			if (count($unidades)){
    				include 'app/views/pages/p.formunidades.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function verUnidad($unidad){
		
    	if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verunidad.php');
    		ob_start();
    			$unidades=$data->verUnidad($unidad);
    			if (count($unidades)){
    				include 'app/views/pages/p.verunidad.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function asignaSec($docu, $secu, $unidad, $fechai, $fechaf){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verruta_r.php');
    		ob_start();
    			$secuencia=$data->asignaSecu($docu, $secu, $unidad, $fechai, $fechaf);
    			$rutas=$data->verUnidadesRuta3($unidad);
    			if (count($rutas)){
    				include 'app/views/pages/p.verruta_r.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function RutaUnidad($id){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.verruta_r.php');
    		ob_start();
    			$rutas=$data->verRutasxUnidad($id);
    			if (count($rutas)){
    				include 'app/views/pages/p.verruta_r.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function AdminRuta($tipo){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogistica.php');
    		ob_start();
    		$unidad=$data->CreaSubMenu($tipo);
    		include 'app/views/modules/m.msublogistica.php';
    		$table = ob_get_clean();	
    		if (count($unidad)){
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    		}else{
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No existen documentos en la Administracion de Rutas</h2><center></div>', $pagina);
    		}
    		$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}

	function AdminRutaRep(){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogisticaAdmon.php');
    		ob_start();
    			$tipo = 2;
    			$unidad=$data->CreaSubMenuEntrega($tipo);
    			if (count($unidad)){
    				include 'app/views/modules/m.msublogisticaAdmon.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}
// AdmnRutan nuevo final

	function SubMenuSecuencias(){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogsec.php');
    		ob_start();
    			$tipo ='secuencia';
    			$unidad=$data->CreaSubMenu($tipo);
    			include 'app/views/modules/m.msublogsec.php';
    			$table = ob_get_clean();	
    			if (count($unidad)){
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No Existen documentos de la Pre-Ruta</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}

	function SubMenuSecuenciasRec(){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogsecRec.php');
    		ob_start();
    			$tipo = 1;
    			$unidad=$data->CreaSubMenuEntrega($tipo);
    			if (count($unidad)){
    				include 'app/views/modules/m.msublogsecRec.php';
    				$table = ob_get_clean();
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}

	function AdmonUnidad($idr, $tipo){
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.admonruta.php');
    		ob_start();
    			$unidad=$data->AdmonRutasxUnidad($idr, $tipo);
    			//$entrega=$data->AdmonRutasxUnidadEntrega($idr);
    			if (count($unidad)> 0 or count($entrega)> 0){
    				$_SESSION['unidad_idr'] = $idr;
    				include 'app/views/pages/p.admonruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function AdmonUnidadRep($idr){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.admonrutaRep.php');
    		ob_start();
    			//$unidad=$data->AdmonRutasxUnidad($idr);
    			$entrega=$data->AdmonRutasxUnidadEntrega($idr);
    			$_SESSION['unidad_idr'] = $idr;
    			include 'app/views/pages/p.admonrutaRep.php';
    			$table = ob_get_clean();
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function AdmonUnidadForaneo($idr){		// Controller especial para las entregas foraneas solo se activa cuando la idr = 23 ya que ese id esta asignado a la ruta 102, si algún usuario irresponsable asigna la ruta 102 a otra unidad sin aviso podria provocar que este controller falle 10.08.2016 ICA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.admonrutaForaneo.php');
    		ob_start();
    			#$unidad=$data->AdmonRutasxUnidad($idr);
    			$entrega=$data->AdmonRutasxUnidadEntregaForaneo($idr);
    			if ( count($entrega)> 0){
    				$_SESSION['unidad_idr'] = $idr;
    				include 'app/views/pages/p.admonrutaForaneo.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	
	function DefRuta($doc, $secuencia, $uni, $tipo, $idu){
		
                if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.admonruta.php');
    		ob_start();
    			$define=$data->DefineRuta($doc, $secuencia, $uni, $tipo);
				//$entrega=$data->AdmonRutasxUnidadEntrega2($uni);
				$unidad=$data->AdmonRutasxUnidad2($doc, $secuencia, $uni, $tipo);
				$RO=$data->DefineResultadoFinRO($doc,$tipo);
				if (count($unidad) > 0 ){
    				include 'app/views/pages/p.admonruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
                }else{
                    $e = "Favor de iniciar Sesión";
                    header('Location: index.php?action=login&e='.urlencode($e)); exit;
                }
	}


	function DefRutaRep($doc, $secuencia, $uni, $tipo, $idu){
		
                if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.admonrutaRep.php');
    		ob_start();
    			$define=$data->DefineRuta($doc, $secuencia, $uni, $tipo);
				$entrega=$data->AdmonRutasxUnidadEntrega2($uni);
				$unidad=$data->AdmonRutasxUnidad2($doc, $secuencia, $uni, $tipo);
				$RO=$data->DefineResultadoFinRO($doc,$tipo);
				if (count($unidad) or count($entrega) > 0 ){
    				include 'app/views/pages/p.admonrutaRep.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
                }else{
                    $e = "Favor de iniciar Sesión";
                    header('Location: index.php?action=login&e='.urlencode($e)); exit;
                }
	}

    function DefRutaForaneo($doc,$idu,$guia,$fletera,$cpdestino,$destino,$fechaestimada){	//Define la ruta de la caja para envió foreaneo
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "RutaUnidad&idr={$idu}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->defineRutaForaneo($doc,$guia,$fletera,$cpdestino,$destino,$fechaestimada);
            $RO=$data->DefineResultadoFinRO($doc,'Envio');
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function GuardarGuiaForaneo($ped,$target_file_cc,$idr){ // guarda en la BD la ruta del comprobante guia foraneo ICA
            
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "RutaUnidad&idr={$idr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->guardaGuiaForaneo($ped,$target_file_cc);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }	
    }

	function SecuenciaUnidad($prove, $secuencia, $uni, $fecha, $idu, $doco){
            if (isset($_SESSION['user'])){
	            $data = new pegaso;
	            $pagina=$this->load_template('Pedidos');
	            $html=$this->load_page('app/views/pages/p.secunidad.php');
	            ob_start();
	            $secuenciaDetalle = $data->AsignaSecDetalle($idu, $docs = false); /// obtiene la lista de los documentos de la unidad.
	            $cvedoc = $data->ObiteneDataSecRO($prove, $uni); ///  obtiene la lisat de los documentos de COMPO01
	            $datasec = $data->SecRo($doco, $secuencia); /// Actualiza la tabla del registro de los operadores.
	            $AS=$data->SecUni($prove, $secuencia, $uni, $fecha, $doco);/// Actualiza las partidad de las tablas de cabecera y partidas.
	            $secuencia=$data->AsignaSec2($prove, $secuencia, $uni, $fecha, $idu); /// Muestra las OC 
	            $unidad = $idu; 
	            $this->AsignaSecuencia($unidad); /// envia a la pantalla de Asignacion de secuencias. 
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }	

	function SubMenuFallidos(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msubfallidos.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msubfallidos.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}

	function verFallidos($idf){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.rutafallida.php');
    		ob_start();
    			$fallido=$data->VerFallidos($idf);
    			if (count($fallido)){
    				include 'app/views/pages/p.rutafallida.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function FinalizaRuta($idf, $secuencia, $uni, $motivo, $doc){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.rutafallida.php');
    		ob_start();
    			$motivo=$data->FinalizaRuta($idf, $secuencia, $uni, $motivo, $doc);
    			$fallido=$data->VerFallidos($idf, $secuencia, $uni, $motivo, $doc);
    			if (count($fallido)){
    				include 'app/views/pages/p.rutafallida.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function FinalizaReEnRuta($idf, $motivo, $doc){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.reenrutar.php');
    		ob_start();
    			$motivo=$data->FinalizaReEnRuta($idf, $motivo, $doc);							// <---- Finaliza re enruta consulta de actualización
				$fallido=$data->VerReEnrutar($idf, $motivo, $doc);	
    			if (count($fallido)){
    				include 'app/views/pages/p.reenrutar.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}


	function ocFallidas(){
		
		if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.repfallida.php');
    		ob_start();
    			$fallido=$data->VerOCFallidas();
    			$fallido=$data->verRechazados();
    			include 'app/views/pages/p.repfallida.php';
    			$table = ob_get_clean();
    			$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function VerRutaDia(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.repruta.php');
    		ob_start();
    			$rutadia=$data->VerRutaDia();
    			if (count($rutadia)){
    				include 'app/views/pages/p.repruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	/*function SubMenuRutaDia(){
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'logistica'){
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.msubrutadia.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}*/
	
	function SubMenuRutaDia(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msubrutadia.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msubrutadia.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}

	function RutaXUnidad($idr){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.repruta.php');
                $funcion_actual = __FUNCTION__;
                echo $funcion_actual;
    		ob_start();
    			$rutaxdia=$data->VerRutaXDia($idr);
    			if (count($rutaxdia)){
    				include 'app/views/pages/p.repruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
	}
        
        function ImpResultadosXdiaXuni($unidad){
            $data = new Pegaso;
            $rutaxdia=$data->VerRutaXDia($unidad);
            $datauni = $data->DatosUnidad($unidad);
            $hoy = date("d-m-Y");
            $pdf = new FPDF('P','mm','Letter');
     
            $pdf->AddPage();
            $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
            $pdf->SetFont('Arial', 'B', 12);
            $pdf->Ln(60);
            $pdf->Cell(30,10,"Fecha: ");
            $pdf->Cell(60,10,$hoy);
            $pdf->Ln(8);
            $pdf->Cell(30,10,"Unidad: ");
            $pdf->Cell(60,10,$datauni[0][0]. "  Placas: ". $datauni[0][3]);
            $pdf->Ln(8);
            $pdf->Cell(30,10,"Operador: ");
            $pdf->Cell(60,10,$datauni[0][4]);
            $pdf->Ln(8);
            $pdf->Cell(30,10,"Coordinador: ");
            $pdf->Cell(60,10,$datauni[0][5]);
            $pdf->Ln(12);
       
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(13,6,"Orden",1);
            $pdf->Cell(70,6,"Proveedor",1);
            $pdf->Cell(20,6,"Estado",1);
            $pdf->Cell(12,6,"C.P.",1);
            $pdf->Cell(20,6,"Fecha Orden",1);
            $pdf->Cell(8,6,"Dias",1);
            $pdf->Cell(8,6,"Sec",1);
            $pdf->Cell(20,6,"Fecha cita",1);
            $pdf->Cell(12,6,"Urgente",1);
            $pdf->Cell(15,6,"Resultado",1);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', 'I', 8);
            foreach($rutaxdia as $row){
                if(($row->URGENTE) == 'U'){
                    $pdf->SetDrawColor(255, 133, 102);
                    $pdf->SetFillColor(255, 133, 102);
                }else{
                    $pdf->SetDrawColor(0,0,0);
                    $pdf->SetFillColor(255,255,255);
                }
                $estado = ($row->ESTADOPROV = "ESTADO DE MEXICO") ? "Edo. Mex": $row->ESTADOPROV;
                $pdf->Cell(13,6,$row->CVE_DOC,1,0,'C',true);
                $pdf->Cell(70,6,$row->NOMBRE,1,0,'C',true);
                $pdf->Cell(20,6,$estado,1,0,'C',true);
                $pdf->Cell(12,6,$row->CODIGO,1,0,'C',true);
                $pdf->Cell(20,6,$row->FECHA,1,0,'C',true);
                $pdf->Cell(8,6,$row->DIAS,1,0,'C',true);
                $pdf->Cell(8,6,$row->SECUENCIA,1,0,'C',true);
                $pdf->cell(20,6,$row->CITA,1,0,'C',true);
                $pdf->Cell(12,6,$row->URGENTE,1,0,'C',true);
                $pdf->Cell(15,6,$row->STATUS_LOG,1,0,'C',true);
                $pdf->Ln();
            }
        
            $pdf->Output('Resultados unidad '.$datauni[0][0].'.pdf','i');
        }

	function defineHoraInicio($documento){
		
		if (isset($_SESSION['user'])){
    		$data = new pegaso;    		
			$unidad=$data->asignaHoraInicio($documento);
			$unidad=$data->asignaHoraInicioRO($documento);
			$doc = substr($documento,0,1);
			if($doc == 'O'){
				$this->AdmonUnidad($_SESSION['unidad_idr']);	
			}else{
				$this->AdmonUnidadRep($_SESSION['unidad_idr']);
			}
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
function defineHoraFin($documento){
		
		if (isset($_SESSION['user'])){
    		$data = new pegaso;    		
			$unidad=$data->asignaHoraFin($documento);
			$unidad=$data->asignaHoraFinRO($documento);
			$doc = substr($documento,0,1);
			if($doc == 'O'){
				$this->AdmonUnidad($_SESSION['unidad_idr']);	
			}else{
				$this->AdmonUnidadRep($_SESSION['unidad_idr']);
			}
			}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
	
	function SubMenuTotales(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msubtotales.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msubtotales.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}
												
	function verTotales($idf){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.vertotal.php');
    		ob_start();
    			$fallido=$data->VerTotales($idf);		
    			if (count($fallido)){
    				include 'app/views/pages/p.vertotal.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
/*
	function SubMenuPnoenrutar(){									//Israel---------------
		
		if(isset($_SESSION['user']) && $_SESSION['user']->USER_ROL == 'logistica'){
			$pagina = $this->load_template('Menu Admin');			
			$html = $this->load_page('app/views/modules/m.msubnoenrutar.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}*/
	
	function SubMenuPnoenrutar(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msubnoenrutar.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msubnoenrutar.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}
	
	function verPnoEnrutar($idf){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.parcialnoenrutar.php');
    		ob_start();
    			$fallido=$data->VerPnoEnrutar($idf);	
    			if (count($fallido)){
    				include 'app/views/pages/p.parcialnoenrutar.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

 	function SubMenuReEnrutar(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msubenrutar.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msubenrutar.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		
	}
 
	
	function verReEnrutar($idf){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.reenrutar.php');
    		ob_start();
    			$fallido=$data->VerReEnrutar($idf);	
    			if (count($fallido)){
    				include 'app/views/pages/p.reenrutar.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}
	
	function CorrigeRuta(){								//22-03-2016 ICA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.corrigeruta.php');
    		ob_start();
    			$unidad=$data->Logistica(); 
    			if (count($unidad)){		
    				include 'app/views/pages/p.corrigeruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    					$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}


    //// ver recepciones OFA.

    function verRecepciones(){
        
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.recepcion.php');
            ob_start();
            $Recepciones = $data->verRecepciones();
            //var_dump($Recepciones);
                include 'app/views/pages/p.recepcion.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
              //  $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2> NO SE ENCONTRTON VALIDACIONES PENDIENTES </h2><center></div>', $pagina);
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
    }

function imprimeRecepcion($doc){
		$data = new pegaso;
		//$actRecep = $data->ActStatusImpresoRecep($doc);
		//$datos = $data->ObtieneDatosCredito($id);
		$cabecera=$data->RECEP($doc);
        $detalle=$data->detalleRECEP($doc);

		$pdf = new FPDF('P', 'mm', 'Letter');			
			//$pdf->Output('Transferencia '.$datostrans->DOCUMENTO .'.pdf', 'i'); 
			/*Falta crear consulta que traiga el número de folio generado*/	
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			foreach($cabecera as $t){

				$tipo=$t->CAMPLIB2;
				if($tipo =='E'){
					$tipo='Entrega';
				}elseif ($tipo=='R'){
					$tipo='Recoleccion';
				}else{
					$tipo='No reconocido';
				}
			$pdf->Cell(60,10,"Fecha Recepcion: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"No de Recepcion: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"PROVEEDOR: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"FECHA Orden de Compra: ");
			$pdf->Cell(60,10,$t->FECHAOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Orden de Compra: ");
			$pdf->Cell(60,10,$t->DOC_ANT);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Operador: ");
			$pdf->Cell(60,10,$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Confirmado con: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(20,7,'Partida',1);
			$pdf->Cell(23,7, 'Pedido',1);			
			$pdf->Cell(33,7,'Articulo',1);
			$pdf->Cell(70,7,'Descr',1);
			$pdf->Cell(20,7,'Cantidad',1);
			$pdf->Cell(25,7,'Total Partida',1);
			$pdf->Ln();	
			foreach($detalle as $col){
			    $pdf->Cell(20,7,$col->NUM_PAR,1);
			    $pdf->Cell(23,7,$col->COTIZA,1);
			    $pdf->Cell(33,7,$col->CVE_ART,1);
			    $pdf->Cell(70,7,$col->DESCR,1);
			    $pdf->Cell(20,7,$col->CANT,1);
			    $pdf->Cell(25,7,$col->TOT_PARTIDA,1);
			    $pdf->Ln();					    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('Transferencia'.$t1->CVE_DOC.'.pdf', 'i'); 
			}	
	}

	function CorregirRuta($doc, $tipo, $uni, $tipoA){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.corrigeruta.php');
    		ob_start();
			$define=$data->LinUniOC($doc, $tipo, $uni, $tipoA);
			$unidad=$data->Logistica();
			if (count($unidad)){
    				include 'app/views/pages/p.corrigeruta.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function ComprasMaestro(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina = $this->load_template('Compra Venta');
			$html=$this->load_page('app/views/pages/p.mcompras.php');
			ob_start();
				$consulta1 = $data->CotizacionSinCompra();
				$consulta2 = $data->OCSinPago();
				$consulta3 = $data->OCSinRuta();
				$consulta4 = $data->OCSinRecepcion();
				if(count($consulta1 > 0)){
					include 'app/views/pages/p.mcompras.php';
					$table = ob_get_clean();
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
				}else{
                                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                            }
                            $this->view_page($pagina);
        	}else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        	}
		}

	function ValidaRecepcion($docr, $doco){		//28-03-2016 OFA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.validarec.php');
    		ob_start();
    		$foliovalidacion=$data->FolioValidaRecepcion($docr, $doco);
    		$redireccionar="ValidaRecepcionConFolio&docr={$docr}&doco={$doco}&fval={$foliovalidacion}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
           	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	function validaRecepcionConFolio($docr, $doco, $fval){
			
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.validarec.php');
    		ob_start();
    		$foliovalidacion =$fval;
       		$recep=$data->ValidarRecepcion($docr,$doco);
			$parRecep=$data->PartidasRecep($docr, $doco);
			$parNoRecep=$data->PartidasNoRecep($docr, $doco);
			if (count($recep) > 0 or count($parRecep) >0 or count($parNoRecep)>0){
    				include 'app/views/pages/p.validarec.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}

	/// Cambio OFA OK recpecion modificacion 08 de Abril 2016
	function ValRecepOK($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc,$idordencompra,$par, $fechadoco, $descripcion,$cveart, $fval, $desc1, $desc2, $desc3){	//28-03-2016 OFA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.validarec.php');
    		ob_start();
			$actRecepOk=$data->ActRecepOk($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc,$idordencompra,$par, $fechadoco, $descripcion,$cveart, $fval, $desc1, $desc2, $desc3);
			$parRecep=$data->PartidasRecep($docr, $doco);
			$congruencia = "R";			
			$actRecepOkRO=$data->ActRecepRO($idordencompra,$congruencia);
			if($parRecep){
				$redireccionar="ValidaRecepcionConFolio&docr={$docr}&doco={$doco}&fval={$fval}";
				$pagina=$this->load_template('Pedidos');
            	$html = $this->load_page('app/views/pages/p.redirectform.php');
            	include 'app/views/pages/p.redirectform.php';
            	$this->view_page($pagina);
			}else{
				$redireccionar="recepciones";
				$pagina=$this->load_template('Pedidos');
            	$html = $this->load_page('app/views/pages/p.redirectform.php');
            	include 'app/views/pages/p.redirectform.php';
            	$this->view_page($pagina);
			}		
	    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}		


	function NoSuministrable($id){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.ordcompVal.php');
		$status = $data->StatusNoSuministrable($id);
		include 'app/views/pages/p.ordcompVal.php';
		//ob_start(); 
		//generamos consultas
		/*		$status = $data->StatusNoSuministrable($id);
				$exec = $data->ConsultaOrdenComp('1');
				if(count($exec) > 0){
					include 'app/views/pages/p.ordcomp.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	*/
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function VerNoSuministrableCompras(){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.pednosumuniscom.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->VerNoSuministrableC();
				$execm = $data->VerNoSuministrableCMotivo();
				if(count($exec) > 0){
					include 'app/views/pages/p.pednosumuniscom.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function MotivoNS($id,$motivo){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/redirect/p.pednosumisVal.php');
		include 'app/views/pages/redirect/p.pednosumisVal.php';
		ob_start(); 
		//generamos consultas
				//var_dump($id,$motivo);
				$actualizamotivo = $data->MotivoNoSuministrable($id,$motivo);
			/*	$exec = $data->VerNoSuministrableC();
				if(count($exec) > 0){
					include 'app/views/pages/p.pednosumuniscom.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	*/
		}else{ 
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function VerNoSuministrableVentas(){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.PedNoSuministrablesV.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->VerNoSuministrableV();
				if(count($exec) > 0){
					include 'app/views/pages/p.PedNoSuministrablesV.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
	
	function NoSuministrableV($id,$status){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.PedNoSuministrablesV.php');
		ob_start(); 
		//generamos consultas
				//var_dump($id,$motivo);
				$actualizamotivo = $data->StatusNoSuministrableV($id,$status);
				$exec = $data->VerNoSuministrableV();
				if(count($exec) > 0){
					include 'app/views/pages/p.PedNoSuministrablesV.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function CambiaRecepCost($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc){ //28-03-2016 OFA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.validarec.php');
    		ob_start();
    		///$actCostoPar=$data->ActPXR($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc);
			$actCostoDoc=$data->ActRecCosto($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc);
			$actStatusPar=$data->ActStatusParRec($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc);
			$parNoRecep=$data->PartidasNoRecep($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc); //// Debe de traer la nueva vista de las partidas que no tengan una validacion.

			if (count($parNoRecep)){
    				include 'app/views/pages/p.validarec.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}


 function ImprimeRecepV(){
        
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Pagos');
            $html = $this->load_page('app/views/pages/p.imprecep.php');
            ob_start();
            $Recepciones = $data->verRecepV();
            if (count($Recepciones) > 0) {
                include 'app/views/pages/p.imprecep.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
    }

function ImpSaldoRec($doc){
    	$data = new pegaso;
    	$cabecera = $data->RECEP($doc);
        $detalle = $data->detalleRECEP($doc);

		$pdf = new FPDF('P', 'mm', 'Letter');
			$pdf->AddPage();
			$pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
			$pdf->SetFont('Arial', 'I', 12);
			$pdf->Ln(70);
			foreach($cabecera as $t){
		
			$pdf->Cell(60,10,"Fecha: ");
			$pdf->Cell(60,10,$t->FECHAELAB);
			$pdf->Ln(12);
			$pdf->Cell(60,10,"Documento: ");
			$pdf->Cell(60,10,$t->CVE_DOC);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Nombre: ");
			$pdf->Cell(60,10,$t->NOMBRE);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Direccion 2: ");
			$pdf->Cell(60,10,$t->CODIGO.$t->MUNICIPIO." Telefono :".$t->TELEFONO);
			$pdf->Ln(8);
			$pdf->Cell(60,10,"Recibido por: ");
			$pdf->Cell(60,10,$t->CAMPLIB4);
			$pdf->Ln(8);
			}

			$pdf->SetFont('Times','I',9);

			$pdf->Cell(10,7,'Par',1);			
			$pdf->Cell(20,7,'Articulo',1);
			$pdf->Cell(60,7,'Descr',1);
			$pdf->Cell(20,7,'Cant SAE',1);
			$pdf->Cell(20,7,'Cant Prov',1);
			$pdf->Cell(20,7,'Costo SAE',1);
			$pdf->Cell(20,7,'Costo Prov',1);
			$pdf->Cell(25,7,'Saldo Doc',1);
			$pdf->Ln();	
			foreach($detalle as $col){

			$dif = (($col->COST * $col->CANT) - $col->COST_REC);
			if($dif > 1){
				$dif = $dif;
			}else{
				$dif= 0;
			}

			    $pdf->Cell(10,7,$col->NUM_PAR,1);
			    $pdf->Cell(20,7,$col->CVE_ART,1);
			    $pdf->Cell(60,7,$col->DESCR,1);
			    $pdf->Cell(20,7,$col->CANT,1);
			    $pdf->Cell(20,7,$col->CANT_REC,1);
			    $pdf->Cell(20,7,($col->COST * $col->CANT),1);
			    $pdf->Cell(20,7,$col->COST_REC,1);
			    $pdf->Cell(25,7,$dif,1);
			    $pdf->Ln();			    
			  }
			
			foreach($cabecera as $t1){
			$pdf->Output('ValRecep'.$t1->CVE_DOC.'.pdf', 'i'); 
			}
			//$pdf->Output('ValRecep'.$t1->CVE_DOC.'.pdf', 'i');
			
    }

function ValRecepNo($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc){		//28-03-2016 OFA
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.validarec.php');
    		ob_start();
			$actRecepNo=$data->ActRecepNo($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc);
			$recep=$data->ValidarRecepcion($docr,$doco);
			$parRecep=$data->PartidasRecep($docr, $doco);
			$parNoRecep=$data->PartidasNoRecep($docr, $doco);
			$congruencia = "R";			
			$actRecepOkRO=$data->ActRecepRO($idordencompra,$congruencia);
			////$Recepciones=$data->verRecepcion($docr, $doco, $cantn, $coston, $cantorig, $costoorig, $idpreoc); //// Debe de traer la nueva vista de las partidas que no tengan una validacion.
			if (count($recep)){
    				include 'app/views/pages/p.validarec.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}
	}		

	function CapturaProductos(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/pages/p.capturaproductos.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this->view_page($pagina);
        	}else{
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        	}
	}

	function TraeProveedores($prov){	
		$data = new pegaso;
		$exec = $data->TraeProveedores($prov);
		return $exec;
	}

	function TraeClientes2($clie){
		$data = new pegaso;
		$exec = $data->TraeClientes2($clie);
		return $exec;
	}


	function TraeProductos($prod){	
		$data = new pegaso;
		$exec = $data->TraeProductos($prod);
		return $exec;
	}

	function TraeCveSat($cve){
		$data = new pegaso;
		$exec = $data->TraeCveSat($cve);
		return $exec;
	}

    function VerCat10($alm) {
        
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Pagos');
            $html = '<div class="alert-info"><center><h2>No se han localizado registros</h2><center></div>';
            ob_start();
            $productos = $data->VerCat10($alm);
            if (count($productos) > 0) {
                include 'app/views/pages/p.productos.php';                
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                include 'app/views/pages/p.productos.php';
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
    }

	function editProd($id){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.editproductos.php');
		ob_start(); 
		//generamos consultas
				$prod=$data->EditProd($id);
				if(count($prod) > 0){
					include 'app/views/pages/p.editproductos.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

// CAJAS
	function VerCajas($docf){								//muestra el formulario para crear cajas y la tabla de cajas asignadas a la factura
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.formcajasporfactura.php');
			ob_start(); 
				$validacion = $data->ValidaCajasAbiertas($docf);
				$_SESSION['factura'] = $docf;
				$datafact = $data->DataFactCaja($docf);
				@$exec = $data->CajasXFactura($docf);
				$table = ob_get_clean(); 
					include 'app/views/pages/p.formcajasporfactura.php';
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
					$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 			
	}

	function CrearNuevaCaja($facturanuevacaja){			//Generar una nueva caja para la factura en el parametro.
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$validacion = $data->ValidaCajasAbiertas($_SESSION['factura']);
			if($validacion == 0)$nuevacaja = $data->NuevaCaja($_SESSION['factura']);
			$this->VerCajas($_SESSION['factura']);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 	 	
	}

//FIN CAJAS

/// Asignar el Material a las facturas, primer pantalla para seleccionar la Factura.

	function AsignaMaterial(){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.pedidos.php');
		ob_start(); 
			$pedidos=$data->PorFacturarEntrega(); //// se utiliza la misma que GUstavo 
			///$facturas=$data->FacturaSinMaterial(); /// se deja la consulta actual para las que ya facturo Gustavo 
			if( count($pedidos > 0)){
				include 'app/views/pages/p.pedidos.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function PreparaMaterial($docf, $idcaja){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.preparamaterial.php');
		ob_start(); 
			$facturas=$data->FacturasSinMat($docf, $idcaja); /// Modificacion Implementacion Ventas.

			$parfacturaspar=$data->ParFactMaterialPar($docf, $idcaja); ///  los que ya se embalaron.
			$parfacturas=$data->ParFactMaterial($docf, $idcaja);
			$asignados = $data->paquetes($docf, $idcaja);
			//if(count($facturas)>0 or count($parfacturaspar)>0){
				include 'app/views/pages/p.preparamaterial.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
			//			}else{
			//			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
			//			}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function AsignaEmpaque($idpreoc, $empaque, $idcaja, $tipopaq, $docf){        //23062016
		 
		 if(isset($_SESSION['user'])){
                    $data = new pegaso;				
                    $pagina=$this->load_template('Alta Unidades');				
                    //$html = $this->load_page('app/views/pages/p.preparamaterial.php');
                    ob_start(); 
					$ActPartidas=$data->ActEmpaque($idpreoc, $empaque, $idcaja, $tipopaq, $docf); /// actualiza las partidas para meter la cantida de bultos.
			//echo 'Cotizacion: '.$docf.' Caja: '.$idcaja;
			$redireccionar = "prepararmateriales&docf={$docf}&idcaja={$idcaja}";
             $pagina=$this->load_template('Pedidos');
             $html = $this->load_page('app/views/pages/p.redirectform.php');
             include 'app/views/pages/p.redirectform.php';
             $this->view_page($pagina);    

		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}




	function actualizarProducto($id,$clave,$descripcion,$marca1,$categoria,$desc1,$desc2,$desc3,$desc4,$desc5,$iva,$costo_total,$clave_prov,$codigo_prov1,$costo_prov1,$prov2,$codigo_prov2,$costo_prov2,$unidadcompra,$factorcompra,$unidadventa,$factorventa,$activo){
				 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.editproductos.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->ActualizaProductos($id,$clave,$descripcion,$marca1,$categoria,$desc1,$desc2,$desc3,$desc4,$desc5,$iva,$costo_total,$clave_prov,$codigo_prov1,$costo_prov1,$prov2,$codigo_prov2,$costo_prov2,$unidadcompra,$factorcompra,$unidadventa,$factorventa,$activo);
				$productos = $data->VerCat10(10);
				if(count($exec) > 0){
					include 'app/views/pages/p.productos.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function AltaProductos($clave,$descripcion,$marca1,$categoria,$desc1,$desc2,$desc3,$desc4,$desc5,$iva,$costo_total,$clave_prov,$codigo_prov1,$costo_prov1,$prov2,$codigo_prov2,$costo_prov2,$unidadcompra,$factorcompra,$unidadventa,$factorventa){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.capturaproductos.php');
		ob_start(); 
		//generamos consultas
				$exec = $data->AltaProductos($clave,$descripcion,$marca1,$categoria,$desc1,$desc2,$desc3,$desc4,$desc5,$iva,$costo_total,$clave_prov,$codigo_prov1,$costo_prov1,$prov2,$codigo_prov2,$costo_prov2,$unidadcompra,$factorcompra,$unidadventa,$factorventa);
				if(count($exec) > 0){
					include 'app/views/pages/p.capturaproductos.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function ModificaPreOrden($id){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;	
		$pagina=$this->load_template('Pedidos');				
		//$html = $this->load_page('app/views/modules/m.reporte_result.php');
		$html = $this->load_page('app/views/pages/p.modificapreorden.php');
		/*OB_START a partir de aqui guardara un buffer con la informacion que haya entre este y ob_get_clean(),  
		 * es necesario incluir la vista donde haremos uso de los datos como aqui el arreglo $exec*/
		ob_start(); 
		//generamos consultas
				$exec = $data->DatosPreorden($id);
				//var_dump($exec);
				if(count($exec) > 0){
					include 'app/views/pages/p.modificapreorden.php';
					/* hasta aqui podemos utilizar los datos almacenados en buffer desde la vista, por ejemplo el arreglo $exec 
					 * sin tener que aparecer el arreglo en la vista, ya que lo llama desde memoria (Y), de nuevo, es necesario incluir la vista
					 * desde la cual haremos uso de los datos y luego mandarlo en el replace content como la nueva vista*/
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function AlteraPedidoCotizacion($idPreorden,$claveproducto,$nombreproducto,$costo,$precio,$marca,$claveproveedor,$nombreproveedor,$cotizacion,$partida,$motivo){
		
		 if(isset($_SESSION['user'])){
		$data = new pegaso;
		$redireccionar = "VerNoSuministrableVentas";
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/p.redirectform.php');
		ob_start(); 
				$updatepreoc = $data->UpdatePreoc($idPreorden,$motivo,$costo,$claveproveedor,$nombreproveedor);
				include 'app/views/pages/p.redirectform.php';
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function CancelaPreorden($id,$cotizacion,$partida,$motivo){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;
		$pagina=$this->load_template('Compra Venta');				
		$html = $this->load_page('app/views/pages/redirect/p.vernosuministrableVVal.php');
		ob_start(); 
		//generamos consultas
				$cancelaparfactp = $data->CancelaParFactP($cotizacion,$partida);
				$cabcelapreoc = $data->CancelaPreoc($id,$motivo);
				include 'app/views/pages/redirect/p.vernosuministrableVVal.php';
			/*	$exec = $data->VerNoSuministrableV();
				if(count($exec) > 0){
					include 'app/views/pages/p.PedNoSuministrablesV.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	*/
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}



	function Embalar(){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.embalarmaterial1.php');
		ob_start();
			$paquetes=$data->verCajasAbiertas();
			if(count($paquetes) > 0){
				include 'app/views/pages/p.embalarmaterial1.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function embalaje($docf, $caja){
		
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.embalarmaterial.php');
		ob_start();
			$emba=$data->embalados($docf, $caja);
			$paquetespar=$data->verPaquetesEmb($docf);
            $detallepaq = $data->verDetallePaq($docf);
			if(count($paquetespar) > 0 or count($emba) > 0){
				include 'app/views/pages/p.embalarmaterial.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}
        
        function ImpContenidoCaja($docf,$caja){
            $data = new Pegaso;
            $emba=$data->embalados($docf);
            $datacaja=$data->DataCaja($caja);
            $totales=$data->embaladosTotales($docf, $caja);
            
            //$hoy = date("d-m-Y");
            $pdf = new FPDF('P','mm','Letter');
            $pdf->AddPage();
            $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
            $pdf->SetFont('Arial', 'B', 12);
            $pdf->Ln(60);
            
            foreach($datacaja AS $caj){
                $pdf->Cell(30,10,"Creada: ");
                $pdf->Cell(60,10,$caj->FECHA_CREACION);
                $pdf->Ln(8);
                $pdf->Cell(30,10,"Caja: ");
                $pdf->Cell(60,10,$caj->ID . "  Status: " . $caj->STATUS);
                $pdf->Ln(8);
                $pdf->Cell(30,10,"Documento: ");
                $pdf->Cell(60,10,$caj->CVE_FACT);
                $pdf->Ln(8);
                $pdf->Cell(30,10,"Unidad: ");
                $pdf->Cell(60,10,$caj->UNIDAD);
                $pdf->Ln(12);
            }
       
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(15,6,"Id",1);
            $pdf->Cell(10,6,"Paq",1);
            $pdf->Cell(18,6,"Calve",1);
            $pdf->Cell(100,6,"Descripcion",1);
            $pdf->Cell(15,6,"Cantidad",1);
            #$pdf->Cell(25,6,"Status Logistica",1);
            $pdf->Cell(10,6,"Peso",1);
            $pdf->Cell(15,6,"Tipo",1);
            $pdf->Ln();
        
            $pdf->SetFont('Arial', 'I', 8);
            foreach($emba as $row){
                $pdf->Cell(15,6,$row->ID_PREOC,1);
                $pdf->Cell(10,6,$row->EMPAQUE,1);
                $pdf->Cell(18,6,$row->ARTICULO,1);
                $pdf->Cell(100,6,substr($row->DESCRIPCION,0,55),1);
                $pdf->Cell(15,6,$row->CANTIDAD,1);
                #$pdf->Cell(25,6,$row->STATUS_LOG,1);
                $pdf->Cell(10,6,$row->PESO,1);
                $pdf->Cell(15,6,$row->PAQUETE1. " de ".$row->PAQUETE2,1);
                $pdf->Ln();
            }
           ob_end_clean();
           $pdf->Output('Contenid.pdf','i');
        }

	function asignaembalaje($docf,$paquete1, $paquete2, $tipo, $peso, $alto, $largo, $ancho, $pesovol, $idc, $idemp){      //23062016
		
		 if(isset($_SESSION['user'])){
		$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.embalarmaterial.php');
		ob_start();
			$actembalaje=$data->AsignaEmbalaje($docf,$paquete1, $paquete2, $tipo, $peso, $alto, $largo, $ancho, $pesovol, $idc, $idemp);
			@$emba=$data->embalados($docf,$idc);
			$paquetespar=$data->verPaquetesEmb($docf);
			if(count($paquetespar) > 0 or count($emba > 0)){
				include 'app/views/pages/p.embalarmaterial.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function VerRegistroOperadores($buscar){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.formregistrooperadores.php');
			ob_start(); 
				//$exec = $data->ConsultaPreoc($ped);
				$operador = $data->CabeceraConsultaRO($buscar);
				$exec = $data->ConsultaRO($buscar);
				if(count($exec) > 0){
					include 'app/views/pages/p.formregistrooperadores.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 			
	}

	function VerRutasDelDia(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.RutasDelDia.php');
			ob_start(); 
				$entrega=$data->RutasDelDiaEntrega();
				$exec = $data->RutasDelDia();
				if(count($exec) > 0 or count($entrega) > 0){
					include 'app/views/pages/p.RutasDelDia.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 
	}

	//Cancelar recepciones
	function VerRecepcionesAC(){						//ver recepciones a cancelar
        
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.recepcionesacancelar.php');
            ob_start();
            $recepcion = $data->DataRecepcionesAC();
            //vard_dump($recepcion);
            if (count($recepcion) > 0) {
                include 'app/views/pages/p.recepcionesacancelar.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
    }

    	function FormCR($orden, $recepcion){
		
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.formCancelarRecepcion.php');
            ob_start();
            $recepcioncabecera = $data->DataRecepcionAC($recepcion);
			$partrecepcion = $data->PartidasRecepcionAC($recepcion);
           	if (count($recepcioncabecera) > 0) {
            	include 'app/views/pages/p.formCancelarRecepcion.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }	
	}

	function CancelarRecepcion($orden, $recepcion){
		
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.recepcionesacancelar.php');
            ob_start();
			$statusrecep = $data->StatusComprCR($recepcion);
			$statuspartrecep = $data->StatusPartComprCR($recepcion);
			$statuspreoc = $data->StatusPreocCR($recepcion);
			$statuscompo = $data->StatusCompoCR($recepcion);
			
            $recepcion = $data->DataRecepcionesAC();
            if (count($recepcion) > 0) {
                include 'app/views/pages/p.recepcionesacancelar.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
		
	}

	function VerOrdenesSR(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.ordenesSinrecepcion.php');
			ob_start(); 
				$exec = $data->OrdenSinRecepcion();
				if(count($exec) > 0){
					include 'app/views/pages/p.ordenesSinrecepcion.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
								$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 
	}

	function Cajas(){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.vercajas.php');
			ob_start(); 
				$exec = $data->Cajas();
				if(count($exec) > 0){
					include 'app/views/pages/p.vercajas.php';
						$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
					}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
					}		
					$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 
	}

	function cerrarCaja($idcaja, $docf, $tipo){
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$pagina=$this->load_template('Menu Admin');				
			$html = $this->load_page('app/views/pages/p.vercajas.php');
			ob_start(); 
				$response=$data->CerrarCaja($idcaja, $docf, $tipo);
				return $response; 
		}		
	}


	function UnidadEntrega($idcaja, $docf,  $estado, $unidad){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Pagos');				
			$html = $this->load_page('app/views/pages/Reparto/p.arutaReparto.php');
			ob_start(); 
			//generamos consultas
					$exec = $data->RutaEntregaSecuencia($idcaja, $docf, $estado, $unidad);
					///$regoper = $data->RegistroOperadores($docu,$unidad); se le pude cambiar el docu por docf
					$entrega = $data->ARutaEntrega();
					//$exec = $data->ARuta();  //// estas son las rutas de recoleccion.
					$unidad = $data->TraeUnidades();
					if(count($exec) > 0 or count($entrega) > 0 ){
						include 'app/views/pages/Reparto/p.arutaReparto.php';
						$table = ob_get_clean(); 
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
				}else{
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
				}		
				$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}


	function SecUnidadEntrega($idu, $clie, $unidad, $secuencia, $docf, $idcaja){
		
                if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/Reparto/p.secunidadRec.php');
    		ob_start();
    			$AS=$data->AsignaSecuenciaEntrega($idu, $clie, $unidad, $secuencia, $docf, $idcaja); //// Actualiza la secuencia de las Facturas.
    			$secuenciaentrega=$data->AsignaSecEntrega($idu); /// muestra las Facturas 
    			$secuencia=$data->AsignaSec($idu); ///Muesta las Ordenes de compra.
    			include 'app/views/pages/Reparto/p.secunidadRec.php';
    			$table = ob_get_clean();
    			if (count($secuencia) > 0 or count($secuenciaentrega) > 0){
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No hay mas documentos por recolectar.</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
                }else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
                }
	}

	function aSec($idcaja, $sec, $tipo){
		if(isset($_SESSION['user'])){
			$data=new pegaso;
			$response = $data->AsignaSecuenciaEntrega($idcaja, $sec, $tipo);
			return $response;
		}
	}

	function buscaOC2($doco, $liberadas, $recepcionadas, $validadas){
			
                if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.buscaOC2.php');
    		ob_start();

    			if($doco == 'a'){
    				$ho = 0;
    				}else{
    				$ho = $data->buscaOC2($doco);
    				$liberadas = $data->partidasLiberadas($doco);
    				$validadas = $data->partidasValidadas($doco);
    				$recepcionadas = $data->recepcionDeOrdenes($doco);
    			}
    				include 'app/views/pages/p.buscaOC2.php';
    				$table = ob_get_clean();
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    				$this->view_page($pagina);
                }else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
                }	
	}	



	function historiaIDPREOC($id){
			
                if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/pages/p.historiaIDPREOC.php');
    		ob_start();
    				$historico =$data->historiaIDPREOC($id);
    				//$suministros=$data->suministros($id);
    				$ordenes = 	$data->ordenesIDPREOC($id);
    				$validaciones =$data->validacionesIDPREOC($id);
    				//$recepOC =$data->recepOC($id); /// Recepcion de Orden de compra
    				$recepciones = $data->recepcionesIDPREOC($id);
    				$newrec = $data->recepcionesNuevasIDPREOC($id);

    				include 'app/views/pages/p.historiaIDPREOC.php';
    				$table = ob_get_clean();
    				$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    				$this->view_page($pagina);
                }else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
                }	
	}


	function actPreoc($idpreoc){
		$data = new idpegaso;
		$response = $data->revisaDuplicado($idpreoc);
		return $response; 

	}



//################# Ordenes de compra a avanzar #################
	function VerOrdenesAA(){
		
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.ordenesaavanzar.php');
            ob_start();
            $orden = $data->DataOrdenesAA();
            if (count($orden) > 0) {
                include 'app/views/pages/p.ordenesaavanzar.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
            }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
	}

	function FormAvanzarOrden($idorden){
		
        if (isset($_SESSION['user'])) {
            $data = new pegaso;
            $pagina = $this->load_template('Compra Venta');
            $html = $this->load_page('app/views/pages/p.formavanzarorden.php');
            ob_start();
            $orden = $data->DataOrdenAA($idorden);
			//var_dump($orden);
			$partorden = $data->PartidasOrdenAA($idorden);
           	if (count($partorden) > 0) {
            	include 'app/views/pages/p.formavanzarorden.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            } else {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
         	   }
            $this->view_page($pagina);
        } else {
            $e = "Favor de Iniciar Sesión";
            header('Location: index.php?action=login&e=' . urlencode($e));
            exit;
        }
	}

	function AvanzarOC($idorden, $idpreoc, $partida){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;
			$foliofp = $data->ObtienFolioFalsoPar();
			$foliop = $foliofp[0][0] + 1;
			$avanzaparcompo = $data->AvanzaParCompo($idorden, $partida, $foliop);
			$validapar = $data->ValidarPartidas($idorden);
			if($validapar[0][0] == 0){
				$foliof = $data->ObtienFolioFalso();
				$folio = $foliof[0][0] + 1 ;
				$avanzaparcompo = $data->AvanzaCompo($idorden, $folio);
				$this->VerOrdenesAA();
			}else $this->FormAvanzarOrden($idorden);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		} 	
	}
	
	
//################# FINALIZA Ordenes de compra a avanzar #################

	/// Ver Productos por RFC   VerProdRFC2
	function VerProdRFC(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/pages/p.verprodrfc.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function VerProdRFC2($rfc){
		
       if (isset($_SESSION['user'])) {
           $data = new pegaso;
           $pagina = $this->load_template('Compra Venta');
           $html = $this->load_page('app/views/pages/p.verprodrfc_r.php');
           ob_start();
           $productos = $data->prodxrfc($rfc);
           //// var_dump($productos);
          	if (count($productos) > 0) {
           	include 'app/views/pages/p.verprodrfc_r.php';
               $table = ob_get_clean();
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
           } else {
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	   }
           $this->view_page($pagina);
       } else {
           $e = "Favor de Iniciar Sesión";
           header('Location: index.php?action=login&e=' . urlencode($e));
           exit;
       }
    }

    function valCheck($doco, $idu){
    	if($_SESSION['user']){
    		$data=new pegaso;
    		$response=$data->valCheck($doco, $idu);
    		return $response;
    	}
    }
    
    function ImprimirSecuencia($unidad, $docs){
        $data = new Pegaso;
        $secuencia = $data->AsignaSec($unidad, $docs); /// No se para que sirve solo trae los proveedores de las Ordendes de compra.
        $datauni = $data->DatosUnidad($unidad);  /// Obtiene los datos de la unidad.
        $secuenciaDetalle = $data->AsignaSecDetalle($unidad, $docs); /// Obtiene los documentos que se van a enviar.
        //$avanzaSec=$data->avanzaSec($secuenciaDetalle); /// Debe de cambiar el status de los docuemtos, y quitamos el boton de asignar.
        $AS=$data->SecUni($prove=false, $sec=1, $uni=$unidad, $fecha=date("d-m-Y"), $docs);
        $hoy = date("d-m-Y");
        $pdf = new FPDF('P','mm','Letter'); 
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetFont('Courier', 'B', 20);
        $pdf->SetTextColor(255,0,0);
        $pdf->SetXY(110, 10);
  		$pdf->Write(10,'Ruta Secuencia');
  		$pdf->SetXY(110, 17);
  		$pdf->Write(10,utf8_decode($datauni[0][4]));
  		$pdf->Ln(10);
  		$pdf->SetXY(110, 22);
        $pdf->Write(10,utf8_decode(date("d-m-Y")));
  		$pdf->Ln(13);
        $pdf->SetTextColor(0,0,0);
    	$pdf->Cell(30,10,"Unidad: ");
    	$pdf->Cell(60,10,$datauni[0][0]. "  Placas: ". $datauni[0][3]);
    	$pdf->Ln(12);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(90,6,"Proveedor",1);
        $pdf->Cell(20,6,"Estado",1);
        $pdf->Cell(12,6,"CP",1);
        $pdf->Cell(20,6,"Fecha Orden",1);
        $pdf->Cell(8,6,"Dias",1);
        $pdf->Cell(15,6,"Orden",1);
        $pdf->Cell(15,6,"Unidad",1);
        $pdf->Cell(10,6,"Sec",1);
        $pdf->Ln();
        $pdf->SetFont('Arial', 'I', 8);
        foreach($secuencia as $row){
            $estado = ($row->ESTADOPROV = "ESTADO DE MEXICO") ? "Edo. Mex": $row->ESTADOPROV;
            $pdf->Cell(90,6,$row->NOMBRE."\n",1);
            $pdf->Cell(20,6,$estado,1);
            $pdf->Cell(12,6,$row->CODIGO,1);
            $pdf->Cell(20,6,$row->FECHA,1);
            $pdf->Cell(8,6,$row->DIAS,1);
            $pdf->Cell(15,6,$row->CVE_DOC,1);
            $pdf->Cell(15,6,$row->UNIDAD,1);
            $pdf->Cell(10,6,"",1);
            $pdf->Ln();
            foreach($secuenciaDetalle as $oc){
                if($oc->CVE_CLPV == $row->PROV){
                $pdf->Cell(90,6,$oc->CVE_DOC."    Fecha: ".substr($oc->FECHA_DOC,0,10)."     Dias: ".$oc->DIAS);
                $pdf->Ln();
                }
            }
            $pdf->Ln();
        }
        $pdf->Output('Secuencia unidad '.$datauni[0][0].'.pdf','d');
    }
    
     function ImprimirSecuenciaEnt($unidad, $tipo){
        $data = new Pegaso;
        $secuenciaentrega=$data->AsignaSecEntrega($unidad,$tipo);
        $actualiza = $data->actRutaAdmon($secuenciaentrega, $tipo);
        $pdf = new FPDF('P','mm','Letter');
	    $pdf->AddPage();
	    $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
	    $pdf->SetFont('Courier', 'B', 25);
	    $pdf->SetTextColor(255,0,0);
	    $pdf->SetXY(110, 28);
	    if($tipo == 3){
	    	$titulo = "Recep Logistica";
	    	$titulo2 = " a Bodega ";
	    }elseif($tipo == 1){
	    	$titulo = "Asignacion de";
	    	$titulo2 = " Secuencia ";
	    }elseif ($tipo == 2) {
	    	$titulo = "Resultado de la";
	    	$titulo2 = " Ruta ";
	    }
	  	$pdf->Write(10,$titulo);
	  	$pdf->SetXY(110, 38);
	  	$pdf->Write(10,$titulo2);
        if($unidad !='n/a'){
        	$datauni = $data->DatosUnidad($unidad);	
        	$hoy = date("d-m-Y");
	        $pdf->SetTextColor(0,0,0);
	        $pdf->Ln(20);
	        $pdf->SetFont('Arial', 'B', 12);
			$pdf->Ln(10);
	        $pdf->Cell(30,10,"Fecha: ");
			$pdf->Cell(60,10,$hoy);
			$pdf->Ln(8);	
        	$pdf->Cell(30,10,"Unidad: ");
			$pdf->Cell(60,10,$datauni[0][0]. "  Placas: ". $datauni[0][3]);
			$pdf->Ln(8);
			$pdf->Cell(30,10,"Operador: ");
			$pdf->Cell(60,10,$datauni[0][4]);
			$pdf->Ln(8);
			$pdf->Cell(30,10,"Coordinador: ");
			$pdf->Cell(60,10,$datauni[0][5]);
	        $pdf->Ln(12);	
        }else{
        	$hoy = date("d-m-Y");
	        $pdf->SetTextColor(0,0,0);
	        $pdf->Ln(20);
	        $pdf->SetFont('Arial', 'B', 12);
			$pdf->Ln(10);
	        $pdf->Cell(30,10,"Fecha: ");
			$pdf->Cell(60,10,$hoy);
			$pdf->Ln(8);	
        	$pdf->Cell(30,10,"Unidad: ");
			$pdf->Cell(60,10,'Todas las finalizadas');
			$pdf->Ln(8);
			$pdf->Cell(30,10,"Operador: ");
			$pdf->Cell(60,10,"Todos los operadores");
			$pdf->Ln(8);
			$pdf->Cell(30,10,"Coordinador: ");
			$pdf->Cell(60,10,"Todos los coordinadores");
	        $pdf->Ln(12);	
        }
		$pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(5,6,"Ln",1);
        $pdf->Cell(65,6,"Cliente",1);
        $pdf->Cell(12,6,"Estado",1);
        $pdf->Cell(10,6,"CP",1);
        $pdf->Cell(22,6,"Fecha Factura",1);
        $pdf->Cell(6,6,"Dias",1);
        $pdf->Cell(13,6,"Pedido",1);
        $pdf->Cell(30,6,"Remision / Factura",1);
        $pdf->Cell(17,6, "Importe",1);
        if($tipo== 1 ){
        	$pdf->Cell(20,6,"Sec",1);
        }elseif($tipo == 2){
        	$pdf->Cell(20,6,"Fin",1);
        }elseif($tipo ==3){
        	$pdf->Cell(20,6,"Final",1);
        }
        $pdf->Ln();
        $pdf->SetFont('Arial', 'I', 7);
        $i = 0;
        foreach($secuenciaentrega as $row){
        	$i++;
        	//echo 'ESTADO LOGISTICA: '.$row->STATUS_LOG.' Y EL ESTATUS RECEPCION: '.$row->STATUS_RECEPCION;
        	if(($row->STATUS_LOG == 'admon' and $row->STATUS_RECEPCION == 1) OR ($row->STATUS_LOG != 'admon' and $row->STATUS_RECEPCION == 2 or $row->STATUS_RECEPCION == 1)  ){
        		$estado = ($row->ESTADO = "ESTADO DE MEXICO") ? "Edo. Mex": $row->ESTADOPROV;
	            $pdf->Cell(5,6,$i,'L,R,T');
	            $pdf->Cell(65,6,substr($row->NOMBRE,0,40),'L,R,T');
	            $pdf->Cell(12,6,$estado,'L,R,T');
	            $pdf->Cell(10,6,$row->CODIGO,'L,R,T');
	            $pdf->Cell(22,6,substr($row->FECHAELAB,0,10),'L,R,T');
	            $pdf->Cell(6,6,$row->DIAS,'L,R,T');
	            $pdf->Cell(13,6,$row->CVE_FACT,'L,R,T');
	            $pdf->Cell(30,6,$row->REMISION." / ".$row->FACTURA,'L,R,T');
	            $pdf->Cell(17,6,'$ '.number_format($row->IMPORTE,2),'L,R,T');
	            $pdf->Cell(20,6,$row->STATUS_LOG,'L,R,T');
	            $pdf->Ln();
	            $pdf->Cell(5,6,'','L,R,B');
	            $pdf->Cell(65,6,substr($row->NOMBRE, 41, 100),'L,R,B');
		        $pdf->Cell(12,6,'','L,R,B');
		        $pdf->Cell(10,6,'','L,R,B');
		        $pdf->Cell(22,6,substr($row->FECHAELAB,11,20),'L,R,B');
		        $pdf->Cell(6,6,'','L,R,B');
		        $pdf->Cell(13,6,'','L,R,B');
		        $pdf->Cell(30,6,$row->ID,'L,R,B');
		        $pdf->Cell(17,6,'','L,R,B');
		        if($tipo==1){
		          	$pdf->Cell(20,6,'','L,R,B');
		        }elseif($tipo ==2){
		          	$pdf->Cell(20,6,'','L,R,B');	
		        }elseif ($tipo == 3){
		        	$pdf->Cell(20,6,'','L,R,B');
		        }
		        $pdf->Ln();
        		
        	}elseif($row->STATUS_RECEPCION == 3 OR $row->STATUS_RECEPCION == 4){
        		$estado = ($row->ESTADO = "ESTADO DE MEXICO") ? "Edo. Mex": $row->ESTADOPROV;
        		$pdf->Cell(5,6,$i,'L,R,T');
	            $pdf->Cell(65,6,substr($row->NOMBRE,0,40),'L,R,T');
	            $pdf->Cell(12,6,$estado,'L,R,T');
	            $pdf->Cell(10,6,$row->CODIGO,'L,R,T');
	            $pdf->Cell(22,6,substr($row->FECHAELAB,0,10),'L,R,T');
	            $pdf->Cell(6,6,$row->DIAS,'L,R,T');
	            $pdf->Cell(13,6,$row->CVE_FACT,'L,R,T');
	            $pdf->Cell(30,6,$row->REMISION." / ".$row->FACTURA,'L,R,T');
	            $pdf->Cell(17,6,'$ '.number_format($row->IMPORTE,2),'L,R,T');
	            $pdf->Cell(20,6,$row->STATUS_LOG,'L,R,T');
	            $pdf->Ln();
	            $pdf->Cell(5,6,'','L,R,B');
	            $pdf->Cell(65,6,substr($row->NOMBRE, 41, 100),'L,R,B');
		        $pdf->Cell(12,6,'','L,R,B');
		        $pdf->Cell(10,6,'','L,R,B');
		        $pdf->Cell(22,6,substr($row->FECHAELAB,11,20),'L,R,B');
		        $pdf->Cell(6,6,'','L,R,B');
		        $pdf->Cell(13,6,'','L,R,B');
		        $pdf->Cell(30,6,$row->ID,'L,R,B');
		        $pdf->Cell(17,6,'','L,R,B');
		        if($tipo==1){
		          	$pdf->Cell(20,6,'','L,R,B');
		        }elseif($tipo ==2){
		          	$pdf->Cell(20,6,'','L,R,B');	
		        }elseif ($tipo == 3){
		        	$pdf->Cell(20,6,'','L,R,B');
		        }
		        $pdf->Ln();
        	}   
        }
        if($unidad != 'n/a'){
 			$pdf->Output($titulo.$titulo2.'unidad '.$datauni[0][0].'.pdf','i');
        }else{
			$pdf->Output($titulo.$titulo2.'.pdf','i');
        }
    }
    ///RecibeDocs
    function RecibeDocs($doc, $docf, $docr){
        
       if (isset($_SESSION['user'])) {
           $data = new pegaso;
           $pagina = $this->load_template('Compra Venta');
           $html = $this->load_page('app/views/pages/p.aruta.php');
           ob_start();
           $recibedoc = $data->recibirDoc($doc, $docf, $docr);
           $exec = $data->ARuta();
           $entrega = $data->ARutaEntrega();
           $unidad = $data->TraeUnidades();
           if (count($exec) > 0 or count ($entrega) > 0){
           include 'app/views/pages/p.aruta.php';
               $table = ob_get_clean();
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
           } else {
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	   }
           $this->view_page($pagina);
       } else {
           $e = "Favor de Iniciar Sesión";
           header('Location: index.php?action=login&e=' . urlencode($e));
           exit;
       }
    }

    function RecibeDocsReparto($doc, $docf, $docr){
        
       if (isset($_SESSION['user'])) {
           $data = new pegaso;
           $pagina = $this->load_template('Compra Venta');
           $html = $this->load_page('app/views/pages/p.arutaReparto.php');
           ob_start();
           $recibedoc = $data->recibirDoc($doc, $docf, $docr);
           //$exec = $data->ARuta();
           $entrega = $data->ARutaEntrega();
           $unidad = $data->TraeUnidades();
           if (count ($entrega) > 0){
           include 'app/views/pages/p.arutaReparto.php';
               $table = ob_get_clean();
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
           } else {
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	   }
           $this->view_page($pagina);
       } else {
           $e = "Favor de Iniciar Sesión";
           header('Location: index.php?action=login&e=' . urlencode($e));
           exit;
       }
    }

    function CierreRuta(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogistica_c.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msublogistica_c.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		

	}

    function CierreRutaRep(){
		
			if (isset($_SESSION['user'])){
    		$data = new pegaso;
    		$pagina=$this->load_template('Pedidos');
    		$html=$this->load_page('app/views/modules/m.msublogistica_c_Rep.php');
    		ob_start();
    			$unidad=$data->CreaSubMenu();
    			if (count($unidad)){
    				include 'app/views/modules/m.msublogistica_c_Rep.php';
    				$table = ob_get_clean();
    					$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
    			}else{
    				$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
    			}
    			$this->view_page($pagina);
    	}else{
    		$e = "Favor de iniciar Sesión";
    		header('Location: index.php?action=login&e='.urlencode($e)); exit;
    	}		

	}

	function CierraRutaUnidad($idr){
		
       if (isset($_SESSION['user'])) {
           $data = new pegaso;
           $pagina = $this->load_template('Compra Venta');
           $html = $this->load_page('app/views/pages/p.cierreruta.php');
           ob_start();
           $close=$data->habilitaImpresionCierre($idr);
           $close_ent=$data->habilitaImpresionCierreEnt($idr);
           $rutaunidadrec = $data->RutaUnidadRec($idr);
           $rutaunidadent = $data->RutaUnidadEnt($idr);
           if (count($rutaunidadrec) > 0 or count($rutaunidadent) > 0){
           include 'app/views/pages/p.cierreruta.php';
               $table = ob_get_clean();
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
           } else {
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	   }
           $this->view_page($pagina);
       } else {
           $e = "Favor de Iniciar Sesión";
           header('Location: index.php?action=login&e=' . urlencode($e));
           exit;
       }

	}



	function CierraRutaUnidadRep($idr){
		
       if (isset($_SESSION['user'])) {
           $data = new pegaso;
           $pagina = $this->load_template('Compra Venta');
           $html = $this->load_page('app/views/pages/p.cierrerutaRep.php');
           ob_start();
           //$close=$data->habilitaImpresionCierre($idr);
           $close_ent=$data->habilitaImpresionCierreEnt($idr);
           //$rutaunidadrec = $data->RutaUnidadRec($idr);
           $rutaunidadent = $data->RutaUnidadEnt($idr);
           if (count($rutaunidadent) > 0){
           include 'app/views/pages/p.cierrerutaRep.php';
               $table = ob_get_clean();
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
           } else {
               $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	   }
           $this->view_page($pagina);
       } else {
           $e = "Favor de Iniciar Sesión";
           header('Location: index.php?action=login&e=' . urlencode($e));
           exit;
       }

	}


	 function CerrarRutaRep($doc, $idr, $tipo, $idc){
    	
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.cierrerutaRep.php');
            ob_start();	
            	////$close_ent=$data->habilitaImpresionCierreEnt($idr); /// No esta hablitado.
            	$cerraroc = $data->CerrarOC($doc,$idr,$tipo,$idc);
               	/// $rutaunidadrec = $data->RutaUnidadRec($idr);
           		////$rutaunidadent = $data->RutaUnidadEnt($idr);
           		$redireccionar = "CierraRutaRep&idr={$idr}";
             	$pagina=$this->load_template('Pedidos');
             	$html = $this->load_page('app/views/pages/p.redirectform.php');
             	include 'app/views/pages/p.redirectform.php';
             	$this->view_page($pagina);
            }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }

    }


function AsignaSecuencia($unidad){
        
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.secunidad.php');
            ob_start();
                $secuenciaDetalle = $data->AsignaSecDetalle($unidad, $docs = false);
                $unidades=$data->TraeUnidades();
                
                //$secuenciaentrega=$data->AsignaSecEntrega($unidad);
                //$secuencia=$data->AsignaSec($unidad);
                if (count($secuenciaDetalle) > 0){
                    include 'app/views/pages/p.secunidad.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function cambiaPOCuni($poc, $idu){
    	if($_SESSION['user']){
    		$data=new pegaso;
    		$response =$data->cambiaPOCuni($poc, $idu);
    		return $response;
    	}
    }

  	function AsignaSecuenciaRec($unidad, $tipo){
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Reparto/p.secunidadRec.php');
            ob_start();
            	$unidades = $data->TraeUnidades();
                $secuenciaDetalle = $data->AsignaSecDetalle($unidad, $docs= false);
                $secuenciaentrega=$data->AsignaSecEntrega($unidad, $tipo);
                //$secuencia=$data->AsignaSec($unidad);
                include 'app/views/pages/Reparto/p.secunidadRec.php';
                $table = ob_get_clean();    
                if (count($secuenciaentrega) > 0){
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>Ya no hay mas documentos por enviar.</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

   function finRutaLog($idcaja, $fin, $tipo){
   		if($_SESSION['user']){
   			$data=new pegaso;
   			$response = $data->finRutaLog($idcaja, $fin, $tipo);
   			return $response;
   		}
   }

  function RecogeDocs($doc, $idr,$docs){
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.cierreruta_r.php');
            ob_start();
                $regresadocs = $data->RegresaDocs($doc, $idr, $docs);
                $rutaunidadrec = $data->RutaUnidadRec($idr);
           		$rutaunidadent = $data->RutaUnidadEnt($idr);
                include 'app/views/pages/p.cierreruta_r.php';
                $table = ob_get_clean();    
                if (count($rutaunidadrec) or (count($rutaunidadent) > 0)){
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No hay mas documentos por recoger.</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    
    function CerrarRuta($doc, $idr, $tipo, $idc){
    	
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.cierreruta.php');
            ob_start();
            	$close=$data->habilitaImpresionCierre($idr);
            	$close_ent=$data->habilitaImpresionCierreEnt($idr);
            	$cerraroc = $data->CerrarOC($doc,$idr,$tipo,$idc);
               	$rutaunidadrec = $data->RutaUnidadRec($idr);
           		$rutaunidadent = $data->RutaUnidadEnt($idr);
                if (count($rutaunidadrec) or (count($rutaunidadent) > 0)){
                    include 'app/views/pages/p.cierreruta.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }

    }





    function cierrerutagen(){
    	
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.cierrerutagenrec.php');
            ob_start();
            	$permitircerrar=$data->CerrarGen();
               	$rutaunidadrec = $data->RutaUnidadRecGen();       		
                if (count($rutaunidadrec)){
                    include 'app/views/pages/p.cierrerutagenrec.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function CerrarRecoleccion(){
    	
            if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.cierrerutagenrec.php');
            ob_start();
            	$permitircerrar=$data->CerrarGen();
               	$rutaunidadrec = $data->RutaUnidadRecGen();       		
                if (count($rutaunidadrec)){
                    include 'app/views/pages/p.cierrerutagenrec.php';
                    $table = ob_get_clean();
                        $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                }else{
                    $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
                }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function CerrarRec($documentos){        //27062016
        ob_start();
    	$data = new Pegaso;
        $cierre = $data->insCierreRutaRecoleccion();
        $recoleccion=$data->RutaUnidadRecGen(); 
        $data->CerrarRutasRecoleccion($documentos); 

        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->SetX(180);
        $pdf->Write(8,"Folio: ");
        foreach($cierre as $fl){
        	$pdf->Write(8,$fl->NUEVOFOLIO);
        }

        $pdf->Ln();
        $pdf->Cell(12,6,"OC",1);
        $pdf->Cell(72,6,"PROVEEDOR",1);
        $pdf->Cell(24,6,"FECHA ORDEN",1);
        $pdf->Cell(10,6,"PAGO T",1);
        $pdf->Cell(24,6,"FECHA PAGO",1);

        $pdf->Cell(10,6,"UNIDAD",1);
        $pdf->Cell(11,6,"TIPO",1);

        $pdf->Cell(8,6,"DCC",1);
        $pdf->Cell(15,6,"CERRADO?",1); 
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($recoleccion as $row){
            $pdf->Cell(12,6,$row->CVE_DOC,1);
            $pdf->Cell(72,6,$row->NOMBRE,1);
            $pdf->Cell(24,6,$row->FECHAELAB,1);
            $pdf->Cell(10,6,$row->PAGO_TES,1);
            $pdf->Cell(24,6,$row->FECHA_PAGO,1);

            $pdf->Cell(10,6,$row->UNIDAD,1);
            $pdf->Cell(11,6,$row->STATUS_LOG,1);

            $pdf->Cell(8,6,$row->DOCS,1);
            $pdf->Cell(15,6,$row->CIERRE_UNI,1);
            $pdf->Ln();
        }
        
        
        ob_get_clean();
        $pdf->Output('Cierre Recoleccion.pdf','i');
    }

    function RVentasVsCobrado($fechaini, $fechafin, $vend){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.reportevendidovscobrado.php');
        ob_start();
        $ventcob=$data->VentasVsCobrado($fechaini, $fechafin, $vend);      		
        if (count($ventcob)){
            include 'app/views/pages/p.reportevendidovscobrado.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function ImprimirRecepcion($orden){
        $data = new Pegaso;
        $parRecep=$data->PartidasNoRecep("0",$orden);
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(10,6,"ID",1);
        $pdf->Cell(15,6,"Recep",1);
        $pdf->Cell(5,6,"Par",1);
        $pdf->Cell(55,6,"Descripcion",1);
        $pdf->Cell(10,6,"Unidad",1);
        $pdf->Cell(10,6,"Orde",1);
        $pdf->Cell(10,6,"Valida",1);
        $pdf->Cell(15,6,"Monto",1);
        $pdf->Cell(10,6,"Saldo",1);
        $pdf->Cell(10,6,"PXR",1);

        $pdf->Cell(15,6,"SubTot",1);
        $pdf->Cell(15,6,"IVA",1);
        $pdf->Cell(15,6,"Total",1);
      
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
            
            $total_oc = 0;
            $total_subtotal = 0;
            $total_iva = 0;
            $total_final = 0;
        foreach($parRecep as $row){
            
            $total_subtotal += ($row->COST_REC * $row->CANT_REC);
            $total_iva += ($row->COST_REC * $row->CANT_REC)* 0.16;
            $total_final += ($row->COST_REC * $row->CANT_REC) * 1.16;
            $total_oc += $row->TOT_PARTIDA;
            
            $pdf->Cell(10,6,$row->ID_PREOC,'L,T,R');
            $pdf->Cell(15,6,trim($row->CVE_DOC),'L,T,R');
            $pdf->Cell(5,6,$row->NUM_PAR,'L,T,R');
            $pdf->Cell(55,6,substr($row->DESCR,0,34),'L,T,R');
            $pdf->Cell(10,6,$row->UNI_ALT,'L,T,R');
            $pdf->Cell(10,6,$row->CANT,'L,T,R');
            $pdf->Cell(10,6,$row->CANT_REC,'L,T,R');
            $pdf->Cell(15,6,round($row->TOT_PARTIDA,2),'L,T,R');
            $pdf->Cell(10,6,round($row->SALDO,2),'L,T,R');
            $pdf->Cell(10,6,$row->PXR,'L,T,R');
            $pdf->Cell(15,6,round(($row->COST_REC * $row->CANT_REC),2),'L,T,R'); ///  Subtotal
            $pdf->Cell(15,6,round((($row->COST_REC * $row->CANT_REC) * 0.16),2),'L,T,R'); /// Costo antes de IVA 
            $pdf->Cell(15,6,round((($row->COST_REC * $row->CANT_REC) * 1.16),2),'L,T,R'); /// Costo Total con IVA s           
            $pdf->Ln();								// Segunda linea descripcion
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(5,6,"",'L,B,R');
            $pdf->Cell(55,6,substr($row->DESCR,34,70),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
      
            $pdf->Ln();
        }
        
        $res = round($total_oc,2);
        $res2 = (round($total_subtotal,2));

        if( (round($total_oc,2) - round($total_subtotal,2)) < 2 and (round($total_oc,2) - round($total_subtotal,2) > -2)) $mensaje = "SALDADO";
            elseif(round($total_oc,2) - round > round($total_subtotal,2)) $mensaje = "DEUDOR";
                else $mensaje = "ACREDOR";
        
        $pdf->SetFont('Arial', 'B',44);
        $pdf->Ln(8);
        $pdf->SetX(30);
        $pdf->Write(6,$mensaje);
                
        $pdf->SetFont('Arial', 'B',12);

        $pdf->Ln(60);  
        $pdf->SetX(140);
        $pdf->Write(6,"Subtotal       $ ".number_format($total_subtotal,2,'.',','));
        $pdf->Ln();
        $pdf->SetX(140);
        $pdf->Write(6,"I.V.A.         $ ".number_format($total_iva,2,'.',','));
        $pdf->Ln();
        $pdf->SetX(140);
        $pdf->Write(6,"Total          $ ".number_format($total_final,2,'.',','));
        $pdf->Ln();
        
        $pdf->Output('Secuencia entrega unidad .pdf','i');
    }
    
     function VerCatalogoGastos(){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.catalogogastos.php');
        ob_start();
        $exec=$data->VerCatGastos();  
        if (count($exec)){
            include 'app/views/pages/p.catalogogastos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    

    
    function GuardarNuevaCuenta($concepto, $descripcion, $iva, $cc, $cuenta, $gasto, $presupuesto, $retieneiva, $retieneisr, $retieneflete){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $redireccionar = 'Catalogo_Gastos';			
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            ob_start();
            echo $retieneiva . $retieneisr . $retieneflete;
            $gastos=$data->guardarNuevaCuenta($concepto, $descripcion, $iva, $cc, $cuenta, $gasto, $presupuesto, $retieneiva, $retieneisr, $retieneflete);
            include 'app/views/pages/p.redirectform.php';        
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    /*editado por GDELEON 3/Ago/2016*/
    function EditCuentaGasto($id){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.formeditcuentagasto.php');
        ob_start();
        $exec=$data->editCuentaGasto($id); 
        $provgasto=$data->traeProveedoresGasto(); 
        if (count($exec)){
            include 'app/views/pages/p.formeditcuentagasto.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

        function NuevaCtaGasto(){
        
        if (isset($_SESSION['user'])){
        	$data=new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.formnuevacuentagasto.php');
            //$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
            ob_start();
            $tipog=$data->traeTipoGasto();
            	include 'app/views/pages/p.formnuevacuentagasto.php';
            	$table=ob_get_clean();
            	$pagina=$this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            	$this->view_page($pagina);
           // ob_start();
           // $gastos=$data->VerCatGastos();  
          //include 'app/views/pages/p.formnuevacuentagasto.php';
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function GuardarCambiosCuenta($concepto, $descripcion, $iva, $cc, $cuenta, $gasto, $presupuesto, $id, $retieneiva, $retieneisr, $retieneflete, $activo, $cveprov){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $redireccionar = 'Catalogo_Gastos';			
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            ob_start();
            $gastos=$data->guardarCambiosCuenta($concepto, $descripcion, $iva, $cc, $cuenta, $gasto, $presupuesto, $id, $retieneiva, $retieneisr, $retieneflete, $activo, $cveprov);
            include 'app/views/pages/p.redirectform.php';        
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function DelCuentaGasto($id){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $redireccionar = 'Catalogo_Gastos';			
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            ob_start();
            $gastos=$data->delCuentaGasto($id);
            include 'app/views/pages/p.redirectform.php';        
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function ImpCatalogoCuentas(){
        $data = new Pegaso;
        $exec=$data->VerCatGastos();  

        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(8,5,"ID",1);
        $pdf->Cell(23,5,"Clave",1);
        $pdf->Cell(39,5,"Concepto",1);
        $pdf->Cell(44,5,"Descripcion",1);
        $pdf->Cell(7,5,"IVA",1);
        $pdf->Cell(22,5,"Centro de costos",1);
        $pdf->Cell(21,5,"Cuenta Contable",1);
        $pdf->Cell(10,5,"Gasto",1);
        $pdf->Cell(23,5,"Presupuesto",1);
        $pdf->Ln(10);
        
        //$pdf->SetFont('Arial', 'I', 7);
        
        foreach($exec as $row){
            
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(8,10,"$row->ID",1);
        $pdf->Cell(23,10,"$row->CLAVE",1);
        $pdf->Cell(39,10,"$row->CONCEPTO",1);

        $pdf->Cell(44,10,"$row->DESCRIPCION",1);

        $pdf->Cell(7,10,"$row->CAUSA_IVA",1);
        $pdf->Cell(22,10,"$row->CENTRO_COSTOS",1);
        $pdf->Cell(21,10,"$row->CUENTA_CONTABLE",1);
        $pdf->Cell(10,10,"$row->GASTO",1);
        $pdf->Cell(23,10,'$ ' . number_format($row->PRESUPUESTO,2,'.',','),1);
        $pdf->Ln(10);
        }
        
        
        $pdf->Output('Catalogo de cuentas.pdf','i');
    }
    
    function reEnrutar($doco, $id_preoc, $pxr){		
		if(isset($_SESSION['user'])){
			$data = new pegaso;	
			ob_start();
			$liberar=$data->ReEnrutar($id_preoc, $pxr, $doco);
			$this->verDeudores();

			}else{
				$e = "Favor de iniciar sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}

	}


function liberaPendientes($doco, $id_preoc, $pxr, $par){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;	
			$pagina=$this->load_template('PXR');				
			$html = $this->load_page('app/views/pages/p.pxr.php');
			ob_start();
			$liberar=$data->LiberarPartidasNoRecibidas($doco, $id_preoc, $pxr, $par);
			$exec = $data->ListaPartidasNoRecibidas();
			header("Location: index.php?action=verDeudores");
			$this ->view_page($pagina);
			}else{
				$e = "Favor de iniciar sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}

	}

	function liberaPendientes2($doco, $id_preoc, $pxr, $par){
		if(isset($_SESSION['user'])){
			$data = new pegaso;	
			ob_start();
			$liberar=$data->LiberarPartidasNoRecibidas($doco, $id_preoc, $pxr, $par);
		}
	}

    function FormCapturaGasto(){
            if(isset($_SESSION['user'])){
            $data = new pegaso;	
            $pagina=$this->load_template('PXR');				
            $html = $this->load_page('app/views/pages/Tesoreria/p.formnuevogasto.php');
            ob_start();
            $exec = $data->traeConceptoGastos();
            $prov = $data->traeProveedoresGastos();
            $clasificacion = $data->traeClasificacionGastos();
            if($exec != ''){
            	include 'app/views/pages/Tesoreria/p.formnuevogasto.php';
		$table = ob_get_clean();
		$pagina = $this->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
            }else{
		$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
            }
            $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
        }


        
    function GuardarNuevoGasto($concepto,$proveedor,$referencia,$autorizacion,$presupuesto,$tipopago,$monto,$movpar,$numpar,$usuario,$fechadoc,$fechaven,$clasificacion){
            if(isset($_SESSION['user'])){
            $data = new pegaso;	
            $pagina=$this->load_template('pedidos');				
            $html = $this->load_page('app/views/pages/p.formnuevogasto.php');
            ob_start();
            $exec = $data->traeImpuestoGasto($concepto);
            $gasto = $data->guardarNuevoGasto($concepto,$proveedor,$referencia,$autorizacion,$presupuesto,$tipopago,$monto,$movpar,$numpar,$usuario,$fechadoc,$fechaven,$exec,$clasificacion);
            if($gasto != ''){
                header('Location: index.php?action=form_capturagastos');
            }else{
				$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
            }
            $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
    }
        
        function Clasificacion_gastos(){
            
            if(isset($_SESSION['user'])){
            $data = new pegaso;	
            $pagina=$this->load_template('pedidos');				
            $html = $this->load_page('app/views/pages/p.clasificacionesgastos.php');
            ob_start();
            $exec = $data->traeClasificacionGastos();
            if(count($exec) > 0){
            	include 'app/views/pages/p.clasificacionesgastos.php';
		$table = ob_get_clean();
		$pagina = $this->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
            }else{
		$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
            }
            $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
        }
        
        function NuevaClaGasto(){
        
        if (isset($_SESSION['user'])){
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.formnuevaclasificaciongasto.php');
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
            $this->view_page($pagina);
           // ob_start();
           // $gastos=$data->VerCatGastos();  
           // include 'app/views/pages/p.formnuevacuentagasto.php';
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
        }
        
        function EditClaGasto($id){
            
            if(isset($_SESSION['user'])){
                $data = new pegaso;	
                $pagina=$this->load_template('pedidos');				
                $html = $this->load_page('app/views/pages/p.formeditacg.php');
                ob_start();
                $exec = $data->dataClasificacion($id);
                if(count($exec) > 0){
                    include 'app/views/pages/p.formeditacg.php';
                    $table = ob_get_clean();
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms' , $table, $pagina);
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                }
                $this ->view_page($pagina);
            }else{
                $e = "Favor de iniciar sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
        }
        
        function GuardaCambiosClasG($id,$clasif,$descripcion,$activo){
            
            if(isset($_SESSION['user'])){
                $data = new pegaso;	
                $pagina=$this->load_template('pedidos');				
                $html = $this->load_page('app/views/pages/p.clasificacionesgastos.php');
                ob_start();
                $exec = $data->guardaCambiosCG($id,$clasif,$descripcion,$activo);
                if($exec != ''){
                    header('Location: index.php?action=clasificacion_gastos');
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                }
                $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
        }
        
        function GuardaNuevaClaGasto($clasif,$descripcion){
            
            if(isset($_SESSION['user'])){
                $data = new pegaso;	
                $pagina=$this->load_template('pedidos');				
                $html = $this->load_page('app/views/pages/p.clasificacionesgastos.php');
                ob_start();
                $exec = $data->guardaNuevaClaGasto($clasif,$descripcion);
                if($exec != ''){
                    header('Location: index.php?action=clasificacion_gastos');
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                }
                $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
        }


      function verEntregas(){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verentregas.php');
        ob_start();
        $entregas=$data->verEntregas(); 
        if (count($entregas)){
            include 'app/views/pages/p.verentregas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }


    function insContra($cr, $idc, $docf){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verentregas.php');
        ob_start();
        $insertcr=$data->insContra($cr, $idc, $docf);
        $entregas=$data->verEntregas(); 
        if (count($entregas)){
            include 'app/views/pages/p.verentregas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }


    function recibirMercancia2(){
 		$redireccionar = "recibirMercancia";
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        include 'app/views/pages/p.redirectform.php';
        $this->view_page($pagina); 
    }


    function recibirMercancia(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/Bodega/p.vernoentregas.php');
        ob_start();
        $entregas=$data->verNoEntregas(); 
        if (count($entregas)){
            include 'app/views/pages/Bodega/p.vernoentregas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }

    function recmercancia($id, $docf){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.recmercancia.php');
        ob_start();
        $embalaje=$data->verembalaje($id, $docf); 
        if (count($embalaje)){
            include 'app/views/pages/p.recmercancia.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function procesarDev($idp , $cantDev, $tipo, $origen){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $response=$data->procesarDev($idp, $cantDev, $tipo, $origen); 
        return $response;
    }
  }

  function verRecepSinProcesar(){
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/Bodega/p.verRecepSinProcesar.php');
        ob_start();
        $devoluciones=$data->verRecepSinProcesar(); 
        if (count($devoluciones) >= 1){
            include 'app/views/pages/Bodega/p.verRecepSinProcesar.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
  }


    function recibirCaja($id, $docf, $idc){     //21062016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $redireccionar = 'recibirMercancia';			
	$html = $this->load_page('app/views/pages/p.redirectform.php');
        ob_start();
        $embalaje=$data->recibeCaja($id, $docf, $idc); 
        include 'app/views/pages/p.redirectform.php';
        $this->recibirMercancia();
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function recibirCajaNC($id, $docf, $idc, $idpreoc, $cantr, $motivo){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        ob_start();
        $recibirnc=$data->recibirCajaNC($id, $docf, $idc, $idpreoc, $cantr, $motivo); 
        $redireccionar ="recmercancianc&id={$idc}&docf={$docf}";	
			 $pagina=$this->load_template('Pedidos');
             $html = $this->load_page('app/views/pages/p.redirectform.php');
             include 'app/views/pages/p.redirectform.php';
             $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

      function recmercancianc($id,$docf){
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/Bodega/p.recmercancianc.php');
        ob_start();
        $embalaje=$data->verembalaje($id, $docf); 
        $devuelto=$data->devueltoNC($id, $docf);
        if (count($embalaje) or count($devuelto)){
            include 'app/views/pages/Bodega/p.recmercancianc.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function verFacturas(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturas.php');
        ob_start();
        $facturas=$data->verFacturas(); 
        if (count($facturas)){
            include 'app/views/pages/p.verFacturas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }

    function recDocFact($docf, $docp, $idcaja, $tipo){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturas.php');
        ob_start();
        $actDoc = $data->recDocFact($docf, $docp, $idcaja, $tipo);
        $facturas=$data->verFacturas(); 
        if (count($facturas)){
            include 'app/views/pages/p.verFacturas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

        function recDocFactNC($docf, $docp, $idcaja, $tipo){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturasNc.php');
        ob_start();
        $actDoc = $data->recDocFactNC($docf, $docp, $idcaja, $tipo);
        $nc=$data->verNCFactura(); 
        if (count($nc)){
            include 'app/views/pages/p.verFacturasNc.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }


    function avanzaCobranza($docf, $docp, $idcaja, $tipo, $nstatus){          //21
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturas.php');
        ob_start();
        $actDoc = $data->avanzaCobranza($docf, $docp, $idcaja, $tipo, $nstatus);
        $facturas=$data->verFacturas(); 
        if (count($facturas)){
            include 'app/views/pages/p.verFacturas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

   

    function impCompFact($docf, $docp, $idcaja, $tipo, $idcliente){       //21
        $data = new Pegaso;
        $factura = $data->verFacturasCompF($docf, $docp, $idcaja);
        $revision = $data->insertaRevFact($docf, $docp, $idcaja, $tipo);
        $documentos = $data->traeDocumentosCliente($idcliente);
        $statuscaja = $data->actualizaStatusCaja($idcaja);

        $pdf = new FPDF('P','mm','Letter');
     
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 10);
        foreach($revision as $data){
            $pdf->SetX(160);
            $pdf->Write(6,"Folio de revision : ".$data->IDREVISION);
        }
        $pdf->Ln();
        foreach($factura as $row){
            $pdf->Cell(40,6,"Factura: ".$row->FACTURA);
            $pdf->Ln();
            $pdf->Cell(40,6,"Fecha de factura: ".$row->FECHA_FACTURA);
            $pdf->Ln();
            $pdf->Cell(100,6,"Cliente: ".$row->CLIENTE);
            $pdf->Ln();
            $pdf->Cell(50,6,"Pedido: ".$row->PEDIDO,0,30);
            $pdf->Cell(30,6,"Caja: ".$row->CAJA);
            $pdf->Cell(50,6,"Unidad: ".$row->UNIDAD);
            $pdf->Ln();
            $pdf->Cell(40,6,"Status losgistica: ".$row->RESULTADO);
            $pdf->Ln();
        }
        $pdf->Ln(5);
        $pdf->SetX(80);
        $pdf->Write(8,"Documentos entregados:");  
        $pdf->Ln(9);
        $pdf->Cell(60,6,"Documento",1);
        $pdf->Cell(90,6,"Descripcion",1);
        $pdf->Cell(35,6,"Copias requeridas",1);
        $pdf->Ln();
        foreach($documentos as $doc){
            $pdf->Cell(60,6,$doc->NOMBRE,1);
            $pdf->Cell(90,6,$doc->DESCRIPCION,1);
            $pdf->Cell(35,6,$doc->COPIAS,1);
            $pdf->Ln();
        }
        
        $pdf->Ln(75);
        $pdf->Cell(20,6,"");
        $pdf->Cell(60,6,"Nombre y firma de entrega",'T');
        $pdf->Cell(20,6,"");
        $pdf->Cell(60,6,"Nombre y firma de recibido",'T');
        
        ob_get_clean();
        $pdf->Output('Secuencia entrega unidad .pdf','i');
      }


    function impRecMercancia($id, $docf, $docr, $fact){
    	ob_start();
    	$data = new Pegaso;
    	$folio=$data->FolioRecMcia($id, $docf, $docr, $fact);
        $exec = $data->statusImpresoCaja($id);
        $embalaje=$data->verembalaje($id, $docf);
               
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->SetX(145);
        foreach($folio as $fl){
        $pdf->Write(8,"Folio: ".$fl->ID);
        $pdf->Ln(4);
        $pdf->SetX(145);
        $pdf->Write(8,"Usuario que Recibo : ".$fl->USUARIO);
        $pdf->Ln(4);
        $pdf->SetX(145);
        $pdf->Write(8,"Fecha Recepcion: ".$fl->FECHA_RECEP);
        $pdf->Ln(4);
        $pdf->SetX(145);
        $pdf->Write(8,"Factura: ".$fl->FACTURA);
        $pdf->Ln(4);
        $pdf->SetX(145);
        $pdf->Write(8,"Remision: ".$fl->REMISION);
        }

        $pdf->Ln();
        $pdf->Cell(10,6,"ID",1);
        $pdf->Cell(8,6,"Env",1);
        $pdf->Cell(15,6,"Documento",1);
        $pdf->Cell(10,6,"Caja",1);
        $pdf->Cell(15,6,"Fecha",1);
        $pdf->Cell(8,6,"PAQ",1);
        $pdf->Cell(15,6,"Clave",1);
        $pdf->Cell(50,6,"Descripcion",1);
        $pdf->Cell(10,6,"Cant",1);
        $pdf->Cell(10,6,"PAQ1",1);
        $pdf->Cell(8,6,"De",1);
        $pdf->Cell(10,6,"PAQ2",1);
        $pdf->Cell(15,6,"Tipo",1);
        $pdf->Cell(10,6,"Peso",1);
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($embalaje as $row){
            $pdf->Cell(10,6,$row->ID_PREOC,'L,T,R');
            $pdf->Cell(8,6,$row->TIPO_ENVIO,'L,T,R');
            $pdf->Cell(15,6,$row->DOCUMENTO,'L,T,R');
            $pdf->Cell(10,6,$row->IDCAJA,'L,T,R');
            $pdf->Cell(15,6,$row->FECHA_PAQUETE,'L,T,R');
            $pdf->Cell(8,6,$row->EMPAQUE,'L,T,R');
            $pdf->Cell(15,6,$row->ARTICULO,'L,T,R');
            $pdf->Cell(50,6,substr($row->DESCRIPCION,0,30),'L,T,R');
            $pdf->Cell(10,6,$row->CANTIDAD,'L,T,R');
            $pdf->Cell(10,6,$row->PAQUETE1,'L,T,R');
            $pdf->Cell(8,6,"de",'L,T,R');
            $pdf->Cell(10,6,$row->PAQUETE2,'L,T,R');
            $pdf->Cell(15,6,$row->TIPO_EMPAQUE,'L,T,R');
            $pdf->Cell(10,6,$row->PESO,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(8,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(8,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(50,6,substr($row->DESCRIPCION,30,60),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(8,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Ln();
        }
        
        $pdf->Ln(50);
        $pdf->Cell(50,8,"FECHA IMPRESION : ".date("d-m-Y"));
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(45,8,"Nombre y firma recibido",'T');
        $pdf->Cell(35,8,"");
        $pdf->Cell(55,8,"Nombre y firma de quien entrega",'T');
        
        ob_get_clean();
        $pdf->Output('Rmercancia.pdf','i');

    }

    /*modificado por GDELEON 3/Ago/2016*/
    function DelClaGasto($id){
            
            if(isset($_SESSION['user'])){
                $data = new pegaso;	
                $pagina=$this->load_template('pedidos');				
                ob_start();
                $exec = $data->delClaGasto($id); //delClaGasto
                if($exec != ''){
                    header('Location: index.php?action=clasificacion_gastos');
                }else{
                    $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                }
                $this ->view_page($pagina);
            }else{
            $e = "Favor de iniciar sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
    }

    //14062016
    function CatalogoDocumentos(){
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/Clientes/p.catalgo_documentos.php'); 
        ob_start();
        $exec=$data->traeDocumentosxCliente(); 
        if (count($exec)){
            include 'app/views/pages/Clientes/p.catalgo_documentos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function NuevoDocumentoC(){
        if (isset($_SESSION['user'])){
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Clientes/p.form_nuevodocc.php');
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function GuardaNuevoDocC($nombre, $descripcion, $tipoDoc, $tipoReq){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $exec = $data->guardaNuevoDocC($nombre, $descripcion, $tipoDoc, $tipoReq);
            header('Location: index.php?action=catalogo_documentos');
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function FormEditaDocumentoC($id){
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.form_editdocc.php'); 
        ob_start();
        $exec=$data->traeDocumentoC($id);
        if (count($exec)){
            include 'app/views/pages/p.form_editdocc.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function EditaDocumentoC($activo,$nombre,$descripcion,$id, $tipoReq, $tipoDoc){
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $exec = $data->guardaCambiosDocC($activo, $nombre, $descripcion, $id, $tipoReq, $tipoDoc);
            header('Location: index.php?action=catalogo_documentos');
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function CatDocumentosXCliente(){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Clientes/p.catalogo_documentosxcliente.php'); 
            ob_start();
            $exec=$data->traeClientesParaDocs(); 
            include 'app/views/pages/Clientes/p.catalogo_documentosxcliente.php';
            $table = ob_get_clean();     
            if (count($exec)){
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            }else{
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                    }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function VerDocumentosCliente($clave){
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Clientes/p.documentosdelcliente.php'); 
            ob_start();
            $_SESSION['ClaveCliente']=$clave;
            $cliente = $data->TraeCliente($clave);
            $exec=$data->traeDocumentosCliente($clave); 
            include 'app/views/pages/Clientes/p.documentosdelcliente.php';
            $table = ob_get_clean();
            if (count($exec)){
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            }else{
                $pagina = $this->replace_content('/\CONTENIDO\#/ms',$table.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                    }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function ordenaDocs($clie, $iddoc, $orden){
    	if(isset($_SESSION['user'])){
    		$data = new pegaso;
    		$response = $data->ordenaDocs($clie, $iddoc, $orden);
    		return $response;
    	}
    }
    
    function quitarReq($cl, $iddoc){
    	if($_SESSION['user']){
    		$data = new pegaso;
    		$response = $data->quitarReq($cl, $iddoc);
    		return $response;
    	}
    }

    function formNuevoDocCliente($clave){
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            //var_dump($clave);
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Clientes/p.form_nuevodoccliente.php'); 
            ob_start();
            $clie = $data->TraeCliente($clave);            
            $exec=$data->traeDocumentosxCliente(); 
            if (count($exec)){
                include 'app/views/pages/Clientes/p.form_nuevodoccliente.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            }else{
                $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                    }
                $this->view_page($pagina);
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function asignaNuevoDocCliente($cliente,$requerido,$copias,$documento){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "documentos_cliente";
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/p.redirectform.php');//
            $cli = $data->TraeCliente($cliente);
            $exec = $data->NuevoDocCliente($cliente,$requerido,$copias,$documento);
            if($exec){
                $mensaje = '<div class="alert-info"><center><h2>Requisito asignado correctamente</h2><center></div>';
                //header('Location: index.php?action=documentos_cliente');
                include 'app/views/pages/p.redirectform.php';
            }else{
                $mensaje = '<div class="alert-info"><center><h2>Error: El requisito no se asigno.</h2><center></div>';
                include 'app/views/pages/p.redirectform.php';
            }
            
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function recibosMercanciaImp(){         //21062016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verentregasimpresas.php');
        ob_start();
        $entregas=$data->verNoEntregasImpresas(); 
        if (count($entregas)){
            include 'app/views/pages/p.verentregasimpresas.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    //21062016 final

        function guardaContraRecibo($contrarecibo,$idcaja){     //22062016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "mercanciaRecibidaImp";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->guardaContraRecibo($contrarecibo,$idcaja);
            include 'app/views/pages/p.redirectform.php';
            //header('Location: index.php?action=mercanciaRecibidaImp');
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function ReenviarCaja($factura,$caja){
    	
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "pantalla2";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->reenviaCaja($factura,$caja);
            include 'app/views/pages/p.redirectform.php';
            //header('Location: index.php?action=mercanciaRecibidaImp');
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function formDataCobranzaC($idCliente){     //24062016	
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html=$this->load_page('app/views/pages/Clientes/p.form_nuevosdatoscobranza.php');
            ob_start();
            $banco = $data->CuentasBancos();
            $exec=$data->datosCobranzaC($idCliente);
            $datosMaestro=$data->traeMaestros();
            $cli = $idCliente;
            if (count($exec)){
                include 'app/views/pages/Clientes/p.form_editadatoscobranza.php';   
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
                
            }else{

                include 'app/views/pages/Clientes/p.form_nuevosdatoscobranza.php';
                $table = ob_get_clean();
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            }
        $this->view_page($pagina);
           
        }else{
            $e = "Favor de iniciar Sesión";
            header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function CerrarVentana(){
    	
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.cerrarventana.php');
            include 'app/views/pages/p.cerrarventana.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function salvaCambiosDatosCob($cliente,$carteraCob,$carteraRev,$diasRevision,$diasPago,$dosPasos,$plazo,$addenda,$portal,$usuario,$contrasena,$observaciones,$envio,$cp,$maps,$tipo,$ln,$pc, $bancoDeposito, $bancoOrigen, $referEdo, $metodoPago){
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "documentos_cliente";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvarCambiosCobranza($cliente,$carteraCob,$carteraRev,$diasRevision,$diasPago,$dosPasos,$plazo,$addenda,$portal,$usuario,$contrasena,$observaciones,$envio,$cp,$maps,$tipo,$ln,$pc, $bancoDeposito, $bancoOrigen, $referEdo, $metodoPago);
           	$redireccionar='documentos_cliente';
            include 'app/views/pages/p.redirectform.php';
            //$this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }  
    }
    
    function salvaDatosCob($cliente,$carteraCob,$carteraRev,$diasRevision,$diasPago,$dosPasos,$plazo,$addenda,$portal,$usuario,$contrasena,$observaciones,$envio,$cp,$maps,$tipo,$ln,$pc, $bancoDeposito, $bancoOrigen, $referEdo, $metodoPago){ //28062016
    	
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "documentos_cliente";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvarDatosCobranza($cliente,$carteraCob,$carteraRev,$diasRevision,$diasPago,$dosPasos,$plazo,$addenda,$portal,$usuario,$contrasena,$observaciones,$envio,$cp,$maps,$tipo,$ln,$pc, $bancoDeposito, $bancoOrigen, $referEdo, $metodoPago);
            var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function cierreReparto(){       //27062016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verdocscierreentrega.php');
        ob_start();
        $entregas=$data->verCierreDiaEntregas(); 
        if (count($entregas)){
            include 'app/views/pages/p.verdocscierreentrega.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
  
   
    function generarCierreEnt(){      //27062016   
        ob_start();
    	$data = new Pegaso;

        $entregas=$data->verCierreDiaEntregas(); 
        $cierre=$data->insertCierreDiaEntregas();

        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->SetX(180);
        $pdf->Write(8,"Folio: ");
        foreach($cierre as $fl){
        	$pdf->Write(8,$fl->NUEVOFOLIO);
        }

        $pdf->Ln();
        $pdf->Cell(10,6,"CAJA",1);
        $pdf->Cell(12,6,"PEDIDO",1);
        $pdf->Cell(75,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(24,6,"FECHA FACTURA",1);
        $pdf->Cell(20,6,"REMISION",1);
        $pdf->Cell(24,6,"FECHA REMISION",1);
        $pdf->Cell(15,6,"ESTATUS",1);
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($entregas as $row){
            $pdf->Cell(10,6,$row->ID,1);
            $pdf->Cell(12,6,$row->CVE_FACT,1);
            $pdf->Cell(75,6,$row->NOMBRE,1);
            $pdf->Cell(15,6,$row->FACTURA,1);
            $pdf->Cell(24,6,$row->FECHAFAC,1);
            $pdf->Cell(20,6,trim($row->REMISION),1);
            $pdf->Cell(24,6,$row->FECHAREM,1);
            $pdf->Cell(15,6,$row->STATUS_LOG,1);
            $pdf->Ln();
        }
        
        
        ob_get_clean();
        $pdf->Output('Rmercancia.pdf','i');
    } 

    function imprimeCierre($idu){
    	//ob_start();
    	$data = new pegaso;
        $exec = $data->imprimeCierre($idu);
        $cabecera = $data->imprimeCierreCab($idu);
        $actcierre=$data->actCierreUni($idu);
        $pdf=new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        //$pdf->SetFont('Arial','B',12);
   		//$pdf->Ln(65);
        foreach ($cabecera as $cab){
        $pdf->SetFont('Arial', 'I', 12);
        $pdf->Ln(65);  
        $pdf->Cell(10,6,"Unidad: ".$cab->UNIDAD);
        $pdf->Ln();
        $pdf->Cell(10,6,"Operador: ");
        $pdf->Ln();
        $pdf->Cell(10,6,"Fecha Secuencia: ".$cab->FECHA_SECUENCIA);
        $pdf->Ln();
        $pdf->Cell(10,6,"Resultado:");
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Ln();
        $pdf->Cell(18,6,"DOCUMENTO",1);
        $pdf->Cell(28,6,"FECHA DOCUMENTO",1);
        $pdf->Cell(30,6,"PROVEDOR",1);
        $pdf->Cell(18,6,"COSTO DOC",1);
        $pdf->Cell(11,6,"PAGO",1);
        $pdf->Cell(27,6,"FECHA PAGO",1);
        $pdf->Cell(13,6,"UNDIDAD",1);
        $pdf->Cell(8,6,"SEC",1);
        $pdf->Cell(10,6,"FIN",1);
        //$pdf->Cell(10,6,"REALIZA",1);
        //$pdf->Cell(15,6,"DOCS",1);
        $pdf->Cell(15,6,"CIERRRE",1);
        }
        $pdf->Ln();

        $pdf->SetFont('Arial', 'I', 7);     
        foreach($exec as $row){
            $pdf->Cell(18,6,$row->CVE_DOC,'L,T,R');
            $pdf->Cell(28,6,$row->FECHA_DOC,'L,T,R');
            $pdf->Cell(30,6,$row->NOMBRE.'('.$row->CVE_CLPV.')','L,T,R');
            $pdf->Cell(18,6,$row->CAN_TOT,'L,T,R');
            $pdf->Cell(11,6,$row->TP_TES,'L,T,R');
            $pdf->Cell(27,6,$row->FECHA_PAGO,'L,T,R');
            $pdf->Cell(13,6,$row->UNIDAD,'L,T,R');
            $pdf->Cell(8,6,$row->SECUENCIA,'L,T,R');
            $pdf->Cell(10,6,$row->STATUS_LOG,'L,T,R');
            //$pdf->Cell(10,6,$row->REALIZA,'L,T,R');
           // $pdf->Cell(10,6,$row->DOCS,'L,T,R');
            $pdf->Cell(15,6,$row->CIERRE_UNI,'L,T,R');
            $pdf->Ln();
        }
    
        $pdf->Ln(20);
        //$pdf->Cell(50,8,"FECHA: ".date("d-m-Y"));
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(45,8,"Nombre y firma recibido",'T');
        $pdf->Cell(35,8,"");
        $pdf->Cell(55,8,"Nombre y firma de quien entrega",'T');
        ob_get_clean();
        $pdf->Output('cierre.pdf', 'i');

    }

    function SMCarteraRevision(){     //2806
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubcarterasrevision.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        $saldos=$data->saldoCartera();
        if (count($exec)){
            include 'app/views/modules/m.msubcarterasrevision.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function VarCartera($cr){           //04072016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.vercarterarevision.php');
        ob_start();
        $cart = $cr; // Variable para el boton de imprimir cartera del día en la plantilla html no borrar
        $carteradia=$data->verCarteraDia($cr);
        $exec=$data->verCartera($cr);
        if($cr == "CR1") @$sincartera = $data->sinCartera();
        if (count($exec)){
            include 'app/views/pages/p.vercarterarevision.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function ImprimirCarteraDia($cr){ //04072016
        $data = new Pegaso;
        $carteradia=$data->verCarteraDia($cr);
        $hoy = date("d-m-Y");
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);
        
        
        $pdf->Cell(100,6,"Cartera: {$cr}     Dia: {$hoy}");

        $pdf->Ln();
        $pdf->Cell(16,6,"PEDIDO",1);
        $pdf->Cell(75,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(15,6,"IMP FACT",1);
        $pdf->Cell(15,6,"FECHA FAC",1);
        $pdf->Cell(15,6,"REMISION",1);
        $pdf->Cell(15,6,"IMP REM",1);
        $pdf->Cell(15,6,"FECHA REM",1);
        $pdf->Cell(10,6,"DIAS",1);
        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($carteradia as $row){
        $pdf->Cell(16,6,$row->CVE_FACT,1);
        $pdf->Cell(75,6,$row->CLIENTE,1);
        $pdf->Cell(15,6,$row->FACTURA,1);
        $pdf->Cell(15,6,"$ ".number_format($row->IMPFAC,2,".",","),1);
        $pdf->Cell(15,6,substr($row->FECHAFAC,0,10),1);
        $pdf->Cell(15,6,trim($row->REMISION),1);
        $pdf->Cell(15,6,"$ ".number_format($row->IMPREM,2,".",","),1);
        $pdf->Cell(15,6,substr($row->FECHAREM,0,10),1);
        $pdf->Cell(10,6,$row->DIAS,1);
        $pdf->Ln();
        }
        
        
        ob_get_clean();
        $pdf->Output('Cartera Revision'.$hoy.'.pdf','i');
    }
    
    function salvarContraRecibo($caja,$cr,$contraRecibo,$factura,$remision){     //02082016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "verCR&cr={$cr}"; // aquí ocupo la variable cr para redireccionar a la vista despues de ejecutar la consulta de actualización
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvarContraRecibo($contraRecibo,$caja);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function emitirContraRecibo($caja,$factura,$remision){  //02082016
    	$data = new Pegaso;
        $contrarecibo = $data->traeDataContraRecibo($caja);
        $emitir = $data->salvarStatusECR($caja);
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);
        
        foreach($contrarecibo as $title){
            $pedido = $title->CVE_FACT;
        }
        
        $pdf->Cell(100,6,"CAJA: {$caja}     Pedido: {$pedido}");

        $pdf->Ln();
        $pdf->Cell(70,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(24,6,"FECHA FACTURA",1);
        $pdf->Cell(20,6,"REMISION",1);
        $pdf->Cell(24,6,"FECHA REMISION",1);
        $pdf->Cell(15,6,"ESTATUS",1);
        $pdf->Cell(10,6,"DIAS",1);
        $pdf->Cell(22,6,"CONTRARECIBO",1);        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($contrarecibo as $row){
            $pdf->Cell(70,6,$row->NOMBRE,1);
            $pdf->Cell(15,6,$row->FACTURA,1);
            $pdf->Cell(24,6,$row->FECHAFAC,1);
            $pdf->Cell(20,6,trim($row->REMISION),1);
            $pdf->Cell(24,6,$row->FECHAREM,1);
            $pdf->Cell(15,6,$row->STATUS_LOG,1);
            $pdf->Cell(10,6,$row->DIAS,1);
            $pdf->Cell(22,6,$row->CONTRARECIBO_CR,1);
            $pdf->Ln();
        }
        
        
        ob_get_clean();
        $pdf->Output('Contra Recibo Cartera Revision.pdf','i');
    }

    function SMCarteraRev10(){      //30062016  
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubcarterarevision10.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        if (count($exec)){
            include 'app/views/modules/m.msubcarterarevision10.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function VarCartera10($cr){     //3006
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.vercarterarevision.php');
        ob_start();
        $carteradia=$data->verCarteraDia10($cr);
        $exec=$data->verCartera10($cr);
        if($cr == "CR1") @$sincartera = $data->sinCartera10();
        if (count($exec)){
            include 'app/views/pages/p.vercarterarevision.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function catCierreCarteraR($cr){   //07072016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.vercierreCR.php');
        ob_start();
        $cartera = $cr;
        $nocontrarecibo = $data->verCarteraCierreDiaSinCR($cr);
        $exec=$data->verCarteraCierreDia($cr);
        if (count($exec) || count($nocontrarecibo) ){
            include 'app/views/pages/p.vercierreCR.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function SMCierreCartera(){     //07072016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.subcarteracierre.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        if (count($exec)){
            include 'app/views/modules/m.subcarteracierre.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
       function salvarMotivoSinCR($motivo,$factura,$remision,$cr){     //06072016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "catCierreCr";
            //$pagina=$this->load_template('Pedidos');
            //$html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvarMotivoSinContraR($motivo,$factura,$remision);
            //var_dump($exec);
            //include 'app/views/pages/p.redirectform.php';
            header("Location: index.php?action=catCierreCr&cr=$cr");
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    

function emitirCierreCR($cr){       //08072016
        $data = new Pegaso;
        $exec = $data->verCarteraCierreDiaSinCR($cr);
        $sicontrarecibo = $data->verCarteraCierreDia($cr);
        //$gen = $data->GenerarCierreCR($cr);
        $gen = $data->emitirCierreCR($cr);
        $finalizados = 0; $pendientes = 0; $totalLogrado = 0; $totalFaltante = 0;
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(70,6,"Cartera Revision {$cr}");
        $pdf->Cell(70,6,"Fecha: " . date("d/m/Y"));
        $pdf->Ln();
        $pdf->Cell(70,6,"Documentos con contra recibo.");
        $pdf->Ln();
        $pdf->Cell(50,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(16,6,"FECHA FAC",1);
        $pdf->Cell(20,6,"IMPORTE FAC",1);
        $pdf->Cell(20,6,"REMISION",1);
        $pdf->Cell(16,6,"FECHA REM",1);
        $pdf->Cell(20,6,"IMPORTE REC",1);
        $pdf->Cell(10,6,"DIAS",1);
        $pdf->Cell(22,6,"CONTRARECIBO",1);        
        
        $pdf->Ln();
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($sicontrarecibo as $row){
            $pdf->Cell(50,6,substr($row->CLIENTE,0,31),'L,T,R');
            $pdf->Cell(15,6,$row->FACTURA,'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHAFAC,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->IMPFAC,2,".",","),'L,T,R');
            $pdf->Cell(20,6,trim($row->REMISION),'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHAREM,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->IMPREM,2,".",","),'L,T,R');
            $pdf->Cell(10,6,$row->DIAS,'L,T,R');
            $pdf->Cell(22,6,$row->CONTRARECIBO_CR,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(50,6,substr($row->CLIENTE,31,70),'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(22,6,"",'L,B,R');
            $pdf->Ln();
            $finalizados += 1;
            $totalLogrado += ($row->IMPFAC + $row->IMPREM);
        }
        
        
        $pdf->Cell(70,6,"Documentos sin contra recibo.");
        $pdf->Ln();
        $pdf->Cell(50,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(16,6,"FECHA FAC",1);
        $pdf->Cell(20,6,"IMPORTE FAC",1);
        $pdf->Cell(20,6,"REMISION",1);
        $pdf->Cell(16,6,"FECHA REM",1);
        $pdf->Cell(20,6,"IMPORTE REC",1);
        $pdf->Cell(10,6,"DIAS",1);
        $pdf->Cell(22,6,"MOTIVO",1);
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($exec as $row){
            $pendientes += 1;
            $totalFaltante += ($row->IMPFAC + $row->IMPREM);
            $pdf->Cell(50,6,substr($row->CLIENTE,0,31),'L,T,R');
            $pdf->Cell(15,6,$row->FACTURA,'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHAFAC,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->IMPFAC,2,".",","),'L,T,R');
            $pdf->Cell(20,6,trim($row->REMISION),'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHAREM,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->IMPREM,2,".",","),'L,T,R');
            $pdf->Cell(10,6,$row->DIAS,'L,T,R');
            $pdf->Cell(22,6,$row->MOTIVO,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(50,6,substr($row->CLIENTE,31,70),'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(22,6,"",'L,B,R');
            $pdf->Ln();
        }
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(60,8,"Documentos logrados: " . $finalizados);
        $pdf->Cell(45,8,"Total logrado: $" .number_format($totalLogrado,2,".",","));
        $pdf->Ln();
        $pdf->Cell(60,8,"Documentos faltantes: " . $pendientes);
        $pdf->Cell(45,8,"Total faltante: $" .number_format($totalFaltante,2,".",","));
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 20);
        $pdf->Cell(35,8,"Eficacia: " . round((($totalLogrado / ($totalLogrado + $totalFaltante))*100),2)." %" );
        
        ob_get_clean();
        $pdf->Output('Cierre cartera revision.pdf','i');
    }


    function catCobranza($cc){     //07072016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verCatCobranza.php');
        ob_start();   
        $cobsincierre = $data->CobranzaSinCierre($cc);
        $sinCobroDia = $data->verNoCobradosDia($cc);
        if (count($cobsincierre) || count($sinCobroDia)){
            include 'app/views/pages/p.verCatCobranza.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function genCierreCobranza($cc){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verCatCobranza.php');
        ob_start();
        $cierre=$data->genCierreCobranza($cc);  

        if($cierre == 'falso'){
        	echo 'Error';
        	// Retorno a Conbranza con un estatus de Fallido;
        	$this->catCobranza($cc);
        }elseif($cierre != 0){
        	echo 'Exito';

        	$folio = $cierre;
        	echo $folio;
        	echo $cc;
        	// Mandar la impresion del Cierre;
        	//break;	
        	$this->ImprimeCierreCob($folio, $cc);        	
        }
    	}

	}


	function ImprimeCierreCob($folio, $cc){
		$data = new Pegaso;
        $datos = $data->traeAplicaciones($folio);
        //$sicontrarecibo = $data->verCarteraCierreDia($cr);
        //$gen = $data->GenerarCierreCR($cr);
        //$gen = $data->emitirCierreCR($cr);
        $finalizados = 0; $pendientes = 0; $totalLogrado = 0; $totalFaltante = 0;
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 6);
        $pdf->Cell(70,6,"Cartera Cobranza {$cc}");
        $pdf->Cell(70,6,"Fecha: " . date("d/m/Y"));
        $pdf->Ln();
        $pdf->Cell(70,6,"Documentos con Aplicaciones de Pago.");
        $pdf->Ln();
        $pdf->Cell(50,6,"CLIENTE",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(16,6,"FECHA FAC",1);
        $pdf->Cell(20,6,"IMPORTE FAC",1);
        $pdf->Cell(10,6,"PAGO",1);
        $pdf->Cell(16,6,"FECHA PAGO",1);
        $pdf->Cell(20,6,"MONTO APL",1);
        $pdf->Cell(10,6,"SALDO DOC",1);
        $pdf->Cell(15,6,"BANCO",1);
        $pdf->Cell(10,6,"MONTO",1);        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 6);

        foreach($datos as $row){
            $pdf->Cell(50,6,substr($row->NOMBRE,0,31),'L,T,R');
            $pdf->Cell(15,6,$row->DOCUMENTO,'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHAELAB,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->IMPORTE,2,".",","),'L,T,R');
            $pdf->Cell(10,6,trim($row->IDPAGO),'L,T,R');
            $pdf->Cell(16,6,substr($row->FECHA,0,10),'L,T,R');
            $pdf->Cell(20,6,"$ ".number_format($row->MONTO_APLICADO,2,".",","),'L,T,R');
            $pdf->Cell(10,6,$row->SALDOFINAL,'L,T,R');
            $pdf->Cell(15,6,substr($row->BANCO,0,10),'L,T,R');
            $pdf->Cell(10,6,$row->MONTO,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(50,6,substr($row->CLIENTE,31,70),'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(16,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(15,6,substr($row->BANCO, 11, 20),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Ln();
            $finalizados += 1;
            $totalLogrado += ($row->MONTO_APLICADO);
        }
        
        
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(60,8,"Documentos logrados: " . $finalizados);
        $pdf->Cell(45,8,"Total logrado: $" .number_format($totalLogrado,2,".",","));
        $pdf->Ln();
        $pdf->Cell(60,8,"Documentos faltantes: " . $pendientes);
        $pdf->Cell(45,8,"Total faltante: $" .number_format($totalFaltante,2,".",","));
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 20);
        $pdf->Cell(35,8,"Eficacia: " . round((($totalLogrado / ($totalLogrado + $totalFaltante))*100),2)." %" );
        
        ob_get_clean();
        $pdf->Output('Cierre cartera Cobranza.pdf','i');		
	}

    
    function catCorteCredito(){     //06072016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verCorteCredito.php');
        ob_start();
        $exec=$data->verCatCobranza10d();
        if (count($exec)){
            include 'app/views/pages/p.verCorteCredito.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function SMCarteraCobranza(){     //07072016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubcarteracobranza.php');
        ob_start();
        $exec=$data->traeCarterasCobranza(); 
        if (count($exec)){
            include 'app/views/modules/m.msubcarteracobranza.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function acuse_revision(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.acuse_revision.php');
        ob_start();
        $acuse=$data->acuse_revision(); 
        if (count($acuse)){
            include 'app/views/pages/p.acuse_revision.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }

    function info_foraneo($caja, $doccaja, $guia, $fletera){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.acuse_revision.php');
        ob_start();
        $infofletera=$data->info_foraneo($caja, $doccaja, $guia, $fletera);
        $acuse=$data->acuse_revision(); 
        if (count($acuse)){
            include 'app/views/pages/p.acuse_revision.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }

    function FacturarRemision(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verRemisiones.php');
        ob_start();
        $remisiones=$data->VerRemisiones();
        if (count($remisiones)){
            include 'app/views/pages/p.verRemisiones.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function asociarFactura($caja,$docp, $factura){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $redireccionar = "FacturarRemision";
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        $asociar=$data->asociarFactura($caja, $docp, $factura);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }	

    }

    function NCFactura(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturasNc.php');
        ob_start();
        $nc=$data->VerNCFactura();
        if (count($nc)){
            include 'app/views/pages/p.verFacturasNc.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function DesNC($idc){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturasNc.php');
        ob_start();
        $deslinde=$data->DesNC($idc);        
        $nc=$data->VerNCFactura();
        if (count($nc)){
            include 'app/views/pages/p.verFacturasNc.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }



    function asociarNC($caja, $docp, $nc){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $redireccionar = "NCFactura";
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        $asociar=$data->asociarNC($caja, $docp, $nc);
        $nc=$data->VerNCFactura();
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }	

    }

    function VerFacturasDeslinde(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturasDeslinde.php');
        ob_start();
        $nc=$data->VerFacturasDeslinde();
        if (count($nc)){
            include 'app/views/pages/p.verFacturasDeslinde.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function avanzaDeslinde($caja,$pedido,$motivo){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "VerFacturasDeslinde";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->AvanzaDeslinde($caja,$pedido,$motivo);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }	
    }

    function VerFacturasAcuse(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verFacturasAcuse.php');
        ob_start();
        $nc=$data->VerFacturasAcuse();
        if (count($nc)){
            include 'app/views/pages/p.verFacturasAcuse.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }	
    }

    function guardaAcuse($caja,$pedido,$guia,$fletera){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "VerFacturasAcuse";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->GuardaAcuse($caja,$pedido,$guia,$fletera);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }	
    }

function imprimirFacturasNC(){       
        $data = new Pegaso;
        $nc=$data->VerNCFactura();
        $cierranc = $data->CierreNcFactura();
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(12,6,"PEDIDO",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(15,6,"FECHA FAC",1);
        $pdf->Cell(55,6,"CLIENTE",1);
        $pdf->Cell(10,6,"CAJA",1);
        $pdf->Cell(12,6,"UNIDAD",1);
        $pdf->Cell(20,6,"STATUSLOG",1);
        $pdf->Cell(13,6,"DOC OP",1);
        $pdf->Cell(25,6,"NOTA CREDITO",1);        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($nc as $row){
            $pdf->Cell(12,6,$row->CVE_FACT,'L,T,R');
            $pdf->Cell(15,6,$row->DOCFACTURA,'L,T,R');
            $pdf->Cell(15,6,substr($row->FECHAELAB,0,10),'L,T,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,0,31),'L,T,R');
            $pdf->Cell(10,6,$row->ID,'L,T,R');
            $pdf->Cell(12,6,$row->UNIDAD,'L,T,R');
            $pdf->Cell(20,6,$row->STATUS_LOG,'L,T,R');
            $pdf->Cell(13,6,$row->DOCS,'L,T,R');
            $pdf->Cell(25,6,$row->NC,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,31,70),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(13,6,"",'L,B,R');
            $pdf->Cell(25,6,"",'L,B,R');
            $pdf->Ln();
        }

        $pdf->Ln();
        
        ob_get_clean();
        $pdf->Output('Cierre facturas note de credito.pdf','i');
    }

function imprimirFacturasDeslinde(){       
        $data = new Pegaso;
        $nc=$data->VerFacturasDeslinde();
        $des=$data->CierreFacturaDeslinde();
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(12,6,"PEDIDO",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(15,6,"FECHA FAC",1);
        $pdf->Cell(55,6,"CLIENTE",1);
        $pdf->Cell(10,6,"CAJA",1);
        $pdf->Cell(12,6,"UNIDAD",1);
        $pdf->Cell(20,6,"STATUSLOG",1);
        $pdf->Cell(13,6,"DOC OP",1);
        $pdf->Cell(25,6,"MOTIVO DES",1);        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($nc as $row){
            $pdf->Cell(12,6,$row->CVE_FACT,'L,T,R');
            $pdf->Cell(15,6,$row->DOCFACTURA,'L,T,R');
            $pdf->Cell(15,6,substr($row->FECHAELAB,0,10),'L,T,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,0,31),'L,T,R');
            $pdf->Cell(10,6,$row->ID,'L,T,R');
            $pdf->Cell(12,6,$row->UNIDAD,'L,T,R');
            $pdf->Cell(20,6,$row->STATUS_LOG,'L,T,R');
            $pdf->Cell(13,6,$row->DOCS,'L,T,R');
            $pdf->Cell(25,6,$row->MOTIVODES,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,31,70),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(13,6,"",'L,B,R');
            $pdf->Cell(25,6,"",'L,B,R');
            $pdf->Ln();
        }

        $pdf->Ln();
        
        ob_get_clean();
        $pdf->Output('Cierre deslide facturas.pdf','i');
    }

function imprimirFacturasAcuse(){       
        $data = new Pegaso;
        $nc=$data->VerFacturasAcuse();
        $acuse=$data->CierreFacturaAcuse();
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(12,6,"PEDIDO",1);
        $pdf->Cell(15,6,"FACTURA",1);
        $pdf->Cell(15,6,"FECHA FAC",1);
        $pdf->Cell(55,6,"CLIENTE",1);
        $pdf->Cell(10,6,"CAJA",1);
        $pdf->Cell(12,6,"UNIDAD",1);
        $pdf->Cell(20,6,"STATUSLOG",1);
        $pdf->Cell(13,6,"DOC OP",1);
        $pdf->Cell(25,6,"GUIA",1);
        $pdf->Cell(25,6,"FLETERA",1);        
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($nc as $row){
            $pdf->Cell(12,6,$row->CVE_FACT,'L,T,R');
            $pdf->Cell(15,6,$row->DOCFACTURA,'L,T,R');
            $pdf->Cell(15,6,substr($row->FECHAELAB,0,10),'L,T,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,0,31),'L,T,R');
            $pdf->Cell(10,6,$row->ID,'L,T,R');
            $pdf->Cell(12,6,$row->UNIDAD,'L,T,R');
            $pdf->Cell(20,6,$row->STATUS_LOG,'L,T,R');
            $pdf->Cell(13,6,$row->DOCS,'L,T,R');
            $pdf->Cell(25,6,$row->GUIA_FLETERA,'L,T,R');
            $pdf->Cell(25,6,$row->FLETERA,'L,T,R');
            $pdf->Ln();
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,31,70),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(13,6,"",'L,B,R');
            $pdf->Cell(25,6,"",'L,B,R');
            $pdf->Cell(25,6,"",'L,B,R');
            $pdf->Ln();
        }

        $pdf->Ln();
        
        ob_get_clean();
        $pdf->Output('Cierre acuse facturas.pdf','i');
    }


    //

    function imprimirFacturasRemision(){       
        $data = new Pegaso;
        $remisiones=$data->VerRemisiones();
        $rem = $data->CierrePendienteFacturar();
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(12,6,"PEDIDO",1);
        $pdf->Cell(15,6,"REMISION",1);
        $pdf->Cell(15,6,"FECHA REM",1);
        $pdf->Cell(55,6,"CLIENTE",1);
        $pdf->Cell(10,6,"CAJA",1);
        $pdf->Cell(12,6,"UNIDAD",1);
        $pdf->Cell(20,6,"STATUSLOG",1);
        $pdf->Cell(13,6,"DOC OP",1);
        $pdf->Cell(25,6,"FACTURA",1);
       
        
        $pdf->Ln();
        
        $pdf->SetFont('Arial', 'I', 7);
        
        foreach($remisiones as $row){
            $pdf->Cell(12,6,$row->CVE_FACT,'L,T,R');
            $pdf->Cell(15,6,trim($row->REM),'L,T,R');
            $pdf->Cell(15,6,substr($row->FECHAELAB,0,10),'L,T,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,0,31),'L,T,R');
            $pdf->Cell(10,6,$row->ID,'L,T,R');
            $pdf->Cell(12,6,$row->UNIDAD,'L,T,R');
            $pdf->Cell(20,6,$row->STATUS_LOG,'L,T,R');
            $pdf->Cell(13,6,$row->DOCS,'L,T,R');
            $pdf->Cell(25,6,$row->FACTURA,'L,T,R');

            $pdf->Ln();
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(15,6,"",'L,B,R');
            $pdf->Cell(55,6,substr($row->NOMBRE,31,70),'L,B,R');
            $pdf->Cell(10,6,"",'L,B,R');
            $pdf->Cell(12,6,"",'L,B,R');
            $pdf->Cell(20,6,"",'L,B,R');
            $pdf->Cell(13,6,"",'L,B,R');
            $pdf->Cell(25,6,"",'L,B,R');

            $pdf->Ln();
        }
        $pdf->Ln();        
        ob_get_clean();
        $pdf->Output('Cierre Factura remision.pdf','i');
    }

    function verCarteraCobranza(){      //19072016
        
        if (isset($_SESSION['user'])){
        $cartera = $_SESSION['user']->CC;
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.CarteraCobranza.php');
        ob_start();
        //$actualizaSaldo = $data->actualizaSaldoVencido();
        //echo 'Esta es la cartera '.$cartera;
        $saldoxmaestro=$data->saldoMaestro($cartera);
        $saldoxmaestrodia=$data->saldoMaestrodia($cartera);
        $saldoAcumulado=$data->saldoAcumulado();
        $saldoVencido=$data->saldoVCD();
        $saldoCartera=$data->SaldoCD();
        $saldoVMultiple=$data->saldoVCDMultiple();
        $saldoMultiple = $data->saldoCDMultiple();
        if (count($saldoxmaestro)){
            include 'app/views/pages/p.CarteraCobranza.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function SaldosxDocumento($cliente){    //19072016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.saldosxdocumento.php');
        ob_start();
        $historico = 'No';
        
        $statusClie=$data->traeStatusClie($cliente); 
        $solR = $data->traeSolicitudesR($cliente);
        $solC = $data->traeSolicitudesC($cliente);
        $datacli = $data->traeDatacliente($cliente);    // trae los datos del cliente
        $saldo = $data->SaldosDelCliente($cliente);
        $exec = $data->traeSaldosDoc($cliente, $historico);
        $csaldo=$data->saldoCliente($cliente);
        $saldovencido=$data->saldoVencidoCliente($cliente);
        if (count($datacli)){
            include 'app/views/pages/p.saldosxdocumento.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function SaldosxDocumentoH($cliente){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.saldosxdocumento.php');
        ob_start();
        $historico ='Si';
        $solR = $data->traeSolicitudesR($cliente);
        $solC = $data->traeSolicitudesC($cliente);
        $datacli = $data->traeDatacliente($cliente);    // trae los datos del cliente
        $saldo = $data->SaldosDelCliente($cliente);
        $exec = $data->traeSaldosDoc($cliente, $historico);
        $csaldo=$data->saldoCliente($cliente);
        $saldovencido=$data->saldoVencidoCliente($cliente);
        if (count($datacli)){
            include 'app/views/pages/p.saldosxdocumento.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function ContactosCliente($cliente){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.contactoscliente.php');
        ob_start();
        $exec = $data->ContactosDelCliente($cliente);
        if (count($exec)){
            include 'app/views/pages/p.contactoscliente.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
    }
    

    
    function GuardarComprobantesCaja($caja,$ruta,$origen){
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.blank.php');
        ob_start();
        $exec = $data->guardaCompCaja($caja,$ruta);
        if (count($exec)){
            include 'app/views/pages/p.blank.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            header("Refresh:5; url=index.php?action=$origen");
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
        
    }

    function PedidosAnticipados(){
		if(isset($_SESSION['user'])){
		$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.pedidosAnticipados.php');
		ob_start(); 
			$pedidos=$data->pedidosAnticipados();  
			if( count($pedidos > 0)){
				include 'app/views/pages/p.pedidosAnticipados.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	} 

    function AnticipadosUrgencias(){
		 
		 if(isset($_SESSION['user'])){
			$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.pedidosAnticipadosSD.php');
		ob_start(); 
			$pedidos=$data->anticipadosUrgencias();  
			if( count($pedidos)){
				include 'app/views/pages/p.pedidosAnticipadosUrgencias.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Algo no salio como se esperaba o No Existen Pedidos que sean urgentes, Si usted cree que es un error, favor de verificarlo con sistemas. Gracias!!!</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	} 


	function SubMenuCxCC(){
		
		if(isset($_SESSION['user'])){		
		$pagina=$this->load_template('Menu Admin');				
		$html = $this->load_page('app/views/modules/m.subfacturacion.php'); 
		$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
		$this-> view_page($pagina);
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function FacturacionDia(){
		
		if(isset($_SESSION['user'])){
		$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.pfacturasdeldia.php');
		ob_start(); 
			$exec=$data->facturasDelDia();  
			$resumen=$data->resumenFacturasDelDia();
			$totaduana=$data->resumenFacturasDelDiaAduana();
			$totlog=$data->resumenFacturasDelDiaLogistica();
			if( count($exec > 0)){
				include 'app/views/pages/p.pfacturasdeldia.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function FacturacionAyer(){
	
	if(isset($_SESSION['user'])){
		$data = new pegaso;				
		$pagina=$this->load_template('Alta Unidades');				
		$html = $this->load_page('app/views/pages/p.pfacturasdeldia.php');
		ob_start(); 
			$exec=$data->facturasAyer();  
			if( count($exec > 0)){
				include 'app/views/pages/p.pfacturasdeldia.php';
				$table = ob_get_clean(); 
					$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
						}else{
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
						}		
						$this->view_page($pagina);	
		}else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

	function utilidadFacturas($fechaini,$fechafin,$rango,$utilidad,$letras,$status){    //01082016
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Alta Unidades');				
			$html = $this->load_page('app/views/pages/p.putilidadfact.php');
			ob_start();
                @$total = $data->UtilidadFacturasTot($fechaini,$fechafin,$rango,$utilidad,$letras,$status);
				@$exec=$data->UtilidadFacturas($fechaini,$fechafin,$rango,$utilidad,$letras,$status);  
				if( count($exec > 0)){
					include 'app/views/pages/p.putilidadfact.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}

	function utilidadXFactura($fact){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Alta Unidades');				
			$html = $this->load_page('app/views/pages/p.putilidadfactxpart.php');
			ob_start(); 
				$exec=$data->UtilidadXFacturaHead($fact);
				$partidas = $data->UtilidadXFactura($fact);
				$total = $data->TotalesUtilidadxFactura($fact); 
				if( count($exec > 0)){
					include 'app/views/pages/p.putilidadfactxpart.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}

	function deslindecr(){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Alta Unidades');				
			$html = $this->load_page('app/views/pages/p.vercrdeslinde.php');
			ob_start(); 
				$deslindes=$data->deslindecr();
				if( count($deslindes > 0)){
					include 'app/views/pages/p.vercrdeslinde.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}

	function deslindearevision($caja, $docf, $docr, $sol, $cr){
		
		if(isset($_SESSION['user'])){
			$data = new pegaso;				
			$pagina=$this->load_template('Alta Unidades');				
			$html = $this->load_page('app/views/pages/p.vercrdeslinde.php');
			ob_start();
				$actualiza=$data->deslindearevision($caja, $docf, $docr, $sol, $cr); 
				$deslindes=$data->deslindecr();
				if( count($deslindes > 0)){
					include 'app/views/pages/p.vercrdeslinde.php';
					$table = ob_get_clean(); 
						$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
							}else{
							$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
							}		
							$this->view_page($pagina);	
			}else{
				$e = "Favor de Iniciar Sesión";
				header('Location: index.php?action=login&e='.urlencode($e)); exit;
			}
	}

    function GuardarXMLF($doc,$archivo,$origen){        //03082016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.blank.php');
        ob_start();
        $exec = $data->guardarXmlDocF($doc,$archivo);
        if (count($exec)){
            include 'app/views/pages/p.blank.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            header("Refresh:5; url=index.php?action=$origen");
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
        
    }
    
    function GuardarXMLD($doc,$archivo,$origen){        //03082016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.blank.php');
        ob_start();
        $exec = $data->guardarXmlDocD($doc,$archivo);
        if (count($exec)){
            include 'app/views/pages/p.blank.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
            header("Refresh:5; url=index.php?action=$origen");
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
        
    }

        function revConDosPasos($cr){   //05082016     
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.revisiondospasos.php');
        ob_start();
        if($cr == 'CR1'){
        $nocr = $data->revConDosPasosNoCr();
        }
        $revdia = $data->revConDosPasosDia($cr);
        $exec=$data->revConDosPasos($cr); 
        if (count($exec)){
            include 'app/views/pages/p.revisiondospasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function revSinDosPasos($cr){       //05082016 
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.revisionNOdospasos.php');
        ob_start();
        $exec = $data->revSinDosPasosNoCr($cr);
        //$revdia = $data->revSinDosPasosDia($cr);
        //$exec=$data->revSinDosPasos($cr); 
        if (count($exec)){
            include 'app/views/pages/p.revisionNOdospasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function DeslindeConDosPasos($caja,$cr){        //05082016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "RevConDosP&cr={$cr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->statusDeslindeConDP($caja);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function DeslindeSinDosPasos($caja,$cr, $numcr){        //05082016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "RevSinDosP&cr={$cr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->statusDeslindeSinDP($caja, $numcr);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function DeslindeRevConDosP($cr){       //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.deslindeRevDP.php');
        ob_start();
        $revdia = $data->DeslindeDosPasosDia($cr);
        $exec=$data->DeslindeDosPasos($cr); 
        if (count($exec)){
            include 'app/views/pages/p.deslindeRevDP.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
    }
    
    function DeslindeRevSinDosP($cr){       //05082016
        
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.deslindeNoRevDP.php');
        ob_start();
        $revdia = $data->DeslindeNoDosPasosDia($cr);
        $exec=$data->DeslindeNoDosPasos($cr); 
        if (count($exec)){
            include 'app/views/pages/p.deslindeNoRevDP.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            } 
    }
    
    function salvaMotivoDeslindeDP($caja,$motivo,$cr){      //05082016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "DesRevConDosP&cr={$cr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvaMotivoDesDP($caja,$motivo);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function salvaMotivoDeslindeNoDP($caja,$motivo,$cr){    //05082016
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "DesRevSinDosP&cr={$cr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->salvaMotivoDesNoDP($caja,$motivo);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }
    
    function avanzarCajaCobranza($caja,$revdp, $numcr){
        
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            if($revdp == 'S')
                $redireccionar = "RevConDosP";
            else
                $redireccionar = "RevSinDosP";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->avanzarCajaCobranza($caja, $numcr);
            //var_dump($exec);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }
    }

    function CajaCobranza($caja, $revdp, $numcr, $cr){
    	 
        if (isset($_SESSION['user'])){
            $data = new pegaso;
            $redireccionar = "RevSinDosP&cr={$cr}";
            $pagina=$this->load_template('Pedidos');
            $html = $this->load_page('app/views/pages/p.redirectform.php');
            $exec = $data->CajaCobranza($caja, $revdp, $numcr);
            include 'app/views/pages/p.redirectform.php';
            $this->view_page($pagina);
        }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
        }

    }	
	/*function created by GDELEON 3/Ago/2016*/
	function TraePresupuestoConceptGasto($concept){
		$data = new pegaso;	
		$result = $data->TraePresupuestoConceptGasto($concept);
		foreach($result as $rs){
			$re = $rs->PRESUPUESTO;
		}
		return $re;
	}
        
    function SMRevisionDosPasos(){     //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubrevisiondospasos.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        if (count($exec)){
            include 'app/views/modules/m.msubrevisiondospasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function SMSinRevisionDosPasos(){     //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubrevisionSINdospasos.php');
        ob_start();
        $exec=$data->saldoCartera(); 
        if (count($exec)){
            include 'app/views/modules/m.msubrevisionSINdospasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }
    
    function SMDesRevisionDosPasos(){     //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubdeslindedospasos.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        if (count($exec)){
            include 'app/views/modules/m.msubdeslindedospasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function SMDesSinRevisionDosPasos(){     //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubdeslindeNOpasos.php');
        ob_start();
        $exec=$data->traeCarteras(); 
        if (count($exec)){
            include 'app/views/modules/m.msubdeslindeNOpasos.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

     function deslindeaduana(){     //05082016
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verDeslindeAduana.php');
        ob_start();
        $documentos=$data->deslindeaduana(); 
        if (count($documentos)){
            include 'app/views/pages/p.verDeslindeAduana.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function DesaAdu($caja, $solucion){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verDeslindeAduana.php');
        ob_start();
        $soldeslinde=$data->DesaAdu($caja, $solucion);
        $documentos=$data->deslindeaduana(); 
        if (count($documentos)){
            include 'app/views/pages/p.verDeslindeAduana.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }

    }

    function BuscarCajasxPedido(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/pages/p.BusquedaCajas.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

    function MuestraCaja($docp){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.MuestraCaja.php');
        ob_start();
        	$exec=$data->traeCajasxPedido($docp); 
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.MuestraCaja.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>ESTE PEDIDO NO HA SIDO EMPACADO NI EMBALADO, FAVOR DE REVISAR CON BODEGA</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}
    }
	function RecibirDocsRevision(){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.vercarterarev.php');
        ob_start();
        	$docsrevision=$data->RecibirDocsRevision();
        	$habilitaImpresion=$data->impresionCierre(); 
       	 	if (count($docsrevision)> 0){
            	include 'app/views/pages/p.vercarterarev.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}

    }

    function recDocCob($idc, $docf){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.vercarterarev.php');
        	$redireccionar="RecibirDocsRevision"; 
        	ob_start();
        	$recibir=$data->recDocCob($idc, $docf);
        		include 'app/views/pages/p.redirectform.php';
            	$this->view_page($pagina);
        }
    }

        function desDocCob($idc){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.vercarterarev.php');
        ob_start();
        	$recibir=$data->desDocCob($idc);
        	$docsrevision=$data->RecibirDocsRevision(); 
       	 	if (count($docsrevision)> 0){
            	include 'app/views/pages/p.vercarterarev.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}

    }

     function SMCCobranza(){  
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/modules/m.msubccobranza.php');
        ob_start();
        $exec=$data->traeCarterasCobranza(); 
        if (count($exec)){
            include 'app/views/modules/m.msubccobranza.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }


      function VerCobranza($cc){       //05082016 
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.VerCobranza.php');
        ob_start();
        //echo $cc;
        if($cc == 'CCA'){
        $nocr = $data->VerCobranza();
       }
        $revdia = $data->VerCobranzaDia($cc);
        $exec=$data->VerCobranzaC($cc); 
        if (count($exec)){
            include 'app/views/pages/p.VerCobranza.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }


    function avisoDevMail($idc, $docf, $dev ){
		$dao=new pegaso; /// Invocamos la classe pegaso para usar la BD.
        $folio = $dev;   /// Ejecutamos las consultas y obtenemos los datos.
        $exec = $dao->cabeceraDevolucion($idc, $docf);  /// Ejecutamos las consultas y obtenemos los datos.
        $correo = '';    /// correo electronico.
        $_SESSION['correos']=$correo;
        $_SESSION['folio'] = $folio;   //// guardamos los datos en la variable goblal $_SESSION.
        $_SESSION['exec'] = $exec;    //// guardamos los datos en la variable goblar $_SESSION.
        $_SESSION['titulo'] = 'Aviso de Devolucion de Mercancia';   //// guardamos los datos en la variable global $_SESSION
        include 'app/mailer/send.avisoDev.php';   ///  se incluye la classe Contrarecibo     
        //echo "Registro actualizado:$act";
        /*$redireccionar="recibirCajaNC";
        $pagina=$this->load_template('Pedidos');
        $html = $this->load_page('app/views/pages/p.redirectform.php');
        include 'app/views/pages/p.redirectform.php';
        echo 'Intenta Redireccionar';
        $this->view_page($pagina);                    */
   	 }

   	 function generaDevolucion($idc, $docf){
   	 	$data = new pegaso;
   	 	$actcaja = $data->cajabodeganc($idc, $docf); #Actualiza la caja para que deje de aparecer en la lista.
        $actpaquete = $data->paquetedevolucion($idc, $docf); #Actualiza el paquete con lo devuelto e impreso, crea folio de Devolucion de paquetes.
        if($actpaquete['status']== 'no'){
        	exit('Enviar correo informando que no se actualizo');
        }
        return $actpaquete;
   	 }

     function ImprimirDevolucion($idc, $docf){
    	ob_start();
    	$data = new Pegaso;
        $devueltos = $data->ImprimirDevolucion($idc, $docf); # Obtiene los datos para la impresion de lo que esta devuelto.
        $entregados = $data->ImprimirDevolucionEntrega($idc, $docf); # Obtiene los datos para la impresion de lo que se entrego.
        $actpaquete = $data->cabeceraDevolucion($idc, $docf);
        $pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
        $pdf->SetFont('Arial', 'B', 8);
        foreach($devueltos as $data){
           $folio = $data->FOLIO_DEV;
        }
         	$pdf->SetX(140);
            $pdf->Write(6,"Folio de devolucion : DNC".$data->FOLIO_DEV);
        	$pdf->Ln();
        foreach($actpaquete as $row){
            $pdf->Cell(40,6,"Factura: ".$row->FACTURA);
            $pdf->Ln();
            $pdf->Cell(40,6,"Fecha de factura: ".$row->FECHA_FACTURA);
            $pdf->Ln();
            $pdf->Cell(100,6,"Cliente: ".$row->CLIENTE);
            $pdf->Ln();
            $pdf->Cell(50,6,"Pedido: ".$row->PEDIDO,0,30);
            $pdf->Cell(30,6,"Caja: ".$row->CAJA);
            $pdf->Cell(50,6,"Unidad: ".$row->UNIDAD);
            $pdf->Ln();
            $pdf->Cell(40,6,"Status losgistica: ".$row->STATUS_LOG);
            $pdf->Ln();
            $pdf->Cell(40,6,"Vendedor: ".$row->VENDEDOR);
        	$pdf->Ln();
        }
        $pdf->SetFont('Arial','', 6);
        $pdf->Ln(5);
        $pdf->SetX(80);
        $pdf->Write(8,"PRODUCTOS RECIBIDOS EN BODEGA:");  
        $pdf->Ln(9);
        $pdf->Cell(25,6,"Articulo",1);
        $pdf->Cell(110,6,"Descripcion",1);
        $pdf->Cell(20,6,"Cantidad",1);
        $pdf->Ln();

        $pdf->SetFont('Arial','', 6);
        foreach($devueltos as $doc){
        	if(strlen($doc->DESCRIPCION > 105)){
        		$pdf->Cell(25,6,$doc->ARTICULO,'L,T,R',0);
	            $pdf->Cell(110,6,substr($doc->DESCRIPCION,0,105),'L,T,R',0);
	            $pdf->Cell(20,6,$doc->DEVUELTO,'L,T,R',0,'C');
	            $pdf->Ln();
	            $pdf->Cell(25,6,"",'L,B,R',0);
	            $pdf->Cell(110,6,substr($doc->DESCRIPCION,106,105),'L,B,R',0);
	            $pdf->Cell(20,6,"",'L,B,R',0);
	            $pdf->Ln();	
        	}else{
        		$pdf->Cell(25,6,$doc->ARTICULO,'L,T,R,B',0);
	            $pdf->Cell(110,6,substr($doc->DESCRIPCION,0,105),'L,T,R,B',0);
	            $pdf->Cell(20,6,$doc->DEVUELTO,'L,T,R,B',0,'C');
	            $pdf->Ln();
            }
        }
        if(count($entregados) >0 ){
        	$pdf->Ln();
        	$pdf->SetX(80);
	        $pdf->Write(8,"PRODUCTOS RECIBIDOS EN BODEGA:");  
    	    $pdf->Ln(9);
        	$pdf->Cell(30,6,"Articulo",1);
        	$pdf->Cell(110,6,"Descripcion",1);
        	$pdf->Cell(20,6,"Cantidad",1);
       		$pdf->Ln();
        }
        $pdf->Ln(75);
        $pdf->Cell(20,6,"");
        $pdf->Cell(60,6,"Nombre y firma de entrega",'T');
        $pdf->Cell(20,6,"");
        $pdf->Cell(60,6,"Nombre y firma de recibido",'T');

        ob_get_clean();
        $pdf->Output('C:\xampp\htdocs\Devoluciones\DEVOLUCION_'.$folio.'.pdf','f');
    }


   

    function verCajasLogistica(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verCajasLogistica.php');
        ob_start();
       	$listacajas=$data->verCajasLogistica(); 
        if (count($listacajas)){
            include 'app/views/pages/p.verCajasLogistica.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
        }
        function cambiarStatus($idcaja, $docp, $secuencia, $unidad, $idu, $ntipo){
        	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verCajasLogistica.php');
        ob_start();
        $actstatus=$data->cambiarStatus($idcaja, $docp, $secuencia, $unidad, $idu, $ntipo);
       	$listacajas=$data->verCajasLogistica(); 
        if (count($listacajas)){
            include 'app/views/pages/p.verCajasLogistica.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;

        	}
    	}


    function verLoteEnviar(){          //21
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verLoteEnvio.php');
        ob_start();
        $reenrutar=$data->verLoteEnviarReenrutar();
        $entrega=$data->verLoteEnviar();
        if (count($entrega) or count($reEnrutar)){
            include 'app/views/pages/p.verLoteEnvio.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    function entaduana($idc, $docf, $docp){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verLoteEnvio.php');
        ob_start();
        $actstatus=$data->entaduana($idc, $docf, $docp);
        $reenrutar=$data->verLoteEnviarReenrutar();
        $entrega=$data->verLoteEnviar();
        if (count($entrega) or count($reEnrutar)){
            include 'app/views/pages/p.verLoteEnvio.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }	
    }

    function recbodega($idc, $docf, $docp){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verLoteEnvio.php');
        ob_start();
        $actstatus=$data->recbodega($idc, $docf, $docp);
        $reenrutar=$data->verLoteEnviarReenrutar();
        $entrega=$data->verLoteEnviar();
        if (count($entrega) or count($reEnrutar)){
            include 'app/views/pages/p.verLoteEnvio.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }	
    }

    function reclogistica($idc, $docf, $docp){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verLoteEnvio.php');
        ob_start();
        $actstatus=$data->reclogistica($idc, $docf, $docp);
        $reenrutar=$data->verLoteEnviarReenrutar();
        $entrega=$data->verLoteEnviar();
        if (count($entrega) or count($reEnrutar)){
            include 'app/views/pages/p.verLoteEnvio.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }	
    }

    function impLoteFact(){
    	ob_start();
    	$usuario=$_SESSION['user']->USER_LOGIN;
    	$fecha=date("Y-m-d H:i:s");
    	$data = new Pegaso;
        #$actfact = $data->(); ##Actualiza la factura para que se desapasrezca de la pantala.
        #$actcaja = $data->(); ##Actualiza la caja para que aparezca en Asignacion de unidad.
        $lotedia = $data->impLoteDia(); #Obtiene los datos para las factura que son de el mismo dia.
        $loter = $data->impLoteReeenrutar(); # Obtiene los datos para las cajas que se reenrutan.
        $factn = $data->totfactn();
        $factr = $data->totfactr();
        $actcajas = $data->actimpcajas();

       	$pdf = new FPDF('P','mm','Letter');
        $pdf->AddPage();
        $pdf->Image('app/views/images/logos/'.$_SESSION['empresa']['logo'],10,10,50,15);
        $pdf->Ln(70);  
      
        $pdf->SetFont('Arial', 'B', 10);
        
        $pdf->SetX(10);
        $pdf->Write(6,"Facturas Nuevas : ".$factn);	
        $pdf->Ln();
        $pdf->Cell(40,6,"Facturas Reenrutar : ".$factr);
        $pdf->Ln();
        $pdf->Cell(40,6,"Fecha de Reporte : ".$fecha);
        $pdf->Ln();
        $pdf->Cell(100,6,"Usuario : ".$usuario);
        $pdf->Ln();
 
        $pdf->Ln(5);
        $pdf->SetX(80);
        $pdf->Write(5,"Relacion de Lote de facturas Nuevas del ".$fecha);  
        $pdf->Ln(9);
        $pdf->Cell(25,6,"Factura",1);
        $pdf->Cell(60,6,"Cliente",1);
        $pdf->Cell(30,6,"Usuario Aduana",1);
        $pdf->Cell(30,6,"Usuario Bodega",1);
        $pdf->Cell(32,6,"Usuario Logistica",1);
        $pdf->Cell(15,6,"Caja",1);
        $pdf->Ln();
        foreach($lotedia as $doc){
            $pdf->Cell(25,6,$doc->FACTURA,1);
            $pdf->Cell(60,6,$doc->IDC,1);
            $pdf->Cell(30,6,$doc->U_ENTREGA,1);
            $pdf->Cell(30,6,$doc->U_BODEGA,1);
            $pdf->Cell(32,6,$doc->U_LOGISTICA,1);
            $pdf->Cell(15,6,$doc->ID,1);
            $pdf->Ln();
        }
        $pdf->Ln(5);
        $pdf->SetX(80);
        $pdf->Write(5,"Relacion de Lote de facturas para Reenrutar del ".$fecha);  
        $pdf->Ln(9);
        $pdf->Cell(25,6,"Factura",1);
        $pdf->Cell(60,6,"Cliente",1);
        $pdf->Cell(30,6,"Usuario Aduana",1);
        $pdf->Cell(30,6,"Usuario Bodega",1);
        $pdf->Cell(32,6,"Usuario Logistica",1);
        $pdf->Cell(15,6,"Caja",1);
        $pdf->Ln();
        foreach($loter as $doc){
            $pdf->Cell(25,6,$doc->FACTURA,1);
            $pdf->Cell(60,6,$doc->IDC,1);
            $pdf->Cell(30,6,$doc->U_ENTREGA,1);
            $pdf->Cell(30,6,$doc->U_BODEGA,1);
            $pdf->Cell(32,6,$doc->U_LOGISTICA,1);
            $pdf->Cell(15,6,$doc->ID,1);
            $pdf->Ln();
        }
        $pdf->Ln(75);
        $pdf->Cell(5,6,"");
        $pdf->Cell(55,6,"Nombre y firma de Aduana",'T');
        $pdf->Cell(10,6,"");
        $pdf->Cell(55,6,"Nombre y firma de Bodega",'T');
		$pdf->Cell(10,6,"" );
		$pdf->Cell(55,6,"Nombre y firma de Logistica",'T');        
        ob_get_clean();
        $pdf->Output('DEVOLUCION.pdf','i');
    }

    function VerInventarioEmpaque(){
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/bodega/p.InventarioPatio.php');
        ob_start();
        $invempaque=$data->VerInventarioEmpaque();
        if (count($invempaque)){
            include 'app/views/pages/bodega/p.InventarioPatio.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }	
    }

    function verPedidosPendientes(){
    	
        if (isset($_SESSION['user'])){
        $data = new pegaso;
        $pagina=$this->load_template('Pedidos');
        $html=$this->load_page('app/views/pages/p.verPedidosPendientes.php');
        ob_start();
        $pedidosList=$data->verPedidosPendientes();
        if (count($pedidosList)){
            include 'app/views/pages/p.verPedidosPendientes.php';
            $table = ob_get_clean();
            $pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        }else{
            $pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>No hay datos para mostrar</h2><center></div>', $pagina);
                }
            $this->view_page($pagina);
            }else{
                $e = "Favor de iniciar Sesión";
                header('Location: index.php?action=login&e='.urlencode($e)); exit;
            }
    }

    	function docfact($docfact, $idc){       //2306-
                    
                    if(isset($_SESSION['user'])){
                    $data = new pegaso;
                    $pagina=$this->load_template('Compra Venta');				
                    $html = $this->load_page('app/views/pages/p.pantalla2.php');
                    ob_start(); 
                    $actdocfact =$data->docfact($docfact, $idc);
                    $exec = $data->PorFacturar();
                    $notascred = $data->PendientesGenNC();
                    $reenruta = $data->PendientesGenRee();
                    if($exec != ''){
			include 'app/views/pages/p.pantalla2.php';
			$table = ob_get_clean(); 
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms' ,$table , $pagina);
                        }else{
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html.'<h2>No hay resultados</h2>', $pagina);
                    }		
                    $this->view_page($pagina);
                    }else{
			$e = "Favor de Iniciar Sesión";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}

     function CancelarFactura(){
		
		if(isset($_SESSION['user'])){
			$pagina = $this->load_template('Menu Admin');
			$html = $this->load_page('app/views/pages/p.CancelarFactura.php');
			$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html, $pagina);
			$this-> view_page($pagina);
		}else{
			$e = "Favor de Revisar sus datos";
			header('Location: index.php?action=login&e='.urlencode($e)); exit;
		}
	}	

	 function CancelaFactura($docp){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.CancelaFactura.php');
        ob_start();
        	$exec=$data->traeFacturaxCancelar($docp);
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.CancelaFactura.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>LA FACTURA NO EXISTE, FAVOR DE REVISAR LOS DATOS.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}
    }

    function CancelarF($docf, $idc){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.CancelaFactura.php');
        ob_start();
        	$cancelar=$data->CancelaF($docf, $idc);
        	$exec=$data->traeFacturaxCancelar($docf);
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.CancelaFactura.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>LA FACTURA NO EXISTE, FAVOR DE REVISAR LOS DATOS.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}
    }

    function UtilidadBaja(){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.verUtilidadBaja.php');
        ob_start();
        	$exec=$data->UtilidadBaja();
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.verUtilidadBaja.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>FAVOR DE INICIAR SESION.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}

    }

 	function solAutoUB($docc,$par){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.verUtilidadBaja.php');
        ob_start();
        	$solicitar=$data->solAutoUB($docc,$par);
        	$exec=$data->UtilidadBaja();
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.verUtilidadBaja.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>FAVOR DE INICIAR SESION.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}

    }

    function verSolicitudesUB(){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.verSolicitudesUB.php');
        ob_start();
        	$exec=$data->verSolicitudesUB();
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.verSolicitudesUB.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>FELICIDADES, AL PARECER TODOS TUS VENDEDORES VENDEN CON UTILIDAD MAYOR AL 23%.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}	
    }

    function AutorizarUB($docc, $par){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.verSolicitudesUB.php');
        ob_start();
        	$autorizar=$data->AutorizarUB($docc, $par);
        	$exec=$data->verSolicitudesUB();
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.verSolicitudesUB.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>FELICIDADES, AL PARECER TODOS TUS VENDEDORES VENDEN CON UTILIDAD MAYOR AL 23%.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}	
    }


    function RechazoUB($docc, $par){
    	
        if (isset($_SESSION['user'])){
        	$data = new pegaso;
        	$pagina=$this->load_template('Pedidos');
        	$html=$this->load_page('app/views/pages/p.verSolicitudesUB.php');
        ob_start();
        	$autorizar=$data->RechazoUB($docc, $par);
        	$exec=$data->verSolicitudesUB();
       	 	if (count($exec)> 0){
            	include 'app/views/pages/p.verSolicitudesUB.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms',$table,$pagina);
        	}else{
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms',$html.'<div class="alert-info"><center><h2>FELICIDADES, AL PARECER TODOS TUS VENDEDORES VENDEN CON UTILIDAD MAYOR AL 23%.</h2><center></div>', $pagina);
                }
            	$this->view_page($pagina);
            	}else{
                	$e = "Favor de iniciar Sesión";
                	header('Location: index.php?action=login&e='.urlencode($e)); exit;
            	}	
    }


    function Pagos() {
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pagos.listado.php');
        	ob_start();
        	$exec = $data->Pagos();
        	$gastos = $data->listadoGastos();
           	$table = ob_get_clean();
        	include 'app/views/pages/Tesoreria/p.pagos.listado.php';
        	if(count($exec) > 0 and count($gastos) > 0) {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	}else{	
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table . '<div class="alert-danger"><center><h2>No existen Pagos o gastos pendientes. </h2><center></div>', $pagina);
          	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}

	function pagoGastos() {	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pagos.gastos.listado.php');
        	ob_start();
        	$exec = $data->listadoGastos();
        	if (count($exec) > 0) {
            	include 'app/views/pages/Tesoreria/p.pagos.gastos.listado.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	} else {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}
    
	function pagoGasto($identificador) {	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pago.gasto.php');
        	ob_start();
        	$cuentaBancarias = $data->CuentasBancos();
        	$exec = $data->PagosGastos($identificador);
        	if (count($exec) > 0) {
            	include 'app/views/pages/Tesoreria/p.pago.gasto.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	} else {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>Hubo un error al mostrar los datos</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}
   	 
	function realizaPago($documento, $claveProveedor){	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pagos.php');
        	ob_start();
        	$detallesaldo = $data->verHistorialSaldo($claveProveedor);
        	$cuentab = $data->CuentasBancos();
        	$exec = $data->detallePago($documento);
            include 'app/views/pages/Tesoreria/p.pagos.php';
            $table = ob_get_clean();
        	if (count($exec) > 0) {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	} else {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table . '<div class="alert-info"><center><h2>No hay mas ordenes de compra pendientes de pago.</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}           	 
	}    


	function PagoCorrecto($cuentabanco, $documento, $tipopago, $monto, $proveedor, $claveProveedor, $fechadocumento) {
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pagos.listado.php');
        	ob_start();
        	$error = "Datos guardados correctamente";
       		$guarda = $data->GuardaPagoCorrecto($cuentabanco, $documento, $tipopago, $monto, $proveedor, $claveProveedor, $fechadocumento);
        	$exec = $data->Pagos();
        	include 'app/views/pages/Tesoreria/p.pagos.listado.php';
            $table = ob_get_clean();	
        	if (isset($guarda)) {
                $pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
            	$pagina.="<script>alert('$error');</script>";
        	} else {
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table . '<div class="alert-danger"><center><h2>No existen mas pagos pendientes.</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}
    
	function PagoGastoCorrecto($cuentabanco, $documento, $tipopago, $monto, $proveedor, $claveProveedor, $fechadocumento) {
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pagos');
        	$html = $this->load_page('app/views/pages/Tesoreria/p.pagos.gastos.listado.php');
        	ob_start();
        	$guarda = $data->GuardaPagoGastoCorrecto($cuentabanco, $documento, $tipopago, $monto, $proveedor, $claveProveedor, $fechadocumento);
        	if($guarda!=null){
            	$error = "Datos guardados correctamente";
        	} else {
            	$error = "Hubieron errores al registrar el pago. Revise la bitacora de operación.";
        	}
        	$redireccionar = 'pago_gastos';
        	$pagina=$this->load_template('Pedidos');
        	$html = $this->load_page('app/views/pages/p.redirectform.php');
            include 'app/views/pages/p.redirectform.php';
        	$this->view_page($pagina);        	
    	} else {
        	$e = "Favor de Iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}

	function verXautorizar(){	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pedidos');
        	$html = $this->load_page('app/views/pages/p.pagos.xautorizar.php');
        	ob_start();       	 
        	$pagos = $data->listadoXautorizar();
        	if (count($pagos) > 0) {
            	include 'app/views/pages/p.pagos.xautorizar.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	} else {
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>No se han localizado pagos por autorizar</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}
    
	function xAutorizar($tipo, $identificador){
    	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pedidos');
        	$html = $this->load_page('app/views/pages/p.pagos.xdictaminar.php');
        	ob_start();       	 
        	$pagos = $data->xAutorizar($tipo, $identificador);
        	if (count($pagos) > 0) {
            	include 'app/views/pages/p.pagos.xdictaminar.php';
            	$table = ob_get_clean();
            	$pagina = $this->replace_content('/\#CONTENIDO\#/ms', $table, $pagina);
        	} else {
            	$pagina = $this->replace_content('/\CONTENIDO\#/ms', $html . '<div class="alert-danger"><center><h2>No se han localizado pagos por autorizar</h2><center></div>', $pagina);
        	}
        	$this->view_page($pagina);
    	} else {
        	$e = "Favor de iniciar Sesión";
        	header('Location: index.php?action=login&e=' . urlencode($e));
        	exit;
    	}
	}

	function xAutorizarDictamen($tipo, $identificador, $dictamen, $comentarios){
    	
    	if (isset($_SESSION['user'])) {
        	$data = new pegaso;
        	$pagina = $this->load_template('Pedidos');
        	$html = $this->load_page('app/views/pages/p.pagos.xautorizar.php');
        	ob_start();       	 
        	$dictamen = $data->xAutorizarDictamen($tipo, $identificador, $dictamen, $comentarios);
        	if($dictamen!=null){
            	echo "<script>alert('El pago fue dictaminado correctamente.')</script>";
        	}
        	$pagos = $data->listadoXautorizar();
        	if (count($pagos) > 0) {
            	include 'app/views/pages/p.pagos.xautorizar.php';